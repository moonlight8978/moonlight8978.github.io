<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="moonlight8978's Blog Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="moonlight8978's Blog Blog Atom Feed"><title data-react-helmet="true">Posts tagged &quot;introduction&quot; | moonlight8978&#x27;s Blog</title><meta data-react-helmet="true" property="og:title" content="Posts tagged &quot;introduction&quot; | moonlight8978&#x27;s Blog"><meta data-react-helmet="true" name="description" content="Blog | Tagged &quot;introduction&quot;"><meta data-react-helmet="true" property="og:description" content="Blog | Tagged &quot;introduction&quot;"><meta data-react-helmet="true" property="og:url" content="https://moonlight8978.github.io/blog/tags/introduction"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_tags_posts"><link data-react-helmet="true" rel="shortcut icon" href="https://avatars.githubusercontent.com/u/26299310?v=4"><link data-react-helmet="true" rel="canonical" href="https://moonlight8978.github.io/blog/tags/introduction"><link data-react-helmet="true" rel="alternate" href="https://moonlight8978.github.io/blog/tags/introduction" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://moonlight8978.github.io/blog/tags/introduction" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.5f3c8191.css">
<link rel="preload" href="/assets/js/runtime~main.610c7904.js" as="script">
<link rel="preload" href="/assets/js/main.afbd8574.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">My Site</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs/intro">Programming notes</a><a class="navbar__item navbar__link" href="/books/intro">Book notes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ğŸŒ</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">My Site</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/intro">Programming notes</a></li><li class="menu__list-item"><a class="menu__link" href="/books/intro">Book notes</a></li><li class="menu__list-item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-tags-post-page"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">All posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cung-tim-hieu-ve-puma-ruby-on-rails">CÃ¹ng tÃ¬m hiá»ƒu vá» Puma (Ruby on Rails)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cuoi-react-native-xem-appium-phan-1-cung-tim-hieu-cach-hoat-dong-cua-appium">CÆ°á»¡i React Native xem Appium (Pháº§n 1 - CÃ¹ng tÃ¬m hiá»ƒu cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a Appium)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/gioi-thieu-ve-kubernetes">Giá»›i thiá»‡u vá» Kubernetes</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/toi-uu-menh-de-where-mysql">Tá»‘i Æ°u má»‡nh Ä‘á» WHERE (MySQL)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cung-tim-hieu-ve-actiontext-trong-rails-6">CÃ¹ng tÃ¬m hiá»ƒu vá» ActionText trong Rails 6</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cung-tim-hieu-ve-railway-oriented-programming">CÃ¹ng tÃ¬m hiá»ƒu vá» Railway Oriented Programming</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/mot-vai-mindset-khi-lam-viec-voi-react">Má»™t vÃ i mindset khi lÃ m viá»‡c vá»›i React</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cung-tim-hieu-ve-nguyen-tu-cua-the-gioi-front-end-phan-2-density-independent-pixel">CÃ¹ng tÃ¬m hiá»ƒu vá» nguyÃªn tá»­ cá»§a tháº¿ giá»›i FrontEnd (Pháº§n 2 - Density-independent Pixel)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cung-tim-hieu-ve-nguyen-tu-cua-the-gioi-front-end-phan-1-pixel">CÃ¹ng tÃ¬m hiá»ƒu vá» nguyÃªn tá»­ cá»§a tháº¿ giá»›i FrontEnd (Pháº§n 1 - Pixel)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/tdd-bdd-noi-de-hon-lam">TDD/BDD - NÃ³i dá»… hÆ¡n lÃ m</a></li></ul></div></div><main class="col col--7"><h1>One post tagged with &quot;introduction&quot;</h1><a href="/blog/tags">View All Tags</a><div class="margin-vert--xl"><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/blog/gioi-thieu-ve-kubernetes">Giá»›i thiá»‡u vá» Kubernetes</a></h2><div class="margin-vert--md"><time datetime="2019-11-21T00:00:00.000Z" class="blogPostDate_fNvV">November 21, 2019 Â· 11 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="LÃª SÄ© BÃ­ch"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer">LÃª SÄ© BÃ­ch</a></h4><small class="avatar__subtitle">Ruby on Rails/React Developer</small></div></div></header><div class="markdown"><p>NgÃ y nay, container Ä‘Ã£ lÃ  1 thá»© gÃ¬ Ä‘Ã³ quÃ¡ phá»• biáº¿n, nhá»¯ng ná»n táº£ng cloud cá»§a Amazon, Google, hay Microsoft, v.v... Ä‘á»u Ä‘Ã£ há»— trá»£ deploy container. VÃ  á»Ÿ local, hay nhá»¯ng server test, má»i ngÆ°á»i cÅ©ng Ä‘ang dáº§n chuáº©n sang container vÃ¬ sá»± tiá»‡n lá»£i cá»§a chÃºng.</p><p>Tuy nhiÃªn khi sá»‘ lÆ°á»£ng container lá»›n dáº§n, chÃºng ngÃ y cÃ ng trá»Ÿ nÃªn ráº¯c rá»‘i, viá»‡c control resource, network, volume cá»§a má»™t sá»‘ lÆ°á»£ng lá»›n container ngÃ y cÃ ng khÃ³. ChÃ­nh vÃ¬ lÃ½ do Ä‘Ã³, má»™t sá»‘ ná»n táº£ng quáº£n lÃ½ container Ä‘Ã£ ra Ä‘á»i nhÆ° Docker Swarm, Kubernetes, ...</p><p>Vá»›i má»™t há»‡ thá»‘ng nhá», ta cÃ³ thá»ƒ sá»­ dá»¥ng Docker Swarm, sá»­ dá»¥ng nÃ³ ráº¥t dá»… vÃ  Ä‘Æ¡n giáº£n. Kubernetes cho phÃ©p ta customize nhiá»u thá»© trong há»‡ thá»‘ng hÆ¡n, tuy nhiÃªn cÃ¡i giÃ¡ cá»§a nÃ³ lÃ  khÃ³ sá»­ dá»¥ng hÆ¡n nhiá»u Docker Swarm.</p><p>Note: Ta khÃ´ng bao giá» so sÃ¡nh Kubernetes vá»›i Docker, vÃ¬ k8s thá»© lÃ  management tool, cÃ²n docker lÃ  container runtime.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-kiáº¿n-trÃºc-háº¡-táº§ng-cá»§a-kubernetes"></a>2. Kiáº¿n trÃºc háº¡ táº§ng cá»§a Kubernetes<a class="hash-link" href="#2-kiáº¿n-trÃºc-háº¡-táº§ng-cá»§a-kubernetes" title="Direct link to heading">#</a></h1><p><img src="https://images.viblo.asia/8fd57971-e1c9-41dd-b205-0ce88a356e50.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="21-master-components"></a>2.1 Master components<a class="hash-link" href="#21-master-components" title="Direct link to heading">#</a></h3><p>Nhá»¯ng components trÃªn master node sáº½ Ä‘Ã³ng vai trÃ² lÃ  control plane cá»§a cluster. VD nhÆ°: scheduling cÃ¡c pod, ...</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="211-etcd"></a>2.1.1 etcd<a class="hash-link" href="#211-etcd" title="Direct link to heading">#</a></h5><p>ÄÃ¢y lÃ  database phÃ¢n tÃ¡n, sá»­ dá»¥ng Raft lÃ m cÆ¡ cháº¿ Ä‘á»“ng thuáº­n.</p><p>State cá»§a cluster (config, node info, IP addresses, ...) Ä‘á»u Ä‘Æ°á»£c lÆ°u trá»¯ táº¡i Ä‘Ã¢y.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="212-kube-scheduler"></a>2.1.2 kube-scheduler<a class="hash-link" href="#212-kube-scheduler" title="Direct link to heading">#</a></h5><p>CÃ³ nhiá»‡m vá»¥ schedule pod tá»›i nhá»¯ng node cÃ³ Ä‘á»§ resource, vÃ  Ä‘áº£m báº£o pod Ä‘áº¡t Ä‘Æ°á»£c expected status.</p><p>CÃ³ thá»ƒ hiá»ƒu Ä‘Æ¡n giáº£n Ä‘Ã¢y lÃ  má»™t vÃ²ng láº·p vÃ´ táº­n, Ä‘Æ°a nhá»¯ng pod má»›i Ä‘Æ°á»£c táº¡o vÃ o 1 queue, tá»«ng item trong Ä‘Ã³ sáº½ Ä‘Æ°á»£c schedule tá»›i node thá»a mÃ£n.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="213-kube-apiserver"></a>2.1.3 kube-apiserver<a class="hash-link" href="#213-kube-apiserver" title="Direct link to heading">#</a></h5><p>API Server Ä‘Æ¡n thuáº§n lÃ  1 REST API cá»§a Kubernetes cluster.</p><p>Khi muá»‘n táº¡o, cáº­p nháº­t, hay xÃ³a nhá»¯ng resource cá»§a há»‡ thá»‘ng nhÆ° pod, ingress, ... thÃ¬ Ä‘á»u cáº§n thÃ´ng qua API Server, chá»© khÃ´ng call tháº³ng tá»›i kube-scheduler, etcd, ...</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="214-kube-controller-manager"></a>2.1.4 kube-controller-manager<a class="hash-link" href="#214-kube-controller-manager" title="Direct link to heading">#</a></h5><p>Cháº¡y nhiá»u controller process. Má»—i controller cÃ³ nhiá»‡m vá»¥ khÃ¡c nhau nhÆ°:</p><ul><li>Node Controller</li><li>Replication Controller</li><li>...</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="22-node-components"></a>2.2 Node components<a class="hash-link" href="#22-node-components" title="Direct link to heading">#</a></h3><p>LÃ  nhá»¯ng component Ä‘Æ°á»£c cÃ i Ä‘áº·t trÃªn táº¥t cáº£ cÃ¡c node, giÃºp quáº£n lÃ½ container trÃªn node, logging, quáº£n lÃ½ network, ...</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="221-kubelet"></a>2.2.1 kubelet<a class="hash-link" href="#221-kubelet" title="Direct link to heading">#</a></h5><p>CÃ³ nhiá»‡m vá»¥ quáº£n lÃ½ container, Ä‘áº£m báº£o container cháº¡y chÃ­nh xÃ¡c, kubelet chá»‰ quáº£n lÃ½ container do k8s táº¡o.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="222-kube-proxy"></a>2.2.2 kube-proxy<a class="hash-link" href="#222-kube-proxy" title="Direct link to heading">#</a></h5><p>LÃ  má»™t network proxy, dÃ¹ng Ä‘á»ƒ forward request tá»›i háº¡ táº§ng cá»§a k8s.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="223-container-runtime"></a>2.2.3 Container runtime<a class="hash-link" href="#223-container-runtime" title="Direct link to heading">#</a></h5><p>Cháº¯n cháº¯n ta khÃ´ng thá»ƒ thiáº¿u runtime cho container, nÃ³ cÃ³ thá»ƒ lÃ  rkt, Docker, ... hay báº¥t cá»© thá»© gÃ¬ khÃ¡c.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="23-hoáº¡t-Ä‘á»™ng"></a>2.3 Hoáº¡t Ä‘á»™ng<a class="hash-link" href="#23-hoáº¡t-Ä‘á»™ng" title="Direct link to heading">#</a></h3><p>ChÃºng ta sáº½ cÃ¹ng xem nhá»¯ng component trÃªn sáº½ káº¿t há»£p vá»›i nhau hoáº¡t Ä‘á»™ng ra sao, thÃ´ng qua viá»‡c táº¡o 1 Pod qua <code>kubectl</code> CLI.</p><p><strong>Pod</strong> á»Ÿ Ä‘Ã¢y cÃ³ thá»ƒ coi lÃ  1 mÃ¡y áº£o, hay 1 container nhÆ° Docker cho dá»… hÃ¬nh dung.</p><p><img src="https://images.viblo.asia/f19795c9-fbc9-48e1-9391-53fc439c1391.jpg"></p><ul><li>TrÆ°á»›c tiÃªn ta sá»­ dá»¥ng <code>kubectl</code> Ä‘á»ƒ yÃªu cáº§u táº¡o 1 Pod. Báº£n cháº¥t cá»§a command nÃ y lÃ  sáº½ thá»±c hiá»‡n 1 HTTP request tá»›i <strong>apiserver</strong> cá»§a cluster.</li><li><strong>apiserver</strong> sáº½ thá»±c hiá»‡n ghi láº¡i current state, vÃ  desired state cá»§a cluster láº¡i vÃ o <strong>etcd</strong> (asynchronous)</li><li><strong>etcd</strong> sáº½ notify láº¡i <strong>apiserver</strong> khi entry Ä‘Æ°á»£c táº¡o thÃ nh cÃ´ng</li><li>Tiáº¿p theo <strong>kube-scheduler</strong> sáº½ thá»±c hiá»‡n viá»‡c schedule Pod. Khi tÃ¬m tháº¥y node thÃ­ch há»£p, nÃ³ sáº½ bÃ¡o cho <strong>apiserver</strong> lÃ  Pod Ä‘Ã³ Ä‘Ã£ Ä‘Æ°á»£c bind vÃ o node nÃ o. <strong>apiserver</strong> sáº½ láº¡i update vÃ o <strong>etcd</strong></li><li><strong>kubelet</strong> táº¡i node Ä‘Ã³ sáº½ thá»±c hiá»‡n viá»‡c theo dÃµi container táº¡o bá»Ÿi <strong>container runtime</strong> (Docker), xem chÃºng cÃ³ cháº¡y Ä‘Ãºng vá»›i PodSpec khÃ´ng. <strong>kubelet</strong> sáº½ gá»i tá»›i <strong>apiserver</strong> Ä‘á»ƒ update state cá»§a Pod Ä‘Ã³ thÆ°á»ng xuyÃªn.</li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-kiáº¿n-trÃºc-cá»§a-á»©ng-dá»¥ng-trÃªn-kubernetes"></a>3. Kiáº¿n trÃºc cá»§a á»©ng dá»¥ng trÃªn Kubernetes<a class="hash-link" href="#3-kiáº¿n-trÃºc-cá»§a-á»©ng-dá»¥ng-trÃªn-kubernetes" title="Direct link to heading">#</a></h1><p>Ta sáº½ chá»‰ táº­p trung vÃ o 3 yáº¿u tá»‘ chÃ­nh Ä‘á»ƒ má»™t há»‡ thá»‘ng cÃ³ thá»ƒ hoáº¡t Ä‘á»™ng Ä‘Æ°á»£c:</p><ul><li>á»¨ng dá»¥ng</li><li>Network</li><li>Storage</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="31-pod"></a>3.1 Pod<a class="hash-link" href="#31-pod" title="Direct link to heading">#</a></h3><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="pod-lÃ -gÃ¬"></a>Pod lÃ  gÃ¬<a class="hash-link" href="#pod-lÃ -gÃ¬" title="Direct link to heading">#</a></h5><p><strong>Pod</strong> lÃ  Ä‘Æ¡n vá»‹ nhá» nháº¥t trong cluster. Má»—i Pod cÃ³ IP riÃªng, vÃ  cÃ³ thá»ƒ chá»©a nhiá»u container, nhá»¯ng container trong cÃ¹ng 1 Pod cÃ³ thá»ƒ giao tiáº¿p vá»›i nhau qua localhost. VÃ¬ váº­y, cÃ³ thá»ƒ coi Pod lÃ  má»™t mÃ¡y áº£o cho dá»… hÃ¬nh dung.</p><p>Tuy nhiÃªn Ä‘á»ƒ Ä‘Æ¡n giáº£n, ngÆ°á»i ta thÆ°á»ng chá»‰ cháº¡y 1 container trÃªn má»—i Pod, khi Ä‘Ã³ ta sáº½ lÃ m viá»‡c vá»›i Pod thay vÃ¬ vá»›i tá»«ng container riÃªng láº».</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="init-container"></a>Init container<a class="hash-link" href="#init-container" title="Direct link to heading">#</a></h5><p>Pod cÃ³ há»— trá»£ init container (1 hoáº·c nhiá»u Ä‘á»u Ä‘Æ°á»£c). TrÆ°á»›c khi app container (container chÃ­nh - vÃ­ dá»¥ container vá»›i command <code>rails s</code>) cháº¡y, táº¥t cáº£ init container sáº½ Ä‘Æ°á»£c cháº¡y láº§n lÆ°á»£t, cÃ¡i trÆ°á»›c thÃ nh cÃ´ng rá»“i Ä‘áº¿n cÃ¡i sau cháº¡y.</p><p>VÃ­ dá»¥ nhÆ° 1 á»©ng dá»¥ng Rails, ta cÃ³ thá»ƒ settings <code>rails s</code> lÃ m app container, cÃ²n <code>rails db:create db:migrate</code> sáº½ lÃ m init container.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="controller"></a>Controller<a class="hash-link" href="#controller" title="Direct link to heading">#</a></h5><p>Controller lÃ  1 concept trong Kubernetes, nÃ³ dÃ¹ng Ä‘á»ƒ theo dÃµi 1 loáº¡i Resource nÃ o Ä‘Ã³. <strong>kube-controller-manager</strong> cÃ³ nhiá»‡m vá»¥ quáº£n lÃ½ nhá»¯ng controller nÃ y.</p><p>Vá» máº·t ká»¹ thuáº­t thÃ¬ Ä‘Ã¢y Ä‘Æ¡n thuáº§n lÃ  1 vÃ²ng láº·p vÃ´ háº¡n (<em>control loop</em>) Ä‘á»ƒ cÃ³ thá»ƒ Ä‘iá»u chá»‰nh state cá»§a cluster sao cho nÃ³ Ä‘áº¡t tá»›i Ä‘Æ°á»£c desired state.</p><p>Tuy nhiÃªn Ä‘ang trong má»¥c Pod nÃªn ta sáº½ chá»‰ Ä‘á» cáº­p tá»›i controller theo dÃµi Pod trong pháº§n nÃ y.</p><ul><li><p><code>Deployment</code>:</p><p>Ta sáº½ sá»­ dá»¥ng <code>Deployment</code> khi cáº§n deploy 1 hoáº·c nhiá»u replica (thÆ°á»ng lÃ  stateless).</p><p>Thá»© tá»± khá»Ÿi Ä‘á»™ng, identify cá»§a nhá»¯ng replica (Pod) lÃ  hoÃ n toÃ n ngáº«u nhiÃªn.</p></li><li><p><code>StatefulSet</code>:</p><p>Náº¿u app cá»§a chÃºng ta lÃ  stateful (vÃ­ dá»¥ nhÆ° 1 set MySQL vá»›i 1 master vÃ  2 slave), khi Ä‘Ã³ viá»‡c cÃ³ 1 stable identity lÃ  ráº¥t quan trá»ng. NgoÃ i ra vá»›i má»—i replica trong <code>StatefulSet</code>, Kubernetes sáº½ cung cáº¥p cho nÃ³ má»™t storage riÃªng.</p><p><code>StatefulSet</code> thÃªm prefix <code>0</code>, <code>1</code>, <code>2</code>, ... lÃ  thá»© tá»± khá»Ÿi Ä‘á»™ng cá»§a pod vÃ o tÃªn pod.</p><p>Khi Ä‘Ã³ network identity, cÅ©ng nhÆ° storage cá»§a Pod sáº½ trá»Ÿ nÃªn stable. Náº¿u mysql-0 cá»§a ta lÃ  master, nÃ³ sáº½ luÃ´n lÃ  master, vÃ  nÃ³ cÅ©ng luÃ´n request tá»›i storage cá»§a master.</p></li><li><p><code>DaemonSet</code>:</p><p>Ta dÃ¹ng <code>DaemonSet</code> trong trÆ°á»ng há»£p muá»‘n táº¥t cáº£ cÃ¡c node Ä‘á»u pháº£i cháº¡y 1 Pod nÃ o Ä‘Ã³.</p><p>VÃ­ dá»¥ nhÆ° storage cluster nhÆ° <strong>glusterd</strong>, hay log agent nhÆ° <strong>fluentd</strong>, ...</p></li><li><p><code>Job</code>:</p><p>Khi ta cáº§n cháº¡y one-off Pod. VÃ­ dá»¥ nhÆ° viá»‡c import master data.</p></li><li><p><code>CronJob</code>:</p><p>NhÆ° tÃªn gá»i cá»§a nÃ³, cá»© Ä‘á»‹nh kÃ¬ nÃ³ sáº½ táº¡o Pod Ä‘á»ƒ thá»±c hiá»‡n job.</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="32-networking"></a>3.2 Networking<a class="hash-link" href="#32-networking" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="321-service"></a>3.2.1 Service<a class="hash-link" href="#321-service" title="Direct link to heading">#</a></h4><p>TrÃªn mÃ´i trÆ°á»ng production, ráº¥t hiáº¿m khi ta tháº¥y 1 service chá»‰ cháº¡y trÃªn 1 server. Thay vÃ¬ tháº¿, thÆ°á»ng sáº½ cÃ³ 2 hoáº·c nhiá»u hÆ¡n server cÃ¹ng cháº¡y, khi server nÃ y cháº¿t, ta cÃ³ thá»ƒ forward request tá»›i nhá»¯ng server heo-thÃ¬ (healthy) cÃ²n láº¡i (trong trÆ°á»ng há»£p cÃ³ set load balancer vÃ  healthcheck), khÃ´ng lÃ m cho service cá»§a ta ngá»m luÃ´n.</p><p>Tuy nhiÃªn IP cá»§a Pod trong cluster luÃ´n thay Ä‘á»•i, váº­y thÃ¬ ta biáº¿t pháº£i setup cho load balancer nhÆ° tháº¿ nÃ o? VÃ  Ä‘Ã¢y chÃ­nh lÃ  Ä‘áº¥t diá»…n cá»§a <code>Service</code>.</p><p><code>Service</code> lÃ  má»™t táº­p há»£p cÃ¡c Pod, thÆ°á»ng sáº½ dÃ¹ng <code>label</code> Ä‘á»ƒ group cÃ¡c Pod.</p><p>ThÃ´ng thÆ°á»ng, má»—i <code>Service</code> sáº½ Ä‘Æ°á»£c gÃ¡n cho 1 cluster IP, Kubernetes sáº½ cung cáº¥p DNS name, vÃ  Ä‘á»“ng thá»i cÅ©ng load-balance cho cÃ¡c Pod cá»§a <code>Service</code>.</p><p><img src="https://images.viblo.asia/2a7f4968-7280-47eb-a225-60ab2f06ab6e.png"></p><p>Ta cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng <code>Service</code> cho external endpoint.</p><p>VÃ­ dá»¥ khi há»‡ thá»‘ng cáº§n call Ä‘áº¿n <em><a href="https://google.com.vn" target="_blank" rel="noopener noreferrer">https://google.com.vn</a></em>. Tuy nhiÃªn ta láº¡i khÃ´ng muá»‘n call trá»±c tiáº¿p, hay hardcode trong code, mÃ  muá»‘n endpoint nÃ y cÅ©ng trá»Ÿ thÃ nh 1 pháº§n cá»§a cluster, Ä‘á»ƒ dá»… quáº£n lÃ½. Khi Ä‘Ã³ ta cÃ³ thá»ƒ thay Ä‘á»•i endpoint nÃ y mÃ  khÃ´ng pháº£i Ä‘á»¥ng Ä‘áº¿n code, hay biáº¿n ENV gÃ¬ Ä‘Ã³. Khi Ä‘Ã³, ta sáº½ define 1 <code>Service</code>, vÃ  set <code>Endpoint</code> thá»§ cÃ´ng cho service nÃ y, thay vÃ¬ sá»­ dá»¥ng <code>label</code>.</p><p>NgoÃ i ra cÃ²n cÃ³ <code>Headless Service</code>, loáº¡i service nÃ y sáº½ khÃ´ng Ä‘Æ°á»£c gÃ¡n cluster IP. Ta sáº½ sá»­ dá»¥ng khi ta muá»‘n sá»­ dá»¥ng cÃ¡ch load balance riÃªng, khÃ´ng phá»¥ thuá»™c Kubernetes.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="322-load-balancer"></a>3.2.2 Load balancer<a class="hash-link" href="#322-load-balancer" title="Direct link to heading">#</a></h4><p>Khi táº¡o Service, náº¿u Ä‘Ã¢y lÃ  service cho phÃ©p traffic tá»« bÃªn ngoÃ i Internet, ta hoÃ n toÃ n cÃ³ thá»ƒ sá»­ dá»¥ng Load Balancer cá»§a cÃ¡c nhÃ  cung cáº¥p dá»‹ch vá»¥ cloud (thÆ°á»ng lÃ  L3 Load Balancer).</p><p>Khi call tá»›i Load Balancer nÃ³i trÃªn, nÃ³ sáº½ trá»±c tiáº¿p forward traffic tá»›i service trong cluster, thuáº­t toÃ¡n load-balance sáº½ do Load Balancer nÃ y quyáº¿t Ä‘á»‹nh.</p><p><img src="https://images.viblo.asia/fdf97441-6cc1-4b42-ac48-342541d0421e.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="323-ingress"></a>3.2.3 Ingress<a class="hash-link" href="#323-ingress" title="Direct link to heading">#</a></h4><p><code>Ingress</code> hoáº¡t Ä‘á»™ng giá»‘ng 1 Reverse Proxy hay Layer 7 Load Balancer. NÃ³ cÅ©ng cÃ³ nÃ©t tÆ°Æ¡ng Ä‘á»“ng vá»›i API Gateway.</p><p><code>Ingress</code> cÃ³ thá»ƒ Ä‘iá»u hÆ°á»›ng cáº£ internal traffic láº«n external traffic dá»±a vÃ o URL, Ä‘á»“ng thá»i cung cáº¥p thÃªm cáº£ load balancing giá»¯a nhá»¯ng pod cá»§a service. Má»™t Ä‘iá»ƒm Ä‘Ã¡ng lÆ°u Ã½ lÃ  <code>Ingress</code> sáº½ load balance trá»±c tiáº¿p cÃ¡c backend Pod mÃ  khÃ´ng thÃ´ng qua service, do Ä‘Ã³, ta cÃ³ thá»ƒ tÃ¹y chá»‰nh Ä‘Æ°á»£c thuáº­t toÃ¡n, ... liÃªn quan tá»›i LB cho toÃ n bá»™ <code>Ingress</code> cá»§a cluster.</p><p>NgoÃ i ra, ngÆ°á»i ta cÅ©ng dÃ¹ng <code>Ingress</code> Ä‘á»ƒ terminate TLS session.</p><p><img src="https://images.viblo.asia/5809feda-e282-4d5f-9cfb-11077d952add.jpg"></p><p>Kubernetes sau khi init máº·c Ä‘á»‹nh sáº½ khÃ´ng cÃ³ ingress controller. Náº¿u ta chá»‰ táº¡o <code>Ingress</code> thÃ¬ sáº½ khÃ´ng cÃ³ Ã½ nghÄ©a gÃ¬. Äá»ƒ sá»­ dá»¥ng <code>Ingress</code> ta sáº½ pháº£i setup thá»§ cÃ´ng Ingress Controller. Tuy nhiÃªn viá»‡c nÃ y khÃ¡ Ä‘Æ¡n giáº£n, do nhiá»u hÃ£ng Ä‘Ã£ build sáºµn má»i thá»©, ta chá»‰ cáº§n láº¥y file manifest cá»§a há» vá» rá»“i cháº¡y lÃ  Ä‘Æ°á»£c.</p><ul><li>nginx: <a href="https://kubernetes.github.io/ingress-nginx/" target="_blank" rel="noopener noreferrer">NGINX Ingress Controller</a></li><li>traefik: <a href="https://docs.traefik.io/providers/kubernetes-ingress/" target="_blank" rel="noopener noreferrer">Kubernetes Ingress</a></li><li>...</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="324-practice"></a>3.2.4 Practice<a class="hash-link" href="#324-practice" title="Direct link to heading">#</a></h4><p><img src="https://images.viblo.asia/5001a20e-979c-473f-b2da-92c8668f621e.png"></p><ul><li>Traffic tá»« phÃ­a client sáº½ Ä‘Æ°á»£c táº­p trung táº¡i Layer 4 Load Balancer.</li><li>L4 LB sáº½ phÃ¢n bá»‘ traffic tá»›i cÃ¡c Node trong cluster (thÆ°á»ng qua <code>NodePort</code>).</li><li><code>Ingress</code> Ä‘Æ°á»£c map vá»›i <code>NodePort</code> Ä‘Ã³ sáº½ terminate SSL, routing, vÃ  load balance traffic tá»›i nhá»¯ng Pod thÃ­ch há»£p.<ul><li>Traffic tá»›i <code>/web</code> sáº½ Ä‘Æ°á»£c Ä‘iá»u hÆ°á»›ng tá»›i Frontend Pods</li><li>Traffic tá»›i <code>/api</code> sáº½ Ä‘Æ°á»£c Ä‘iá»u hÆ°á»›ng tá»›i Backend Pods</li></ul></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="33-storage---volume"></a>3.3 Storage - Volume<a class="hash-link" href="#33-storage---volume" title="Direct link to heading">#</a></h3><p>Má»™t há»‡ thá»‘ng khÃ³ cÃ³ thá»ƒ hoáº¡t Ä‘á»™ng chá»‰ vá»›i stateless service.</p><p>Vá»›i má»™t sá»‘ service nhÆ° database, hay nhÆ° tÃ­nh nÄƒng upload file, ... Náº¿u chÃºng ta khÃ´ng sá»­ dá»¥ng external service, thÃ¬ service cá»§a ta sáº½ trá»Ÿ thÃ nh stateful service. NÃ³ Ä‘Ã²i há»i dá»¯ liá»‡u trong quÃ¡ trÃ¬nh xá»­ lÃ½ pháº£i Ä‘Æ°á»£c lÆ°u láº¡i ngay cáº£ khi bá»‹ crash. NgoÃ i ra cÃ³ nhá»¯ng lÃºc ta sáº½ cáº§n share dá»¯ liá»‡u giá»¯a nhá»¯ng container trong cÃ¹ng 1 Pod. Nhá»¯ng lÃºc nhÆ° váº­y, ta sáº½ cáº§n Ä‘áº¿n <strong>Volume</strong>.</p><p>Khi define Pod, ta sáº½ chá»‰ rÃµ Pod nÃ y cáº§n nhá»¯ng volume nÃ o, sau Ä‘Ã³ map nhá»¯ng volume Ä‘Ã³ cho container.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="persistentvolume"></a>PersistentVolume<a class="hash-link" href="#persistentvolume" title="Direct link to heading">#</a></h5><p>Kubernetes sá»­ dá»¥ng <code>PersistentVolume</code> Ä‘á»ƒ táº¡o nÃªn 1 lá»›p abstract vá»›i nhá»¯ng há»‡ thá»‘ng storage tháº­t phÃ­a sau. <code>PV</code> cÅ©ng cÃ³ life-cycle giá»‘ng nhÆ° Pod.</p><p>Khi ta sá»­ dá»¥ng volume, ta sáº½ khÃ´ng cáº§n quan tÃ¢m há»‡ thá»‘ng Ä‘áº±ng sau ngang dá»c ra sao, thá»© duy nháº¥t ta cáº§n quan tÃ¢m lÃ  API cá»§a <code>PersistentVolume</code>.</p><p>Trong Kubernetes, <code>PV</code> cÃ³ thá»ƒ Ä‘Æ°á»£c táº¡o báº±ng 2 cÃ¡ch:</p><ul><li>Dynamic Provisioning</li><li>Static Provisioning</li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="static-provisioning"></a>Static Provisioning<a class="hash-link" href="#static-provisioning" title="Direct link to heading">#</a></h5><p>Admin cluster sáº½ táº¡o ra 1 sá»‘ <code>PV</code> trÆ°á»›c, sau Ä‘Ã³ cung cáº¥p cho bÃªn Dev/Ops. Nhá»¯ng <code>PV</code> nÃ y Ä‘Ã£ Ä‘Æ°á»£c trá» tá»›i há»‡ thá»‘ng storage tháº­t Ä‘ang hoáº¡t Ä‘á»™ng Ä‘áº±ng sau.</p><p>CÃ³ thá»ƒ xem danh sÃ¡ch driver mÃ  Kubernetes há»— trá»£ táº¡i <a href="https://kubernetes.io/docs/concepts/storage/volumes/#types-of-volumes" target="_blank" rel="noopener noreferrer">Ä‘Ã¢y</a>.</p><p>VÃ­ dá»¥: Ta cÃ³ 1 cluster Glusterfs vá»›i 3 node, tá»•ng dung lÆ°á»£ng lÃ  3TB. Khi cáº§n 10GB cho viá»‡c lÆ°u trá»¯ share resource, ta sáº½ táº¡o <code>PersistentVolume</code> vá»›i dung lÆ°á»£ng 10GB, trá» tá»›i cluster nÃ³i trÃªn. Sau Ä‘Ã³ ta sáº½ sá»­ dá»¥ng volume trÃªn tÆ°Æ¡ng tá»± nhÆ° cÃ¡c volume khÃ¡c trong há»‡ thá»‘ng.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="dynamic-provisioning"></a>Dynamic Provisioning<a class="hash-link" href="#dynamic-provisioning" title="Direct link to heading">#</a></h5><p><code>PV</code> sáº½ Ä‘Æ°á»£c táº¡o 1 cÃ¡ch Ä‘á»™ng. Tá»©c lÃ  khi nÃ o Pod cá»§a ta cáº§n volume, thÃ¬ <code>PV</code> sáº½ Ä‘Æ°á»£c táº¡o 1 cÃ¡ch tá»± Ä‘á»™ng, nhá» vÃ o <code>StorageClass</code> (sáº½ Ä‘á» cáº­p sau).</p><p>CÃ¡ch lÃ m nÃ y Ä‘Ã²i há»i há»‡ thá»‘ng storage cá»§a ta cÅ©ng pháº£i support dynamic provisioning.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="persistentvolumeclaim"></a>PersistentVolumeClaim<a class="hash-link" href="#persistentvolumeclaim" title="Direct link to heading">#</a></h5><p>Äá»ƒ cÃ³ thá»ƒ sá»­ dá»¥ng Ä‘Æ°á»£c <code>PV</code>, ta cáº§n táº¡o thÃªm <code>PersistentVolumeClaim</code> (PVC).</p><p>Ta cÃ³ thá»ƒ sá»­ dá»¥ng Claim trÃªn cho config, hay volume, ... cá»§a Pod.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="4-high-availability-setup"></a>4. High Availability Setup<a class="hash-link" href="#4-high-availability-setup" title="Direct link to heading">#</a></h1><p><img src="https://images.viblo.asia/48635fac-b09b-4174-b279-4f8d0fa29fb6.png"></p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="5-reference"></a>5. Reference<a class="hash-link" href="#5-reference" title="Direct link to heading">#</a></h1><p>kubernetes.io - <a href="https://documentationo/docs/home/" target="_blank" rel="noopener noreferrer">Kubernetes Official Documentation</a></p><p>youtube.com - <a href="https://www.youtube.com/watch?v=GXq3FS8M_kw" target="_blank" rel="noopener noreferrer">June 2018 Online Meetup: Kubernetes Networking Master Class</a></p><p>x-team.com - <a href="https://x-team.com/blog/introduction-kubernetes-architecture/" target="_blank" rel="noopener noreferrer">INTRODUCTION TO KUBERNETES ARCHITECTURE</a></p><p>ovh.com - <a href="https://www.ovh.com/blog/getting-external-traffic-into-kubernetes-clusterip-nodeport-loadbalancer-and-ingress/" target="_blank" rel="noopener noreferrer">Getting external traffic into Kubernetes â€“ ClusterIp, NodePort, LoadBalancer, and Ingress</a></p><p>medium.com - <a href="https://medium.com/jorgeacetozi/kubernetes-master-components-etcd-api-server-controller-manager-and-scheduler-3a0179fc8186" target="_blank" rel="noopener noreferrer">Kubernetes Master Components: Etcd, API Server, Controller Manager, and Scheduler</a></p><p>medium.com - <a href="https://medium.com/google-cloud/kubernetes-nodeport-vs-loadbalancer-vs-ingress-when-should-i-use-what-922f010849e0" target="_blank" rel="noopener noreferrer">Kubernetes NodePort vs LoadBalancer vs Ingress? When should I use what?</a></p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/devops">devops</a><a class="margin-horiz--sm" href="/blog/tags/kubernetes">kubernetes</a><a class="margin-horiz--sm" href="/blog/tags/introduction">introduction</a></div><div class="col text--right"><a aria-label="Read more about Giá»›i thiá»‡u vá» Kubernetes" href="/blog/gioi-thieu-ve-kubernetes"><strong>Read More</strong></a></div></footer></article></div></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Self notes</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/moonlight8978/moonlight8978.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://stackoverflow.com/users/8068639/moonlight8978" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 moonlight8978. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.610c7904.js"></script>
<script src="/assets/js/main.afbd8574.js"></script>
</body>
</html>