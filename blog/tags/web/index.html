<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="moonlight8978's Blog Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="moonlight8978's Blog Blog Atom Feed"><title data-react-helmet="true">Posts tagged &quot;web&quot; | moonlight8978&#x27;s Blog</title><meta data-react-helmet="true" property="og:title" content="Posts tagged &quot;web&quot; | moonlight8978&#x27;s Blog"><meta data-react-helmet="true" name="description" content="Blog | Tagged &quot;web&quot;"><meta data-react-helmet="true" property="og:description" content="Blog | Tagged &quot;web&quot;"><meta data-react-helmet="true" property="og:url" content="https://moonlight8978.github.io/blog/tags/web"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_tags_posts"><link data-react-helmet="true" rel="shortcut icon" href="https://avatars.githubusercontent.com/u/26299310?v=4"><link data-react-helmet="true" rel="canonical" href="https://moonlight8978.github.io/blog/tags/web"><link data-react-helmet="true" rel="alternate" href="https://moonlight8978.github.io/blog/tags/web" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://moonlight8978.github.io/blog/tags/web" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.5f3c8191.css">
<link rel="preload" href="/assets/js/runtime~main.9bf10215.js" as="script">
<link rel="preload" href="/assets/js/main.a4c2403e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">_MoonLight_</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs/intro">Programming notes</a><a class="navbar__item navbar__link" href="/books/intro">Book notes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ğŸŒ</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">_MoonLight_</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/intro">Programming notes</a></li><li class="menu__list-item"><a class="menu__link" href="/books/intro">Book notes</a></li><li class="menu__list-item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-tags-post-page"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">All posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/tim-hieu-ve-active-record-encryption">TÃ¬m hiá»ƒu vá» Active Record Encryption</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/websocket-hoat-dong-nhu-the-nao">WebSocket hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o?</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cung-tim-hieu-ve-puma-ruby-on-rails">CÃ¹ng tÃ¬m hiá»ƒu vá» Puma (Ruby on Rails)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cuoi-react-native-xem-appium-phan-1-cung-tim-hieu-cach-hoat-dong-cua-appium">CÆ°á»¡i React Native xem Appium (Pháº§n 1 - CÃ¹ng tÃ¬m hiá»ƒu cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a Appium)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/gioi-thieu-ve-kubernetes">Giá»›i thiá»‡u vá» Kubernetes</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/toi-uu-menh-de-where-mysql">Tá»‘i Æ°u má»‡nh Ä‘á» WHERE (MySQL)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cung-tim-hieu-ve-actiontext-trong-rails-6">CÃ¹ng tÃ¬m hiá»ƒu vá» ActionText trong Rails 6</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cung-tim-hieu-ve-railway-oriented-programming">CÃ¹ng tÃ¬m hiá»ƒu vá» Railway Oriented Programming</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/mot-vai-mindset-khi-lam-viec-voi-react">Má»™t vÃ i mindset khi lÃ m viá»‡c vá»›i React</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cung-tim-hieu-ve-nguyen-tu-cua-the-gioi-front-end-phan-2-density-independent-pixel">CÃ¹ng tÃ¬m hiá»ƒu vá» nguyÃªn tá»­ cá»§a tháº¿ giá»›i FrontEnd (Pháº§n 2 - Density-independent Pixel)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cung-tim-hieu-ve-nguyen-tu-cua-the-gioi-front-end-phan-1-pixel">CÃ¹ng tÃ¬m hiá»ƒu vá» nguyÃªn tá»­ cá»§a tháº¿ giá»›i FrontEnd (Pháº§n 1 - Pixel)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/tdd-bdd-noi-de-hon-lam">TDD/BDD - NÃ³i dá»… hÆ¡n lÃ m</a></li></ul></div></div><main class="col col--7"><h1>4 posts tagged with &quot;web&quot;</h1><a href="/blog/tags">View All Tags</a><div class="margin-vert--xl"><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/blog/tim-hieu-ve-active-record-encryption">TÃ¬m hiá»ƒu vá» Active Record Encryption</a></h2><div class="margin-vert--md"><time datetime="2021-06-17T00:00:00.000Z" class="blogPostDate_fNvV">June 17, 2021 Â· 8 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="LÃª SÄ© BÃ­ch"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer">LÃª SÄ© BÃ­ch</a></h4><small class="avatar__subtitle">Ruby on Rails/React Developer</small></div></div></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="overview"></a>Overview<a class="hash-link" href="#overview" title="Direct link to heading">#</a></h2><p>VÃ o ngÃ y 28/5/2021, trÃªn blog cá»§a Rails cÃ³ thÃ´ng bÃ¡o vá» 1 tÃ­nh nÄƒng má»›i Ä‘Ã³ lÃ  <a href="https://weblog.rubyonrails.org/2021/5/28/this-week-in-rails-active-record-encrytion-several-performance-optimizations-and-much-more/" target="_blank" rel="noopener noreferrer">ActiveRecord Encryption</a>.</p><p>ActiveRecord Encryption giÃºp encrypt attribute nÃ o Ä‘Ã³ cá»§a model, vÃ  lÆ°u vÃ o DB dÆ°á»›i dáº¡ng mÃ£ hoÃ¡. TÃ­nh nÄƒng nÃ y Ä‘Æ°á»£c extract ra tá»« dá»± Ã¡n <a href="https://www.hey.com" target="_blank" rel="noopener noreferrer">HEY</a> cá»§a Basecamp.</p><p>HÃ£y thá»­ tÃ¬m hiá»ƒu xem tÃ­nh nÄƒng nÃ y cÃ³ gÃ¬ thÃº vá»‹.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="usage"></a>Usage<a class="hash-link" href="#usage" title="Direct link to heading">#</a></h2><p>Theo <a href="https://edgeguides.rubyonrails.org/active_record_encryption.html#basic-usage" target="_blank" rel="noopener noreferrer">guide</a>, Ä‘áº§u tiÃªn chÃºng ta sáº½ cáº§n pháº£i cháº¡y cÃ¢u lá»‡nh sau</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">rails db:encryption:init</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Rails sáº½ cho ta 1 gá»£i Ã½ lÃ  copy Ä‘á»‘ng sau vÃ o credentials. á»ª <code>EDITOR=vim rails credentials:edit</code> rá»“i copy paste thÃ´i.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yml"><div tabindex="0" class="prism-code language-yml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">active_record_encryption</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">primary_key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> EGY8WhulUOXixybod7ZWwMIL68R9o5kC</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">deterministic_key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> aPA5XyALhf75NNnMzaspW7akTfZp0lPY</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">key_derivation_salt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> xEY0dt6TZcAMg52K7O84wYzkjvbA62Hz</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Trong model, ta define attribute cáº§n mÃ£ hoÃ¡ nhÆ° sau:</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">app/models/article.rb</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class Article &lt; ApplicationRecord</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  encrypts :title</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Rá»“i create/update model nhÆ° bÃ¬nh thÆ°á»ng</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">article = Article.create(title: &quot;Encrypt it all!&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>VÃ  bÃ¹m, magic...</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">INSERT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTO</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">`</span><span class="token plain">articles</span><span class="token punctuation" style="color:rgb(199, 146, 234)">`</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">`</span><span class="token plain">title</span><span class="token punctuation" style="color:rgb(199, 146, 234)">`</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{\&quot;p\&quot;:\&quot;n7J0/ol+a7DRMeaE\&quot;,\&quot;h\&quot;:{\&quot;iv\&quot;:\&quot;DXZMDWUKfp3bg/Yu\&quot;,\&quot;at\&quot;:\&quot;X1/YjMHbHD4talgF9dt61A==\&quot;}}&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>VÃ´ háº¡n bá»‘i rá»‘i...</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="aes"></a>AES<a class="hash-link" href="#aes" title="Direct link to heading">#</a></h2><p>TrÆ°á»›c tiÃªn ta hÃ£y tÃ¬m hiá»ƒu vá» Ä‘á»‘ng key mÃ  Rails Ä‘Ã£ gen cho ta lÃºc Ä‘áº§u</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yml"><div tabindex="0" class="prism-code language-yml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">active_record_encryption</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">primary_key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> EGY8WhulUOXixybod7ZWwMIL68R9o5kC</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">deterministic_key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> aPA5XyALhf75NNnMzaspW7akTfZp0lPY</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">key_derivation_salt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> xEY0dt6TZcAMg52K7O84wYzkjvbA62Hz</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Rails gen ra Ä‘á»‘ng trÃªn nhÆ° nÃ o váº­y?</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">https://github.com/rails/rails/blob/e2585a21e389967322a98b46a7b3643d82bd9c28/activerecord/lib/active_record/railties/databases.rake#L554-L566</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">puts &lt;&lt;~MSG</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Add this entry to the credentials of the target environment:#{&#x27; &#x27;}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  active_record_encryption:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    primary_key: #{SecureRandom.alphanumeric(32)}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    deterministic_key: #{SecureRandom.alphanumeric(32)}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    key_derivation_salt: #{SecureRandom.alphanumeric(32)}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">MSG</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Náº¿u ai chÆ°a biáº¿t thÃ¬ Ä‘Ã¢y lÃ  <a href="https://ruby-doc.org/stdlib-3.0.1/libdoc/securerandom/rdoc/SecureRandom.html" target="_blank" rel="noopener noreferrer">standard lib cá»§a Ruby</a>, Ä‘Æ¡n thuáº§n lÃ ... random mÃ  thÃ´i =))</p><p>Tháº¿ Ä‘á»‘ng key nÃ y Ä‘á»ƒ lÃ m gÃ¬? á» má»¥c <a href="https://edgeguides.rubyonrails.org/active_record_encryption.html#setup" target="_blank" rel="noopener noreferrer">Setup</a> cá»§a guide, Rails cÅ©ng Ä‘Ã£ gá»£i Ã½ cho ta, Ä‘á»‘ng nÃ y dÃ¹ng cho AES.</p><blockquote><p>this will be used to derive the AES 32 bytes key</p></blockquote><p>Váº­y AES lÃ  cÃ¡i khá»‰ má»‘c gÃ¬? Theo <a href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard" target="_blank" rel="noopener noreferrer">wiki</a>, AES lÃ  viáº¿t táº¯t cá»§a <strong>A</strong>dvanced <strong>E</strong>ncryption <strong>S</strong>tandard. Hay cÃ²n Ä‘Æ°á»£c biáº¿t Ä‘áº¿n vá»›i cÃ¡i tÃªn Rijndael. AES lÃ  1 chuáº©n mÃ£ hoÃ¡, sá»­ dá»¥ng symmetric encryption. AES ráº¥t phá»• biáº¿n ngÃ y nay.</p><p>Tháº¿ báº¥t nÃ o mÃ  láº¡i Ä‘áº» ra thÃªm nhiá»u thuáº­t ngá»¯ háº¡i nÃ£o hÆ¡n váº­y =)) Cá»© tá»« tá»« rá»“i khoai sáº½ nhá»«, chÃºng ta sáº½ tÃ¬m hiá»ƒu tiáº¿p.</p><p>TrÆ°á»›c háº¿t thÃ¬, tháº¿ nÃ o lÃ  mÃ£ hoÃ¡? VÃ­ dá»¥ nhÆ° á»Ÿ 1 diá»…n Ä‘Ã n nÃ o Ä‘Ã³ ngÆ°á»i ta share nhau hoÃ ng thuá»³ link báº±ng Ä‘á»‘ng kÃ­ tá»± nÃ y</p><blockquote><p>68747470733A2F2F7777772E676F6F676C652E636F6D2E766E2F</p></blockquote><p>thay vÃ¬ huá»µch toáº¹t ra lÃ  má»™t Ä‘Æ°á»ng link <del>Ä‘á»“i truá»µ</del> nÃ o Ä‘Ã³. NhÆ°ng do viá»‡c giáº£i mÃ£ quÃ¡ Ä‘Æ¡n giáº£n, cá»¥ thá»ƒ lÃ  dÃ¹ng mÃ£ HEX, nÃªn Ä‘Ã¢y chá»‰ lÃ  encode/decode sang 1 dáº¡ng dá»¯ liá»‡u khÃ¡c mÃ  thÃ´i, vÃ  viá»‡c chuyá»ƒn Ä‘á»•i thÆ°á»ng khÃ¡ nhanh. CÃ¡c báº¡n cÃ³ thá»ƒ vÃ o Ä‘Ã¢y <a href="https://www.convertstring.com/vi/EncodeDecode/HexDecode" target="_blank" rel="noopener noreferrer">Ä‘Ã¢y</a> Ä‘á»ƒ decode chuá»—i huyá»n bÃ­ trÃªn.</p><p>CÃ²n encrypt vÃ  decrypt dÃ¹ng trong cryptography nÃ³ á»Ÿ 1 táº§m cao khÃ¡c. ThÃ´ng thÆ°á»ng sáº½ cÃ³ thÃªm 1 key (hoáº·c 1 cáº·p key public/private). Khi Ä‘Ã³ input sáº½ lÃ  key + data. VÃ  output sáº½ lÃ  1 chuá»—i nÃ o Ä‘Ã³, chuá»—i nÃ y cá»±c kÃ¬ khÃ³ Ä‘á»ƒ giáº£i mÃ£ náº¿u khÃ´ng náº¯m trong tay key. ThÃ´ng thÆ°á»ng thÃ¬ pháº£i cho cháº¡y thuáº­t toÃ¡n vÃ©t cáº¡n - tá»©c lÃ  thá»­ tá»«ng key má»™t, vÃ  viá»‡c nÃ y cáº§n Ä‘áº¿n hÃ ng triá»‡u nÄƒm Ä‘á»‘i vá»›i cáº£ siÃªu mÃ¡y tÃ­nh.</p><ul><li>Vá»›i thuáº­t toÃ¡n dÃ¹ng 1 key cho cáº£ viá»‡c encrypt láº«n decrypt thÃ¬ sáº½ Ä‘Æ°á»£c gá»i lÃ  <strong>symmetric encryption</strong></li></ul><p><img alt="symmetric" src="/assets/images/symmetric-encryption-c4990731ab3014224c16d7235e908fbe.png"></p><ul><li>Thuáº­t toÃ¡n dÃ¹ng 1 cáº·p key, trong Ä‘Ã³ public key Ä‘á»ƒ mÃ£ hoÃ¡, cÃ²n private key Ä‘á»ƒ giáº£i mÃ£, Ä‘Æ°á»£c gá»i lÃ  <strong>asymmetric encryption</strong></li></ul><p><img alt="asymmetric" src="/assets/images/asymmetric-encryption-76191effbf7bf88a765cf47ab256a20d.png"></p><p><a href="https://hackernoon.com/symmetric-and-asymmetric-encryption-5122f9ec65b1" target="_blank" rel="noopener noreferrer">Image source</a></p><p>Quay láº¡i vá»›i AES, nÃ³ dÃ¹ng symmetric, nÃªn sáº½ dÃ¹ng 1 key cho cáº£ viá»‡c mÃ£ hoÃ¡ láº«n giáº£i mÃ£. AES key cÃ³ Ä‘á»™ dÃ i lÃ  128, 192, hoáº·c 256 bit. Tuá»³ vÃ o Ä‘á»™ dÃ i key nÃ³ sáº½ cÃ³ tÃªn khÃ¡c nhau AES-128, AES-192, AES-256. Key cÃ ng dÃ i thÃ¬ viá»‡c xá»­ lÃ½ cÃ ng lÃ¢u, nhÆ°ng Ä‘á»•i láº¡i cÃ ng báº£o máº­t hÆ¡n. Máº·c Ä‘á»‹nh Rails sá»­ dá»¥ng key cÃ³ Ä‘á»™ dÃ i 256 bit (32 bytes)</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">https://github.com/rails/rails/blob/e2585a21e389967322a98b46a7b3643d82bd9c28/activerecord/lib/active_record/encryption/cipher/aes256_gcm.rb#L16</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">CIPHER_TYPE = &quot;aes-256-gcm&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Vá» viá»‡c lÃ m tháº¿ nÃ o Ä‘á»ƒ AES mÃ£ hoÃ¡/giáº£i mÃ£ thÃ¬ mÃ¬nh sáº½ khÃ´ng Ä‘á» cáº­p táº¡i Ä‘Ã¢y <del>vÃ¬ mÃ¬nh cÅ©ng khÃ´ng cÃ³ hiá»ƒu máº¥y =))</del>, náº¿u ai muá»‘n tÃ¬m hiá»ƒu thÃªm cÃ³ thá»ƒ xem link <a href="https://www.youtube.com/watch?v=lnKPoWZnNNM" target="_blank" rel="noopener noreferrer">nÃ y</a>, hoáº·c gÃºc gá»“ ~~. á» dÆ°á»›i lÃ  báº£n preview, trÃ´ng cÃ¡i thuáº­t toÃ¡n nÃ³ nÃ´m na nhÆ° sau</p><p>AES sáº½ chia nhá» input thÃ nh tá»«ng block Ä‘á»ƒ xá»­ lÃ½</p><p><img alt="block-cipher" src="/assets/images/aes-block-cipher-ba94fcb32b74eafd7a18ddbb9374e1e2.png"></p><p><img alt="flow" src="/assets/images/aes-flow-3601bffc1d50d478fe633836df3bf026.jpeg"></p><p><img alt="round" src="/assets/images/aes-round-06e45529741ace75731d96822323cb45.jpeg"></p><p><a href="https://www.tutorialspoint.com/cryptography/advanced_encryption_standard.htm" target="_blank" rel="noopener noreferrer">Image Source</a></p><p>CÆ¡ mÃ  chá»‰ quan tÃ¢m lÃ  má»™t chuá»—i Ä‘áº§u vÃ o + 1 key, Ä‘i qua Ä‘á»‘ng black magic rá»“i trá»Ÿ thÃ nh 1 chuá»—i báº£o máº­t siÃªu háº¡ng lÃ  quÃ¡ Ä‘á»§ cho má»™t cuá»™c tÃ¬nh rá»“i.</p><p>Ã€ mÃ  nhÃ¬n cÃ¡i constant Rails define á»Ÿ trÃªn kia, láº¡i cÃ³ thÃªm cÃ¡i gÃ¬ á»Ÿ cuá»‘i chuá»—i tháº¿ nhá»‰. <code>gcm</code>???? Bá»‘i rá»‘i again.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="gcm"></a>GCM<a class="hash-link" href="#gcm" title="Direct link to heading">#</a></h2><p>GCM lÃ  viáº¿t táº¯t cá»§a <strong>G</strong>alois/<strong>C</strong>ounter <strong>M</strong>ode... Nghe xong hiá»ƒu cháº¿t liá»n .__. MÃ² thá»­ xem nÃ o!</p><p>NhÆ° tÃªn gá»i cá»§a nÃ³, GCM lÃ  má»™t <em>mode</em> trong symmetric encryption, káº¿t há»£p cá»§a <strong>Counter Mode</strong> vÃ  <strong>Galois Mode</strong>, dÃ¹ng cho mÃ£ hoÃ¡ dáº¡ng khá»‘i (block). Váº­y thÃ¬ AES Ä‘i vá»›i GCM lÃ  chuáº©n bÃ i rá»“i nhá»‰.</p><p>NgoÃ i GCM ra cÃ²n cÃ¡c mode khÃ¡c nhÆ° CCM, SIV, ...vÃ¢n vÃ¢n mÃ¢y mÃ¢y. CÃ¡c báº¡n cÃ³ thá»ƒ xem thÃªm táº¡i <a href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation" target="_blank" rel="noopener noreferrer">Ä‘Ã¢y</a></p><p>TrÆ°á»›c tiÃªn ta hÃ£y báº¯t Ä‘áº§u tá»« <strong>mode</strong>, tá»« nÃ y náº±m trong <strong>Mode of Operation</strong>. CÃ¡c mode sáº½ Ä‘Æ°á»£c apply trÃªn tá»«ng block data (nhÆ° Ä‘Ã£ nÃ³i á»Ÿ trÃªn thÃ¬ AES chia data thÃ nh cÃ¡c block nhá» vÃ  mÃ£ hoÃ¡), giÃºp cho output cá»§a viá»‡c mÃ£ hoÃ¡ block báº£o máº­t hÆ¡n.</p><p>Counter mode sá»­ dá»¥ng 1 sá»‘ integer lÃ m counter, qua tá»«ng block counter sáº½ tÄƒng lÃªn 1. á» má»—i block, sá»‘ nÃ y sáº½ Ä‘Æ°á»£c mÃ£ hoÃ¡ cÃ¹ng vá»›i data Ä‘á»ƒ cÃ³ Ä‘Æ°á»£c output báº£o máº­t hÆ¡n.</p><p><img alt="counter-mode" src="/assets/images/ctr-mode-2014a29f09bb87b5f9d8ccefab9d6cb9.png"></p><p>Galois Mode lÃ  má»™t authentication mode. Galois Mode giÃºp Ä‘áº£m báº£o ráº±ng cipher output cá»§a ta khÃ´ng bá»‹ chá»‰nh sá»­a bá»Ÿi má»™t bÃªn thá»© 3. Hoáº¡t Ä‘á»™ng nhÆ° nÃ o thÃ¬ mÃ¬nh chá»‹u Ã  =))</p><p>Káº¿t há»£p 2 mode trÃªn vÃ  ta cÃ³ GCM, giÃºp thuáº­t toÃ¡n mÃ£ hoÃ¡ cá»§a ta báº£o máº­t hÆ¡n, Ä‘á»“ng thá»i Ä‘áº£m báº£o Ä‘Æ°á»£c tÃ­nh toÃ n váº¹n cá»§a dá»¯ liá»‡u.</p><p><img alt="gcm-mode" src="/assets/images/gcm-mode-e5c2e6aa4299003be322c78d1a8b0d93.png"></p><p>BÃªn trÃªn lÃ  giáº£i thÃ­ch sÆ¡ qua vá» thuáº­t toÃ¡n mÃ£ hoÃ¡ mÃ  Rails sá»­ dá»¥ng, náº¿u cÃ³ sai sÃ³t thÃ¬ cÅ©ng Ä‘á»«ng gáº¡ch Ä‘Ã¡ tá»™i mÃ¬nh =))</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="aes-256-gcm-meets-rails"></a>AES-256-GCM meets Rails<a class="hash-link" href="#aes-256-gcm-meets-rails" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="encryption-key"></a>Encryption Key<a class="hash-link" href="#encryption-key" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yml"><div tabindex="0" class="prism-code language-yml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">active_record_encryption</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">primary_key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> EGY8WhulUOXixybod7ZWwMIL68R9o5kC</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">deterministic_key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> aPA5XyALhf75NNnMzaspW7akTfZp0lPY</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">key_derivation_salt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> xEY0dt6TZcAMg52K7O84wYzkjvbA62Hz</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Quay trá»Ÿ láº¡i vá»›i Ä‘á»‘ng key, hÃ£y cÃ¹ng mÃ² code Ä‘Ã¡y bá»ƒ xem chÃºng dáº«n ta tá»›i Ä‘Ã¢u :v</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/9c091b4fd378df515c4c31b85bb6a968463a1d82/activerecord/lib/active_record/railtie.rb#L313-L317</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ActiveRecord::Encryption.configure \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  primary_key: app.credentials.dig(:active_record_encryption, :primary_key),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  deterministic_key: app.credentials.dig(:active_record_encryption, :deterministic_key),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  key_derivation_salt: app.credentials.dig(:active_record_encryption, :key_derivation_salt),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  **config.active_record.encryption</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/9c091b4fd378df515c4c31b85bb6a968463a1d82/activerecord/lib/active_record/encryption/configurable.rb#L20-L33</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def configure(primary_key:, deterministic_key:, key_derivation_salt:, **properties)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  config.primary_key = primary_key</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  config.deterministic_key = deterministic_key</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  config.key_derivation_salt = key_derivation_salt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  context.key_provider = ActiveRecord::Encryption::DerivedSecretKeyProvider.new(primary_key)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/9c091b4fd378df515c4c31b85bb6a968463a1d82/activerecord/lib/active_record/encryption/derived_secret_key_provider.rb#L7-L9</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def initialize(passwords)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  super(Array(passwords).collect { |password| Key.derive_from(password) })</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Xem tiáº¿p class <code>Key</code> cÃ³ gÃ¬ nÃ o.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/9c091b4fd378df515c4c31b85bb6a968463a1d82/activerecord/lib/active_record/encryption/key.rb#L10-L26</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class Key</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def initialize(secret)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @secret = secret</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @public_tags = Properties.new</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def self.derive_from(password)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    secret = ActiveRecord::Encryption.key_generator.derive_key_from(password)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ActiveRecord::Encryption::Key.new(secret)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/9c091b4fd378df515c4c31b85bb6a968463a1d82/activerecord/lib/active_record/encryption/key_generator.rb#L32-L34</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def derive_key_from(password, length: key_length)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ActiveSupport::KeyGenerator.new(password).generate_key(ActiveRecord::Encryption.config.key_derivation_salt, length)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>NhÆ° váº­y, 2 trong sá»‘ 3 thanh niÃªn cá»§a ta Ä‘Ã£ bá»‹ lá»™ máº·t:</p><ul><li><code>primary_key</code> Ä‘Ã³ng vai trÃ² lÃ  <code>password</code> param cá»§a <code>ActiveSupport::KeyGenerator.new</code></li><li><code>key_derivation_salt</code> Ä‘Ã³ng vai trÃ² lÃ  tham sá»‘ thá»© nháº¥t cá»§a <code>ActiveSupport::KeyGenerator#generate_key</code></li></ul><p>HÃ£y check tiáº¿p <code>ActiveSupport::KeyGenerator</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/9c091b4fd378df515c4c31b85bb6a968463a1d82/activesupport/lib/active_support/key_generator.rb#L26-L41</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def initialize(secret, options = {})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  @secret = secret</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  @iterations = options[:iterations] || 2**16</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  @hash_digest_class = options[:hash_digest_class] || self.class.hash_digest_class</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def generate_key(salt, key_size = 64)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  OpenSSL::PKCS5.pbkdf2_hmac(@secret, salt, @iterations, key_size, @hash_digest_class.new)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Qua háº¿t wrapper cá»§a Rails rá»“i, giá» ta pháº£i mÃ² vÃ o docs cá»§a Ruby thÃ´i.
Theo <a href="https://ruby-doc.org/stdlib-3.0.1/libdoc/openssl/rdoc/OpenSSL.html#module-OpenSSL-label-Encryption" target="_blank" rel="noopener noreferrer">docs</a>, docs láº¡i báº£o hÃ m nÃ y giá» Ä‘á»•i tÃªn thÃ nh <a href="https://ruby-doc.org/stdlib-3.0.1/libdoc/openssl/rdoc/OpenSSL/KDF.html#method-c-pbkdf2_hmac" target="_blank" rel="noopener noreferrer"><code>OpenSSL::KDF.pbkdf2_hmac</code></a> máº¥t rá»“i... á»œ thÃ¬ láº¡i mÃ² vÃ o xem. NÃ´m na hÃ m nÃ y sáº½ táº¡o ra 1 cipher key dÃ¹ng cho viá»‡c mÃ£ hoÃ¡.</p><p>Táº¡i Ä‘Ã¢y, ta cÃ³ thá»ƒ káº¿t luáº­n key mÃ£ hoÃ¡ mÃ  Rails dÃ¹ng cÃ³:</p><ul><li><code>passphrase</code>: <code>primary_key</code></li><li><code>salt</code>: <code>key_derivation_salt</code></li><li><code>iterations</code>: 2^16</li><li><code>key_len</code>: Ä‘á»™ dÃ i key 32 bytes</li><li><code>digest</code>: hash algorithm SHA-1</li></ul><p>HÃ£y cÃ¹ng test qua cÃ¡i key nÃ y xem</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">irb</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">require &#x27;openssl&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cipher = OpenSSL::Cipher.new(&#x27;aes-256-gcm&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cipher.encrypt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">iv = cipher.random_iv</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pwd = &#x27;EGY8WhulUOXixybod7ZWwMIL68R9o5kC&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">salt = &#x27;xEY0dt6TZcAMg52K7O84wYzkjvbA62Hz&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">iter = 2**16</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">key_len = OpenSSL::Cipher.new(&quot;aes-256-gcm&quot;).key_len</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">digest = OpenSSL::Digest.new(&#x27;SHA1&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">key = OpenSSL::PKCS5.pbkdf2_hmac(pwd, salt, iter, key_len, digest)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cipher.key = key</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">encrypted = cipher.update &quot;hello&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">encrypted &lt;&lt; cipher.final # =&gt; &quot;\xB2#\x10\xE7n&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cipher.decrypt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cipher.iv = iv</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">decrypted = cipher.update(encrypted) # =&gt; &quot;hello&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Sau bao nhiÃªu váº¥t váº£ thÃ¬ cÅ©ng tÃ¬m Ä‘Æ°á»£c cÃ¡i key =)) Váº­y quÃ¡ trÃ¬nh mÃ£ hoÃ¡ nhÆ° tháº¿ nÃ o? Láº¡i mÃ² tiáº¿p .__.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="encryption-process"></a>Encryption Process<a class="hash-link" href="#encryption-process" title="Direct link to heading">#</a></h3><p>HÃ£y cÃ¹ng báº¯t Ä‘áº§u tá»« viá»‡c khai bÃ¡o trong model</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">app/models/article.rb</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class Article &lt; ApplicationRecord</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  encrypts :title</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Rá»“i cÃ¹ng tÃ¬m xem <code>ApplicationRecord.encrypts</code> nÃ³ lÃ m trÃ² gÃ¬ nÃ o</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tham-kháº£o"></a>Tham kháº£o<a class="hash-link" href="#tham-kháº£o" title="Direct link to heading">#</a></h2><ul><li><a href="https://edgeguides.rubyonrails.org/active_record_encryption.html" target="_blank" rel="noopener noreferrer">https://edgeguides.rubyonrails.org/active_record_encryption.html</a></li><li><a href="https://www.precisely.com/blog/data-security/aes-vs-rsa-encryption-differences" target="_blank" rel="noopener noreferrer">https://www.precisely.com/blog/data-security/aes-vs-rsa-encryption-differences</a></li><li><a href="https://www.youtube.com/watch?v=lnKPoWZnNNM" target="_blank" rel="noopener noreferrer">https://www.youtube.com/watch?v=lnKPoWZnNNM</a></li><li><a href="https://www.youtube.com/watch?v=g_eY7JXOc8U" target="_blank" rel="noopener noreferrer">https://www.youtube.com/watch?v=g_eY7JXOc8U</a></li><li><a href="https://www.includehelp.com/cryptography/mode-of-operation.aspx" target="_blank" rel="noopener noreferrer">https://www.includehelp.com/cryptography/mode-of-operation.aspx</a></li></ul></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/websocket">websocket</a><a class="margin-horiz--sm" href="/blog/tags/javascript">javascript</a><a class="margin-horiz--sm" href="/blog/tags/web">web</a></div><div class="col text--right"><a aria-label="Read more about TÃ¬m hiá»ƒu vá» Active Record Encryption" href="/blog/tim-hieu-ve-active-record-encryption"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/blog/websocket-hoat-dong-nhu-the-nao">WebSocket hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o?</a></h2><div class="margin-vert--md"><time datetime="2021-06-16T00:00:00.000Z" class="blogPostDate_fNvV">June 16, 2021 Â· 3 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="LÃª SÄ© BÃ­ch"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer">LÃª SÄ© BÃ­ch</a></h4><small class="avatar__subtitle">Ruby on Rails/React Developer</small></div></div></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="websocket-lÃ -gÃ¬"></a>WebSocket lÃ  gÃ¬<a class="hash-link" href="#websocket-lÃ -gÃ¬" title="Direct link to heading">#</a></h2><p>CÅ©ng giá»‘ng nhÆ° HTTP, WebSocket lÃ  1 protocol, hoáº¡t Ä‘á»™ng trÃªn mÃ´ hÃ¬nh client/server, vÃ  sá»­ dá»¥ng TCP connection.
LÃ  má»™t protocol, cÃ³ nghÄ©a lÃ  báº¥t ká»ƒ viá»‡c implement ra sao, nhÆ°ng server cá»© láº¯ng nghe 1 TCP port, vÃ  giao tiáº¿p giá»¯a client/server tuÃ¢n theo Ä‘Ãºng spec mÃ  WebSocket Ä‘á» ra lÃ  Ä‘Æ°á»£c.</p><p>WebSocket cho phÃ©p trao Ä‘á»•i dá»¯ liá»‡u 2 chiá»u giá»¯a client vÃ  server. Tuy nhiÃªn cháº¯c sáº½ cÃ³ nhiá»u ngÆ°á»i tháº¯c máº¯c</p><blockquote><p>Sao khÃ´ng dÃ¹ng HTTP rá»“i set interval request lÃªn, hay lÃ  server push cho Ä‘Æ¡n giáº£n. Äáº» ra láº¯m protocol lÃ m gÃ¬ Ä‘au Ä‘áº§u?</p></blockquote><p>Náº¿u sá»­ dá»¥ng HTTP, má»—i láº§n cáº­p nháº­t data má»›i thÃ¬ client láº¡i pháº£i táº¡o request HTTP, vÃ  sáº½ cÃ³ ráº¥t nhiá»u header dÆ° thá»«a, gÃ¢y lÃ£ng phÃ­ bÄƒng thÃ´ng, vÃ  viá»‡c khá»Ÿi táº¡o request cÅ©ng máº¥t thÃªm 1 chÃºt thá»i gian. Trong khi Ä‘Ã³ WebSocket, sau khi client vÃ  server <em>say hello</em> vá»›i nhau, TCP connection sáº½ váº«n alive, vÃ  chÃºng sáº½ giao lÆ°u káº¿t há»£p vá»›i nhau qua connection Ä‘Ã³ mÃ  khÃ´ng cáº§n thÃªm nhá»¯ng thÃ´ng tin dÆ° thá»«a nhÆ° header. VÃ  cÃ³ láº½ cÃ²n nhiá»u lá»£i Ã­ch ná»¯a, nhÆ°ng mÃ¬nh khÃ´ng biáº¿t =))</p><p>Khen tháº¿ Ä‘á»§ rá»“i, hÃ£y thá»­ tÃ¬m hiá»ƒu xem WebSocket ngang dá»c ra sao.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="cÃ¡ch-hoáº¡t-Ä‘á»™ng-cá»§a-websocket"></a>CÃ¡ch hoáº¡t Ä‘á»™ng cá»§a WebSocket<a class="hash-link" href="#cÃ¡ch-hoáº¡t-Ä‘á»™ng-cá»§a-websocket" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tiá»n-Ä‘á»"></a>Tiá»n Ä‘á»<a class="hash-link" href="#tiá»n-Ä‘á»" title="Direct link to heading">#</a></h3><p>VÃ­ dá»¥ vá»›i á»©ng dá»¥ng máº¡ng xÃ£ há»™i, ta cÃ³ 1 tÃ­nh nÄƒng chat. Má»—i khi báº­t chat vá»›i 1 ngÆ°á»i, 1 WebSocket tá»›i webserver cá»§a ta sáº½ Ä‘Æ°á»£c khá»Ÿi táº¡o. NhÆ° váº­y, ta Ä‘ang cÃ³ 1 webserver, vÃ  Ä‘ang cáº§n 1 websocket connection tá»›i webserver Ä‘Ã³. Máº·t khÃ¡c viá»‡c sá»­ dá»¥ng raw TCP trÃªn client cÅ©ng ráº¥t háº¡n cháº¿. ChÃ­nh vÃ¬ váº­y, WebSocket Ä‘Ã£ táº­n dá»¥ng luÃ´n port 80/443 cá»§a HTTP(S) Ä‘á»ƒ khá»Ÿi táº¡o connection.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="handshaking"></a>Handshaking<a class="hash-link" href="#handshaking" title="Direct link to heading">#</a></h3><p>Khi khá»Ÿi táº¡o connection, client sáº½ táº¡o 1 HTTP request Ä‘á»ƒ thá»±c hiá»‡n <em>handshake</em> vá»›i server</p><p><img alt="handshake" src="/assets/images/websocket-handshake-adc15c177bb901fb7fb81d48ac042d27.jpeg"></p><ul><li><p>TrÆ°á»›c tiÃªn client sáº½ gá»­i request tá»›i endpoint mÃ  websocket server Ä‘ang láº¯ng nghe. vÃ­ dá»¥ nhÆ° <code>/chat</code>.
Request sáº½ kÃ¨m theo 1 vÃ i header mÃ  WebSocket protocol quy Ä‘á»‹nh: <code>Sec-WebSocket-Key</code>, <code>Sec-WebSocket-Version</code>, <code>Upgrade</code>, <code>Connection</code>, ... vÃ  nhá»¯ng header cÆ¡ báº£n cá»§a 1 HTTP request khÃ¡c ná»¯a.</p></li><li><p>WebSocket server sáº½ tiáº¿p nháº­n request, authen (náº¿u cÃ³), náº¿u khÃ´ng há»£p lá»‡ sáº½ tráº£ vá» <code>400 Bad Request</code> vÃ  terminate connection Ä‘Ã³.
NgÆ°á»£c láº¡i náº¿u OK, server sáº½ tráº£ vá» <code>101 Switching Protocols</code> cÃ¹ng vá»›i header <code>Sec-WebSocket-Accept</code>. Connection Ä‘Ã³ sáº½ Ä‘Æ°á»£c giá»¯, vÃ  sau Ä‘Ã³ client vÃ  server báº¯t Ä‘áº§u trao Ä‘á»•i thÃ´ng tin qua láº¡i vá»›i nhau.</p></li></ul><p>GiÃ¡ trá»‹ cá»§a <code>Sec-WebSocket-Accept</code> Ä‘Æ°á»£c quy Ä‘á»‹nh nhÆ° sau:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly txt"><div tabindex="0" class="prism-code language-txt codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Sec-WebSocket-Accept = Base64( SHA1 ( Sec-WebSocket-Key + 258EAFA5-E914-47DA-95CA-C5AB0DC85B11 ) )</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>258EAFA5-E914-47DA-95CA-C5AB0DC85B11</code> cÃ²n Ä‘Æ°á»£c gá»i lÃ  <em>magic string</em></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="trao-Ä‘á»•i-dá»¯-liá»‡u"></a>Trao Ä‘á»•i dá»¯ liá»‡u<a class="hash-link" href="#trao-Ä‘á»•i-dá»¯-liá»‡u" title="Direct link to heading">#</a></h3><p>Viá»‡c trao Ä‘á»•i dá»¯ liá»‡u giá»¯a client vÃ  server khÃ¡ lÃ  háº¡i nÃ£o, cá»¥ thá»ƒ viá»‡c decode message, hay format message cÃ³ thá»ƒ xem thÃªm táº¡i <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_servers#exchanging_data_frames" target="_blank" rel="noopener noreferrer">Ä‘Ã¢y</a>. Giá»¯ chá»— Ä‘á»ƒ sau nÃ y náº¿u khÃ´ng <del>lÆ°á»i</del> báº­n quay láº¡i tÃ¬m hiá»ƒu sau =))</p><p>Trong quÃ¡ trÃ¬nh connection Ä‘Æ°á»£c keep alive, sáº½ cÃ³ ráº¥t nhiá»u request ping giá»¯a client/server Ä‘á»ƒ kiá»ƒm tra xem phÃ­a bÃªn kia cÃ²n active hay khÃ´ng. BÃªn gá»­i ping, bÃªn nháº­n pong, váº«n cÃ²n sá»‘ng thÃ¬ ta láº¡i giao lÆ°u káº¿t há»£p tiáº¿p. CÃ²n khÃ´ng thÃ¬ server/client sáº½ biáº¿t Ä‘á»ƒ terminate inactive connection Ä‘Ã³ Ä‘i.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tham-kháº£o"></a>Tham kháº£o<a class="hash-link" href="#tham-kháº£o" title="Direct link to heading">#</a></h2><ul><li><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_servers" target="_blank" rel="noopener noreferrer">https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_servers</a></p></li><li><p><a href="https://stackoverflow.com/questions/50197453/how-long-can-a-websocket-connection-last" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/questions/50197453/how-long-can-a-websocket-connection-last</a></p></li><li><p><a href="https://datatracker.ietf.org/doc/html/rfc6455" target="_blank" rel="noopener noreferrer">https://datatracker.ietf.org/doc/html/rfc6455</a></p></li></ul></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/websocket">websocket</a><a class="margin-horiz--sm" href="/blog/tags/javascript">javascript</a><a class="margin-horiz--sm" href="/blog/tags/web">web</a></div><div class="col text--right"><a aria-label="Read more about WebSocket hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o?" href="/blog/websocket-hoat-dong-nhu-the-nao"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/blog/cung-tim-hieu-ve-actiontext-trong-rails-6">CÃ¹ng tÃ¬m hiá»ƒu vá» ActionText trong Rails 6</a></h2><div class="margin-vert--md"><time datetime="2019-07-20T00:00:00.000Z" class="blogPostDate_fNvV">July 20, 2019 Â· 11 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="LÃª SÄ© BÃ­ch"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer">LÃª SÄ© BÃ­ch</a></h4><small class="avatar__subtitle">Ruby on Rails/React Developer</small></div></div></header><div class="markdown"><p>Rails 6 Ä‘Ã£ bÆ°á»›c vÃ o giai Ä‘oáº¡n beta vá»›i phiÃªn báº£n <a href="https://github.com/rails/rails/releases/tag/v6.0.0.rc1" target="_blank" rel="noopener noreferrer">v6.0.0.rc1</a>. RC lÃ  viáº¿t táº¯t cá»§a <strong>R</strong>elease <strong>C</strong>andidate, Ä‘Ã¢y lÃ  phiÃªn báº£n mÃ  cÃ³ xÃ¡c suáº¥t trá»Ÿ thÃ nh final release ráº¥t cao. Ta cÃ³ thá»ƒ Ã¡p dá»¥ng nÃ³ vÃ o dá»± Ã¡n ngay ká»ƒ tá»« bÃ¢y giá» mÃ  khÃ´ng cáº§n lo sá»£ cÃ³ nhá»¯ng breaking change.</p><p>Náº¿u báº¡n sá»­ dá»¥ng Docker, mÃ¬nh khuyÃªn nÃªn sá»­ dá»¥ng ruby 2.6.3, vÃ¬ trÆ°á»›c Ä‘Ã¢y mÃ¬nh Ä‘Ã£ dÃ¹ng thá»­ ruby:2.7.0-preview1-alpine3.10 thÃ¬ khÃ¡ nhiá»u lá»—i khi up server, mÃ  cháº£ biáº¿t pháº£i fix sao :sad:</p><p>á» Rails 6, cÃ³ khÃ¡ nhiá»u tÃ­nh nÄƒng má»›i hay ho:</p><ul><li>Action Text</li><li>Parallel Testing</li><li>Action Model custom error message format.</li><li>vÃ¢n vÃ¢n mÃ¢y mÃ¢y...</li></ul><p>á» bÃ i nÃ y, mÃ¬nh sáº½ chá»‰ táº­p trung Ä‘á» cáº­p tá»›i Action Text. ÄÃ¢y lÃ  má»™t package giÃºp ta xÃ¢y dá»±ng WYSIWYG editor má»™t cÃ¡ch nhanh chÃ³ng, hÆ¡n ná»¯a, viá»‡c upload cÅ©ng Ä‘Æ°á»£c integrate vá»›i Active Storage.</p><p><strong>ChÃº Ã½:</strong> BÃ i khÃ¡ dÃ i vÃ  embed nhiá»u code :v</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="cÃ¡ch-dÃ¹ng"></a>CÃ¡ch dÃ¹ng<a class="hash-link" href="#cÃ¡ch-dÃ¹ng" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="cÃ i-Ä‘áº·t-vÃ -sá»­-dá»¥ng"></a>CÃ i Ä‘áº·t vÃ  sá»­ dá»¥ng<a class="hash-link" href="#cÃ i-Ä‘áº·t-vÃ -sá»­-dá»¥ng" title="Direct link to heading">#</a></h2><p>VÃ¬ lÃ  Rails nÃªn cÃ¡ch sá»­ dá»¥ng ráº¥t Ä‘Æ¡n giáº£n, nhÆ°ng ta sáº½ cháº£ biáº¿t nÃ³ cháº¡y cÃ¡i gÃ¬ Ä‘áº±ng sau cáº£ =))</p><p>CÃ i Ä‘áº·t Action Text báº±ng CLI command sau:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">rails action_text:install</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Nhá»› hÃ£y cháº¡y thÃªm cáº£ command install Active Storage ná»¯a.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">rails active_storage:install</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Äá»ƒ Ã¡p dá»¥ng cho field <code>content</code> cá»§a model <code>Post</code>, ta sáº½ dÃ¹ng tá»›i macro <code>has_rich_text</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class CreatePosts &lt; ActiveRecord::Migration[6.0]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def change</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    create_table :posts do |t|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.string :content</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.string :category</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.timestamps</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>content</code> á»Ÿ Ä‘Ã¢y mÃ¬nh dÃ¹ng string, nhÆ°ng khuyáº¿n khÃ­ch dÃ¹ng text hÆ¡n.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class Post &lt; ApplicationRecord</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    has_rich_text :content</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>TrÃªn form, ta chá»‰ viá»‡c dÃ¹ng <code>rich_text_area</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly erb"><div tabindex="0" class="prism-code language-erb codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;%= form_with(model: @post) do |form| %&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;div class=&quot;field&quot;&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;%= form.label :content %&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;%= form.rich_text_area :content %&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;/div&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;% end %&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Khi permit params, ta cÅ©ng lÃ m nhÆ° bao field khÃ¡c</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class PostsController &lt; ApplicationController</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def post_params</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    params.require(:post).permit(:category, :content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Cuá»‘i cÃ¹ng ta hiá»ƒn thá»‹ dá»¯ liá»‡u nhÆ° sau:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly erb"><div tabindex="0" class="prism-code language-erb codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;%= @post.content %&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>CÃ¢u lá»‡nh trÃªn thá»±c cháº¥t Ä‘ang ngáº§m gá»i tá»›i <code>@post.content.to_s</code></p><p>ÄÃ¢y lÃ  sáº£n pháº©m cá»§a ta:</p><p>Form táº¡o post vá»›i WYSIWYG editor - Sá»­ dá»¥ng Trix editor, do Basecamp phÃ¡t triá»ƒn, cÃ¢y nhÃ  lÃ¡ vÆ°á»n luÃ´n.</p><p>CÃ³ thá»ƒ kÃ©o tháº£ file vÃ o, file Ä‘Ã³ sáº½ Ä‘Æ°á»£c upload báº±ng Active Storage.</p><p><img src="https://images.viblo.asia/77b9bd23-5ba3-426b-b6fc-cac02edb0b42.png"></p><p>Hiá»ƒn thá»‹ dá»¯ liá»‡u á»Ÿ mÃ n hÃ¬nh detail</p><p><img src="https://images.viblo.asia/6b1b8da0-ca7f-468b-9705-444a8cb2d736.png"></p><p>CÃ¡c báº¡n tháº¥y sao? CÃ¡ nhÃ¢n mÃ¬nh tháº¥y xáº¥u nhÆ° cá» hÃ³ váº­y =)) Tuy nhiÃªn ta cÃ³ thá»ƒ styling cho nÃ³.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="styling"></a>Styling<a class="hash-link" href="#styling" title="Direct link to heading">#</a></h2><p>Rails Ä‘ang cÃ³ sáºµn má»™t vÃ i style cÆ¡ báº£n cho nÃ³ trong file <code>app/assets/stylesheets/actiontext.scss</code>, ta cÃ³ thá»ƒ sá»­a nÃ³ Ä‘á»ƒ cho Ä‘áº¹p hÆ¡n.</p><p>Vá»›i Ä‘á»‘ng tool cá»§a editor thÃ¬ cÃ³ thá»ƒ dÃ¹ng selector <code>.trix-button-row</code></p><p>Vá»›i template attachment (nhÆ° cÃ¡i <code>monaco.ttf</code> á»Ÿ trÃªn), ta cÅ©ng cÃ³ thá»ƒ custom láº¡i, Rails cung cáº¥p sáºµn template máº·c Ä‘á»‹nh á»Ÿ file <code>app/views/active_storage/blobs/_blob.html.erb</code></p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tÃ¬m-hiá»ƒu-sá»±-ma-giÃ¡o"></a>TÃ¬m hiá»ƒu sá»± ma giÃ¡o<a class="hash-link" href="#tÃ¬m-hiá»ƒu-sá»±-ma-giÃ¡o" title="Direct link to heading">#</a></h1><p>Rá»“i ta Ä‘Ã£ lÆ°á»›t qua cÃ¡ch sá»­ dá»¥ng nÃ³, nhÆ°ng mÃ  cÃ³ quÃ¡ nhiá»u magic.</p><p>Liá»‡u báº¡n cÃ³ tá»± Ä‘áº·t ra nhá»¯ng cÃ¢u há»i tháº¿ nÃ y hay khÃ´ng?</p><ul><li><p>KhÃ´ng biáº¿t cÃ¡ch lÆ°u trá»¯ dá»¯ liá»‡u cá»§a nÃ³ nhÆ° tháº¿ nÃ o?</p></li><li><p>LÃ m sao mÃ  cÃ¡i file trong kia integrate Ä‘Æ°á»£c vá»›i Active Storage?</p></li><li><p>VÃ¬ sao láº¡i cÃ³ thá»ƒ custom láº¡i nhá»¯ng attachment báº±ng template?</p></li><li><p>vÃ¢n vÃ¢n mÃ¢y mÃ¢y...</p></li></ul><p>Ta sáº½ báº¯t tay vÃ o tÃ¬m hiá»ƒu nÃ³.</p><p>HÃ£y báº¯t Ä‘áº§u vá»›i <code>has_rich_text</code></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="macro-has_rich_text"></a>Macro <code>has_rich_text</code><a class="hash-link" href="#macro-has_rich_text" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/6a5c8b91998c56e50b5cc934d968947cd319f735/actiontext/lib/action_text/attribute.rb#L26</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def has_rich_text(name)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  class_eval &lt;&lt;-CODE, __FILE__, __LINE__ + 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    def #{name}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      rich_text_#{name} || build_rich_text_#{name}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    def #{name}=(body)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      self.#{name}.body = body</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  CODE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  has_one :&quot;rich_text_#{name}&quot;, -&gt; { where(name: name) },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    class_name: &quot;ActionText::RichText&quot;, as: :record, inverse_of: :record, autosave: true, dependent: :destroy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  # ... codes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Dá»… dÃ ng tháº¥y ráº±ng Ä‘Ã¢y lÃ  1 macro giÃºp Ä‘á»‹nh nghÄ©a getter, setter, vÃ  cáº£ association <code>has_one :rich_text_...</code> vá»›i <code>ActionText::RichText</code>.</p><p>Váº­y thÃ¬ khi ta gá»i <code>@post.content</code>, thá»±c cháº¥t lÃ  ta Ä‘ang gá»i tá»›i <code>@post.rich_text_content</code>.</p><p>VÃ  nÃ³ cÅ©ng chá»‰ ra 1 Ä‘iá»u ná»¯a lÃ  Rails dÃ¹ng 1 báº£ng riÃªng Ä‘á»ƒ lÆ°u láº¡i Ä‘á»‘ng rich text cá»§a ta.</p><p>HÃ£y dÃ nh chÃºt thá»i gian nhÃ¬n vÃ o thÆ° má»¥c <code>db/migrate</code>, ta sáº½ tháº¥y file sau:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># db/migrate/20190718085159_create_action_text_tables.action_text.rb</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># This migration comes from action_text (originally 20180528164100)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class CreateActionTextTables &lt; ActiveRecord::Migration[6.0]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def change</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    create_table :action_text_rich_texts do |t|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.string     :name, null: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.text       :body, size: :long</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.references :record, null: false, polymorphic: true, index: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.timestamps</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.index [ :record_type, :record_id, :name ], name: &quot;index_action_text_rich_texts_uniqueness&quot;, unique: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Quáº£ tháº­t lÃ  váº­y, <code>body</code> chÃ­nh lÃ  nÆ¡i lÆ°u trá»¯ Ä‘á»‘ng text cá»§a ta, cÃ²n <code>name</code>, <code>record_id</code>, vÃ  <code>record_type</code> lÃ  nhá»¯ng attribute cho polymorphic association, khÃ¡ quen thuá»™c náº¿u báº¡n Ä‘Ã£ dÃ¹ng Active storage</p><p>Ta sáº½ Ä‘i Ä‘áº¿n bÆ°á»›c tiáº¿p theo <code>rich_text_area</code></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="rails-xá»­-lÃ½-lÆ°u-trá»¯-rich-text-nhÆ°-tháº¿-nÃ o"></a>Rails xá»­ lÃ½, lÆ°u trá»¯ rich text nhÆ° tháº¿ nÃ o?<a class="hash-link" href="#rails-xá»­-lÃ½-lÆ°u-trá»¯-rich-text-nhÆ°-tháº¿-nÃ o" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/cc1a5d5620c4cd952b27f6c1bbd16d8780a34d0e/actiontext/app/helpers/action_text/tag_helper.rb#L20</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def rich_text_area_tag(name, value = nil, options = {})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  options = options.symbolize_keys</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  options[:input] ||= &quot;trix_input_#{ActionText::TagHelper.id += 1}&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  options[:class] ||= &quot;trix-content&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  options[:data] ||= {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  options[:data][:direct_upload_url] = main_app.rails_direct_uploads_url</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  options[:data][:blob_url_template] = main_app.rails_service_blob_url(&quot;:signed_id&quot;, &quot;:filename&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  editor_tag = content_tag(&quot;trix-editor&quot;, &quot;&quot;, options)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  input_tag = hidden_field_tag(name, value, id: options[:input])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  input_tag + editor_tag</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>CÃ³ thá»ƒ tháº¥y Ä‘Æ¡n giáº£n nÃ³ chá»‰ init cÃ¡i trix editor cho ta thÃ´i.</p><p>Viá»‡c kÃ©o tháº£ file, upload hoÃ n toÃ n Ä‘Æ°á»£c handle bá»Ÿi trix editor, ta khÃ´ng custom Ä‘Æ°á»£c template sau khi file upload thÃ nh cÃ´ng.</p><p>Tuy nhiÃªn Action Text cÃ³ thÃªm 1 callback sau khi file Ä‘Æ°á»£c upload thÃ nh cÃ´ng:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// https://github.com/rails/rails/blob/cc1a5d5620c4cd952b27f6c1bbd16d8780a34d0e/actiontext/app/javascript/actiontext/attachment_upload.js#L26</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">attachment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setAttributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sgid</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> attributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">attachable_sgid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  url</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">createBlobUrl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">attributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">signed_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> attributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">filename</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Ä‘Ã¢y lÃ  1 step ráº¥t quan trá»ng, nhÆ°ng ta sáº½ chÆ°a cáº§n chÃº Ã½ tá»›i nÃ³ vá»™i. Attachment cá»§a ta sau khi upload thÃ nh cÃ´ng sáº½ trÃ´ng nhÆ° sau:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly html"><div tabindex="0" class="prism-code language-html codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">contenteditable</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">false</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">data-trix-attachment</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&#x27;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">{</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">contentType</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">:</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">application/zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">,</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">filename</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">:</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">monaco.ttf-master.zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">,</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">filesize</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">:88996,</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">sgid</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">:</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">BAh7CEkiCGdpZAY6BkVUSSIvZ2lkOi8vYXBwL0FjdGl2ZVN0b3JhZ2U6OkJsb2IvOD9leHBpcmVzX2luBjsAVEkiDHB1cnBvc2UGOwBUSSIPYXR0YWNoYWJsZQY7AFRJIg9leHBpcmVzX2F0BjsAVDA=--79d2aa5a0af367233a5420a4f0ae02657d3910ab</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">,</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">url</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">:</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">http://localhost:60100/rails/active_storage/blobs/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBEUT09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--e79bebbfa0f10319d319411c129291d12e752d22/monaco.ttf-master.zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">}</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&#x27;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">data-trix-content-type</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">application/zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">data-trix-id</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">1108</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment attachment--file attachment--zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__caption</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__name</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">monaco.ttf-master.zip</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__size</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">86.91 KB</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Tiáº¿p Ä‘áº¿n lÃ  submit dá»¯ liá»‡u, váº­y Rails sáº½ gá»­i gÃ¬ lÃªn?</p><p>ÄÆ¡n giáº£n lÃ  Rails sáº½ gá»­i táº¥t cáº£ nhá»¯ng gÃ¬ bÃªn trong <code>&lt;trix-editor&gt;&lt;/trix-editor&gt;</code></p><p>Inspect thá»­ params, ta sáº½ tháº¥y:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">post_params[:content]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># =&gt; &quot;&lt;div&gt;&lt;a href=\&quot;http://localhost:60100/posts/new\&quot;&gt;http://localhost:60100/posts/new&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;strong&gt;Hello world&lt;br&gt;&lt;/strong&gt;&lt;figure data-trix-attachment=\&quot;{&amp;quot;content&amp;quot;:&amp;quot;&lt;figure class=\\&amp;quot;attachment attachment--file attachment--zip\\&amp;quot;&gt;\\n\\n  &lt;figcaption class=\\&amp;quot;attachment__caption\\&amp;quot;&gt;\\n      &lt;span class=\\&amp;quot;attachment__name\\&amp;quot;&gt;monaco.ttf-master.zip&lt;/span&gt;\\n      &lt;span class=\\&amp;quot;attachment__size\\&amp;quot;&gt;86.9 KB&lt;/span&gt;\\n  &lt;/figcaption&gt;\\n&lt;/figure&gt;\\n&amp;quot;,&amp;quot;contentType&amp;quot;:&amp;quot;application/zip&amp;quot;,&amp;quot;filename&amp;quot;:&amp;quot;monaco.ttf-master.zip&amp;quot;,&amp;quot;filesize&amp;quot;:88996,&amp;quot;sgid&amp;quot;:&amp;quot;BAh7CEkiCGdpZAY6BkVUSSIvZ2lkOi8vYXBwL0FjdGl2ZVN0b3JhZ2U6OkJsb2IvNz9leHBpcmVzX2luBjsAVEkiDHB1cnBvc2UGOwBUSSIPYXR0YWNoYWJsZQY7AFRJIg9leHBpcmVzX2F0BjsAVDA=--97b885c24fd3d87464525f34a7b6ea117e4c72e6&amp;quot;,&amp;quot;url&amp;quot;:&amp;quot;http://localhost:60100/rails/active_storage/blobs/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBEQT09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--940badfc5aee704ef3f98085f87f909baf870660/monaco.ttf-master.zip&amp;quot;}\&quot; data-trix-content-type=\&quot;application/zip\&quot; class=\&quot;attachment attachment--content attachment--zip\&quot;&gt;&lt;figure class=\&quot;attachment attachment--file attachment--zip\&quot;&gt;\r\n\r\n  &lt;figcaption class=\&quot;attachment__caption\&quot;&gt;\r\n      &lt;span class=\&quot;attachment__name\&quot;&gt;monaco.ttf-master.zip&lt;/span&gt;\r\n      &lt;span class=\&quot;attachment__size\&quot;&gt;86.9 KB&lt;/span&gt;\r\n  &lt;/figcaption&gt;\r\n&lt;/figure&gt;\r\n&lt;figcaption class=\&quot;attachment__caption\&quot;&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/div&gt;&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>LÃ m Ä‘áº¹p nÃ³ chÃºt</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly html"><div tabindex="0" class="prism-code language-html codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">a</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">href</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">http://localhost:60100/posts/new</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">http://localhost:60100/posts/new</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">a</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">strong</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">Hello world</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">br</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">strong</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">data-trix-attachment</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">...</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">data-trix-content-type</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">application/zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment attachment--content attachment--zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment attachment--file attachment--zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__caption</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__name</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">monaco.ttf-master.zip</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__size</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">86.9 KB</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__caption</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>CÃ³ thá»ƒ tháº¥y nÃ³ khÃ¡ giá»‘ng vá»›i content cá»§a <code>&lt;trix-editor&gt;&lt;/trix-editor&gt;</code> Ä‘Ãºng khÃ´ng nÃ o?</p><p>Ta sáº½ save Ä‘á»‘ng params nÃ y láº¡i, vÃ  xem DB ta chá»©a gÃ¬?</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">app_development</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># SELECT body FROM action_text_rich_texts WHERE id = 3;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly html"><div tabindex="0" class="prism-code language-html codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">a</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">href</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">http://localhost:60100/posts/new</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">http://localhost:60100/posts/new</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">a</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">strong</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">Hello world</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">br</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">strong</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">action-text-attachment</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">sgid</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">BAh7CEkiCGdpZAY6BkVUSSIvZ2lkOi8vYXBwL0FjdGl2ZVN0b3JhZ2U6OkJsb2IvNz9leHBpcmVzX2luBjsAVEkiDHB1cnBvc2UGOwBUSSIPYXR0YWNoYWJsZQY7AFRJIg9leHBpcmVzX2F0BjsAVDA=--97b885c24fd3d87464525f34a7b6ea117e4c72e6</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">content-type</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">application/zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">url</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">http://localhost:60100/rails/active_storage/blobs/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBEQT09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--940badfc5aee704ef3f98085f87f909baf870660/monaco.ttf-master.zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">filename</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">monaco.ttf-master.zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">filesize</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">88996</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">action-text-attachment</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>CÃ¡c tháº» khÃ¡c thÃ¬ váº«n váº­y, tuy nhiÃªn attachments cá»§a ta láº¡i cÃ³ má»™t chÃºt khÃ¡c biá»‡t. á» Ä‘Ã¢y Ä‘á»‘ng <code>figure</code> Ä‘Ã£ Ä‘Æ°á»£c minify láº¡i thÃ nh <code>action-text-attachment </code> Ä‘á»ƒ cho gá»n hÆ¡n.</p><p>HÃ£y cÃ¹ng Ä‘iá»u tra xem táº¡i sao láº¡i nhÆ° váº­y? TrÆ°á»›c tiÃªn ta vÃ o xem <code>ActionText::RichText</code> cá»§a ta chá»©a gÃ¬ ma giÃ¡o</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/027085a5972a798cfea60f829a9edabbd67a2818/actiontext/app/models/action_text/rich_text.rb#L11</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class ActionText::RichText &lt; ActiveRecord::Base</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  serialize :body, ActionText::Content</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Váº­y lÃ  <code>body</code> cá»§a ta Ä‘ang Ä‘Æ°á»£c serialize bá»Ÿi <code>ActionText::Content</code>, mÃ² Ä‘áº¿n Ä‘Ã³ tiáº¿p thÃ´i.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/df8ee09ce71338cdf9816225df1bdebc707f3560/actiontext/lib/action_text/content.rb#L15</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class ActionText::Content</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  class &lt;&lt; self</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    def fragment_by_canonicalizing_content(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      fragment = ActionText::Attachment.fragment_by_canonicalizing_attachments(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      fragment = ActionText::AttachmentGallery.fragment_by_canonicalizing_attachment_galleries(fragment)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      fragment</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def initialize(content = nil, options = {})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    options.with_defaults! canonicalize: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if options[:canonicalize]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      @fragment = self.class.fragment_by_canonicalizing_content(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      @fragment = ActionText::Fragment.wrap(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Ta sáº½ quan tÃ¢m tá»›i hÃ m <code>initialize</code> trÆ°á»›c, khi serialize, máº·c Ä‘á»‹nh lÃ  ta Ä‘ang khÃ´ng dÃ¹ng tham sá»‘, váº­y lÃ  options sá»­ dá»¥ng sáº½ lÃ  <code>canonicalize: true</code>, xem tiáº¿p <code>fragment_by_canonicalizing_content</code> nÃ o. CÃ³ váº» láº¡i pháº£i mÃ² <code>fragment_by_canonicalizing_attachments</code> tiáº¿p @@</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/df8ee09ce7/actiontext/lib/action_text/attachment.rb#L11</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class ActionText::Attachment</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  TAG_NAME = &quot;action-text-attachment&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SELECTOR = TAG_NAME</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  class &lt;&lt; self</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    def fragment_by_canonicalizing_attachments(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      fragment_by_minifying_attachments(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        fragment_by_converting_trix_attachments(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>fragment_by_minifying_attachments</code>, báº¡n cÃ³ tháº¥y tá»« minify khÃ´ng? CÃ³ váº» ta Ä‘ang Ä‘i Ä‘Ãºng hÆ°á»›ng. HÃ£y tiáº¿p tá»¥c, nhÆ°ng hÃ£y báº¯t Ä‘áº§u báº±ng <code>fragment_by_converting_trix_attachments</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/df8ee09ce71338cdf9816225df1bdebc707f3560/actiontext/lib/action_text/attachments/trix_conversion.rb#L9</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">module ActionText::Attachments::TrixConversion</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  class_methods do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    def fragment_by_converting_trix_attachments(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      Fragment.wrap(content).replace(TrixAttachment::SELECTOR) do |node|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        from_trix_attachment(TrixAttachment.new(node))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>NÃ´m na lÃ  Ä‘oáº¡n nÃ y sáº½ replace toÃ n bá»™ <code>ActionText::TrixAttachment::SELECTOR = &quot;[data-trix-attachment]</code> báº±ng tháº» <code>ActionText::Attachment::SELECTOR = &quot;action-text-attachment&quot;</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">module ActionText::Attachments::Minification</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  class_methods do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    def fragment_by_minifying_attachments(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      Fragment.wrap(content).replace(ActionText::Attachment::SELECTOR) do |node|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        node.tap { |n| n.inner_html = &quot;&quot; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>HÃ m <code>fragment_by_minifying_attachments</code> cá»§a chÃºng ta sáº½ remove toÃ n bá»™ inner content cá»§a tháº» <code>action-text-attachment</code>.</p><p>Sau má»™t há»“i lÃ²ng vÃ²ng, cuá»‘i cÃ¹ng ta Ä‘Ã£ biáº¿t Ä‘Æ°á»£c táº¡i sao Ä‘á»‘ng <code>figure</code> rá»‘i ráº¯m kia trá»Ÿ thÃ nh <code>action-text-attachment</code> gá»n gÃ ng hÆ¡n ráº¥t nhiá»u.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="hiá»ƒn-thá»‹-dá»¯-liá»‡u"></a>Hiá»ƒn thá»‹ dá»¯ liá»‡u<a class="hash-link" href="#hiá»ƒn-thá»‹-dá»¯-liá»‡u" title="Direct link to heading">#</a></h2><p>HÃ£y vÃ o mÃ n hÃ¬nh detail, vÃ  thá»­ inspect element, ta sáº½ tháº¥y attachment cá»§a ta láº¡i trá»Ÿ vá» dáº¡ng Ä‘áº§y Ä‘á»§:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;%= @post.content =&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>ÄÃ¢y lÃ  nhá»¯ng gÃ¬ ta thu Ä‘Æ°á»£c.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly html"><div tabindex="0" class="prism-code language-html codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">trix-content</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">a</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">href</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">http://localhost:60100/posts/new</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">http://localhost:60100/posts/new</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">a</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">strong</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">Hello world</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">br</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">strong</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">action-text-attachment</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">      </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">sgid</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">BAh7CEkiCGdpZAY6BkVUSSIvZ2lkOi8vYXBwL0FjdGl2ZVN0b3JhZ2U6OkJsb2IvNz9leHBpcmVzX2luBjsAVEkiDHB1cnBvc2UGOwBUSSIPYXR0YWNoYWJsZQY7AFRJIg9leHBpcmVzX2F0BjsAVDA=--97b885c24fd3d87464525f34a7b6ea117e4c72e6</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">      </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">content-type</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">application/zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">      </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">url</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">http://localhost:60100/rails/active_storage/blobs/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBEQT09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--940badfc5aee704ef3f98085f87f909baf870660/monaco.ttf-master.zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">      </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">filename</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">monaco.ttf-master.zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">      </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">filesize</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">88996</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment attachment--file attachment--zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__caption</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__name</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">monaco.ttf-master.zip</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__size</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">86.9 KB</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">action-text-attachment</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Báº¡n cÃ²n nhá»› mÃ¬nh ghi á»Ÿ trÃªn, khi ta viáº¿t <code>@post.content</code>, thá»±c cháº¥t ta Ä‘ang gá»i <code>@post.content.to_s</code> chá»©?</p><p>Thá»­ Ä‘Ã o sÃ¢u vÃ o chÃºt:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/df8ee09ce7/actiontext/lib/action_text/content.rb#L90</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def to_rendered_html_with_layout</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  renderer.render(partial: &quot;action_text/content/layout&quot;, locals: { content: self })</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def to_s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  to_rendered_html_with_layout</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly erb"><div tabindex="0" class="prism-code language-erb codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;%# https://github.com/rails/rails/blob/df8ee09ce7/actiontext/app/views/action_text/content/_layout.html.erb %&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;div class=&quot;trix-content&quot;&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;%= render_action_text_content(content) %&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;/div&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/0ec2a907545e47f816993b9fd8cabb552454b1a2/actiontext/app/helpers/action_text/content_helper.rb#L12</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def render_action_text_content(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sanitize_action_text_content(render_action_text_attachments(content))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def sanitize_action_text_content(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sanitizer.sanitize(content.to_html, tags: allowed_tags, attributes: allowed_attributes, scrubber: scrubber).html_safe</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def render_action_text_attachments(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  content.render_attachments do |attachment|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    unless attachment.in?(content.gallery_attachments)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      attachment.node.tap do |node|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        node.inner_html = render(attachment, in_gallery: false).chomp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end.render_attachment_galleries do |attachment_gallery|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    render(layout: attachment_gallery, object: attachment_gallery) do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      attachment_gallery.attachments.map do |attachment|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        attachment.node.inner_html = render(attachment, in_gallery: true).chomp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        attachment.to_html</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      end.join(&quot;&quot;).html_safe</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end.chomp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Äáº¡i khÃ¡i lÃ  Rails sáº½ sanitize Ä‘á»‘ng rich text cá»§a ta Ä‘á»ƒ trÃ¡nh XSS attack, vÃ  render template Ä‘á»‘i vá»›i nhá»¯ng attachment.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="integrate-vá»›i-active-storage"></a>Integrate vá»›i Active Storage<a class="hash-link" href="#integrate-vá»›i-active-storage" title="Direct link to heading">#</a></h2><p>HÃ£y quay trá»Ÿ láº¡i vá»›i model <code>ActionText::RichText</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/df8ee09ce7/actiontext/app/models/action_text/rich_text.rb#L14</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class ActionText::RichText &lt; ActiveRecord::Base</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  has_many_attached :embeds</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  before_save do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    self.embeds = body.attachments.map(&amp;:attachable) if body.present?</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Ta dá»… dÃ ng hiá»ƒu 1 cÃ¡ch tá»•ng quan lÃ  Rails sáº½ tiáº¿n hÃ nh extract toÃ n bá»™ attachment trong body, gÃ¡n vÃ o embeds. Sau Ä‘Ã³ sáº½ save Ä‘á»‘ng association nÃ y láº¡i.</p><p>Thá»­ xem Rails sáº½ extract attachments ra lÃ m sao.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/027085a5972a798cfea60f829a9edabbd67a2818/actiontext/lib/action_text/content.rb#L53</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def attachables</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  @attachables ||= attachment_nodes.map do |node|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ActionText::Attachable.from_node(node)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/027085a5972a798cfea60f829a9edabbd67a2818/actiontext/lib/action_text/content.rb#L113</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def attachment_nodes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  @attachment_nodes ||= fragment.find_all(ActionText::Attachment::SELECTOR)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Rails sáº½ tÃ¬m kiáº¿m táº¥t cáº£ tháº» <code>action-text-attachment</code>, extract nhá»¯ng thÃ´ng tin cáº§n thiáº¿t Ä‘á»ƒ init Ä‘Æ°á»£c <code>ActiveStorage::Blob</code> object.</p><p>Ta cáº§n nghÃ­a qua hÃ m <code>Attachable.from_node</code> ná»¯a</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/027085a5972a798cfea60f829a9edabbd67a2818/actiontext/lib/action_text/attachable.rb#L10</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def from_node(node)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  if attachable = attachable_from_sgid(node[&quot;sgid&quot;])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    attachable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  elsif attachable = ActionText::Attachables::ContentAttachment.from_node(node)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    attachable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  elsif attachable = ActionText::Attachables::RemoteImage.from_node(node)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    attachable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ActionText::Attachables::MissingAttachable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Trong trÆ°á»ng há»£p nÃ y, Rails sáº½ luÃ´n extract theo strategy lÃ  <code>sgid</code>, cÃ¡c báº¡n khÃ´ng cáº§n quan tÃ¢m tá»›i 3 nhÃ¡nh dÆ°á»›i lÃ m gÃ¬ cho máº¥t cÃ´ng.</p><p>CÃ²n nhá»› pháº§n trÃªn mÃ¬nh Ä‘Ã£ Ä‘á» cáº­p tá»›i <code>sgid</code> chá»©?</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//github.com/rails/rails/blob/cc1a5d5620c4cd952b27f6c1bbd16d8780a34d0e/actiontext/app/javascript/actiontext/attachment_upload.js#L26</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">https</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">attachment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setAttributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sgid</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> attributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">attachable_sgid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  url</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">createBlobUrl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">attributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">signed_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> attributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">filename</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Callback nÃ y Ä‘Æ°á»£c gá»i sau khi file Ä‘Æ°á»£c upload thÃ nh cÃ´ng. Váº­y <code>sgid</code> lÃ  cÃ¡i gÃ¬?</p><p><code>sigd</code> Ä‘Æ°á»£c encrypt tá»« <code>id</code> cá»§a attachment sau khi upload. Khi gá»­i lÃªn, server sáº½ decrypt nÃ³ Ä‘á»ƒ láº¥y láº¡i <code>id</code>, gÃ¡n attachment vÃ o record.</p><p>Táº¡i sao láº¡i cáº§n encrypt? CÃ¡c báº¡n cá»© tÆ°á»Ÿng tÆ°á»£ng, náº¿u dÃ¹ng tháº³ng id, do ta upload áº£nh trÆ°á»›c khi táº¡o record, nÃªn khi gá»­i params tá»« client lÃªn, cháº¯c cháº¯n sáº½ pháº£i Ä‘Æ°a attachment id vÃ o Ä‘á»ƒ server lÆ°u Ä‘Ãºng association. Client nÃ³ gá»­i Ä‘Ãºng thÃ¬ khÃ´ng sao, nhÆ°ng náº¿u nÃ³ gá»­i id attachment cá»§a ngÆ°á»i khÃ¡c thÃ¬ sao? Attachment Ä‘Ã³ sáº½ chuyá»ƒn chá»§ ngay láº­p tá»©c :v CÃ²n náº¿u encrypt thÃ¬ user Ä‘á»‘ mÃ  mÃ² Ä‘Æ°á»£c mÃ£ hash cá»§a attachment ngÆ°á»i khÃ¡c.</p><p><code>attachable_from_sgid(node[&quot;sgid&quot;])</code> sáº½ tráº£ vá» <code>ActiveStorage::Blob</code> object</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/f1b8bb4e1f16e4029ddf05515db0c01942521116/actiontext/lib/action_text/attachable.rb#L22</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def from_attachable_sgid(sgid, options = {})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  method = sgid.is_a?(Array) ? :locate_many_signed : :locate_signed</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  record = GlobalID::Locator.public_send(method, sgid, options.merge(for: LOCATOR_NAME))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  record || raise(ActiveRecord::RecordNotFound)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Náº¿u khÃ´ng tin, báº¡n hÃ£y thá»­ <code>rails c</code> vÃ  gá»i hÃ m:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">GlobalID::Locator.locate_signed(sgid, { for: &quot;attachable&quot; })</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="káº¿t-luáº­n"></a>Káº¿t luáº­n<a class="hash-link" href="#káº¿t-luáº­n" title="Direct link to heading">#</a></h1><p><code>Action Text</code> Ä‘Æ°á»£c thiáº¿t káº¿ khÃ¡ hay, code gá»n, táº¥t cáº£ method Ä‘á»u ráº¥t ngáº¯n, dá»… hiá»ƒu.</p><p>Do lÃ  built-in nÃªn ta cÅ©ng cháº£ cáº§n cÃ i cáº¯m gÃ¬ thÃªm má»‡t ngÆ°á»i. Náº¿u Ä‘Ã£ upgrade lÃªn Rails 6, báº¡n hÃ£y thá»­ tráº£i nghiá»‡m nÃ³ xem.</p><p>CÃ²n Ä‘á»‘i vá»›i phiÃªn báº£n tháº¥p hÆ¡n, ta cÅ©ng cÃ³ thá»ƒ Ã¡p dá»¥ng flow cá»§a Action Text Ä‘á»ƒ build má»™t package há»— trá»£ richtext.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/action-text">action-text</a><a class="margin-horiz--sm" href="/blog/tags/ruby-on-rails">ruby-on-rails</a><a class="margin-horiz--sm" href="/blog/tags/web">web</a></div><div class="col text--right"><a aria-label="Read more about CÃ¹ng tÃ¬m hiá»ƒu vá» ActionText trong Rails 6" href="/blog/cung-tim-hieu-ve-actiontext-trong-rails-6"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/blog/mot-vai-mindset-khi-lam-viec-voi-react">Má»™t vÃ i mindset khi lÃ m viá»‡c vá»›i React</a></h2><div class="margin-vert--md"><time datetime="2019-02-16T00:00:00.000Z" class="blogPostDate_fNvV">February 16, 2019 Â· 11 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="LÃª SÄ© BÃ­ch"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer">LÃª SÄ© BÃ­ch</a></h4><small class="avatar__subtitle">Ruby on Rails/React Developer</small></div></div></header><div class="markdown"><p>NgÃ y nay, cÃ´ng nghá»‡ ngÃ y cÃ ng phÃ¡t triá»ƒn, vÃ  tháº¿ giá»›i Web cÅ©ng váº­y. Äa sá»‘ web hiá»‡n Ä‘áº¡i Ä‘á»u Ä‘Ã£ nÃ³i lá»i táº¡m biá»‡t vá»›i nhá»¯ng dÃ²ng Ruby, PHP, hay Java Ä‘Æ°á»£c nhÃºng trong HTML/JS. Pháº§n giao diá»‡n ngÆ°á»i dÃ¹ng Ä‘Æ°á»£c chÃ­nh browser phÃ­a client xá»­ lÃ½, thay vÃ¬ server Ã´m háº¿t nhÆ° xÆ°a. CÃ¡c thÆ° viá»‡n/framework nhÆ° React, Angular, Vue, ... Ä‘á»u Ä‘Ã£ trá»Ÿ nÃªn quÃ¡ quen thuá»™c.</p><p>Náº¿u báº¡n cÃ³ Ã½ Ä‘á»‹nh há»c hay Ä‘Ã£ chuyá»ƒn sang React thÃ¬ mong bÃ i viáº¿t cÃ³ thá»ƒ giÃºp cÃ¡c báº¡n cÃ³ nhá»¯ng mindset tá»‘t hÆ¡n khi lÃ m viá»‡c vá»›i nÃ³.</p><p>ÄÃ¢y Ä‘á»u lÃ  nhá»¯ng thá»© mÃ¬nh cho ráº±ng cáº§n quan tÃ¢m sau 1 thá»i gian lÃ m viá»‡c vá»›i React.</p><p>BÃ i viáº¿t nÃ y khÃ´ng nÃ³i vá» viá»‡c hÆ°á»›ng dáº«n code React.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="component"></a>Component<a class="hash-link" href="#component" title="Direct link to heading">#</a></h1><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="react-is-all-about-components"></a>React is all about components<a class="hash-link" href="#react-is-all-about-components" title="Direct link to heading">#</a></h3><p>React Ä‘Æ°á»£c design theo hÆ°á»›ng Component, má»—i pháº§n tá»­ nhá» nháº¥t nhÆ° tháº» <code>&lt;span&gt;</code>, hay <code>&lt;button&gt;</code> Ä‘á»u cÃ³ thá»ƒ wrap thÃ nh má»™t component Ä‘á»ƒ tÃ¡i sá»­ dá»¥ng 1 cÃ¡ch tá»‘i Ä‘a.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><div tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// path/to/button.jsx</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">Button</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token parameter"> children</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> type</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> onClick </span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">button</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">type</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">button</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">className</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token tag script language-javascript template-string template-punctuation string" style="color:rgb(195, 232, 141)">`</span><span class="token tag script language-javascript template-string string" style="color:rgb(195, 232, 141)">btn btn-</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">${</span><span class="token tag script language-javascript template-string interpolation" style="color:rgb(255, 85, 114)">type</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag script language-javascript template-string template-punctuation string" style="color:rgb(195, 232, 141)">`</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">onClick</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token tag script language-javascript" style="color:rgb(255, 85, 114)">onClick</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">children</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">button</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>VÃ  á»Ÿ Ä‘Ã¢u cáº§n component nÃ y, ta sáº½ import nÃ³ vÃ o Ä‘á»ƒ sá»­ dá»¥ng.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><div tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> Button </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;./path/to/button&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">Screen</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">Button</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">type</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">primary</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">onClick</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token tag script language-javascript" style="color:rgb(255, 85, 114)"> </span><span class="token tag script language-javascript operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token tag script language-javascript" style="color:rgb(255, 85, 114)"> console</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token tag script language-javascript function" style="color:rgb(130, 170, 255)">log</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token tag script language-javascript string" style="color:rgb(195, 232, 141)">&quot;Clicked&quot;</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      Click me</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">Button</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Vá»›i nhá»¯ng ngÃ´n ngá»¯ server side truyá»n thá»‘ng, ta sáº½ viáº¿t nhÆ° sau (slim ruby):</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly slim"><div tabindex="0" class="prism-code language-slim codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/ path/to/a.slim</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">button.btn.btn-primary</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | Button A</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly slim"><div tabindex="0" class="prism-code language-slim codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/ path/to/b.slim</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">button.btn.btn-primary</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | Button B</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>CÃ³ thá»ƒ tháº¥y lÃ  code cá»§a ta trÃ´ng sÃ¡ng sá»§a hÆ¡n ráº¥t nhiá»u.</p><p>TrÃªn thá»±c táº¿, ta cÅ©ng nÃªn viáº¿t nhá»¯ng component nhá» nháº¥t cÃ³ thá»ƒ nhÆ° váº­y, nÃ³ sáº½ giÃºp giao diá»‡n app ta Ä‘á»“ng bá»™, vÃ  debug cÅ©ng trá»Ÿ nÃªn dá»… hÆ¡n.</p><p>Hay thá»­ vá»›i má»™t component phá»©c táº¡p hÆ¡n hÆ¡n xÃ­u:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><div tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">List</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token parameter"> items</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> renderItem</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> emptyText </span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">items</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">length </span><span class="token operator" style="color:rgb(137, 221, 255)">===</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">emptyText</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">items</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">map</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">item</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">renderItem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">item</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="cáº¥u-trÃºc-thÆ°-má»¥c"></a>Cáº¥u trÃºc thÆ° má»¥c<a class="hash-link" href="#cáº¥u-trÃºc-thÆ°-má»¥c" title="Direct link to heading">#</a></h3><p>Äá»‘i vá»›i nhá»¯ng dá»± Ã¡n lá»›n, cÃ³ má»™t cáº¥u trÃºc thÆ° má»¥c rÃµ rÃ ng sáº½ khiáº¿n viá»‡c code trá»Ÿ nÃªn dá»… chá»‹u hÆ¡n nhiá»u.</p><p>Láº¡i quay láº¡i cÃ¡c ngÃ´n ngá»¯ server side MVC cÅ© - Rails. ÄÃ¢y lÃ  má»™t cáº¥u trÃºc khÃ³ mÃ  cÃ³ thá»ƒ thay Ä‘á»•i trong táº¥t cáº£ cÃ¡c dá»± Ã¡n:</p><p><img src="https://images.viblo.asia/70c519f5-7322-4384-a76f-caae42495028.png"></p><p>DÃ¹ vá»›i sá»± há»— trá»£ cá»§a cÃ¡c Editor/IDE hiá»‡n Ä‘áº¡i trong viá»‡c tÃ¬m kiáº¿m, má»Ÿ file, thÃ¬ cÅ©ng khÃ¡ máº¥t thá»i gian Ä‘á»ƒ cÃ³ thá»ƒ tÃ¬m Ä‘Æ°á»£c nhá»¯ng file liÃªn quan.</p><p>Vá»›i React thÃ¬ flexible hÆ¡n, báº¡n cÃ³ thá»ƒ tá»• chá»©c theo kiá»ƒu trÃªn (VD cho 1 project dÃ¹ng Redux)</p><p><img src="https://images.viblo.asia/a6cd4317-a0e0-4990-bdbe-5eea297d9ced.png"></p><p>NhÆ°ng vá»›i mÃ¬nh thÃ¬ mÃ¬nh thÃ­ch cÃ¡ch tá»• chá»©c theo component/mÃ n hÃ¬nh hÆ¡n.</p><p><img src="https://images.viblo.asia/f70e763d-8744-497a-9a0c-6abcfc380195.png"></p><p>MÃ¬nh há»c Ä‘Æ°á»£c cáº¥u trÃºc trÃªn tá»« má»™t dá»± Ã¡n trong list awesome react native - <a href="https://github.com/gitpoint/git-point" target="_blank" rel="noopener noreferrer">Gitpoint</a>, dÃ¹ nÃ³ Ä‘Æ°á»£c viáº¿t báº±ng React Native nhÆ°ng báº£n cháº¥t váº«n lÃ  React nÃªn khÃ´ng cÃ³ váº¥n Ä‘á» gÃ¬ háº¿t.</p><p>Tuy nhiÃªn cáº¥u trÃºc nÃ y gáº·p 1 nhÆ°á»£c Ä‘iá»ƒm á»Ÿ chá»— náº¿u 2 mÃ n hÃ¬nh mÃ  share nhau chung 1 state (redux) thÃ¬ sáº½ gÃ¢y bá»‘i rá»‘i, hoáº·c lÃ  láº·p code. Vá»›i mÃ¬nh, mÃ¬nh chá»n giáº£i phÃ¡p táº¡o 1 thÆ° má»¥c shared, rá»“i cÅ©ng tá»• chá»©c file giá»‘ng cáº¥u trÃºc cá»§a thÆ° má»¥c <code>screens</code>. CÃ²n khÃ´ng thÃ¬ cháº¥p nháº­n viá»‡c code bá»‹ láº·p 1 chÃºt.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="functional-programming-fp"></a>Functional Programming (FP)<a class="hash-link" href="#functional-programming-fp" title="Direct link to heading">#</a></h1><p>Náº¿u nhÆ° Ruby, Java lÃ  cÃ¡c ngÃ´n ngá»¯ láº­p trÃ¬nh hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng (OOP) thÃ¬ Javascript láº¡i mang phong cÃ¡ch láº­p trÃ¬nh hÃ m, máº·c dÃ¹ váº«n cÃ³ class, object náº¿u báº¡n muá»‘n dÃ¹ng (Prototype)</p><p>Vá»›i OOP, ta thÆ°á»ng xuyÃªn thay Ä‘á»•i tráº¡ng thÃ¡i (cÃ¡c biáº¿n instance) cá»§a object, nhÆ°ng FP láº¡i khÃ´ng thÃ­ch Ä‘iá»u nÃ y, mÃ  thÆ°á»ng hÆ°á»›ng tá»›i tÃ­nh báº¥t biáº¿n (Immutability) vÃ  pure function. Ta hÃ£y cÅ©ng tÃ¬m hiá»ƒu thÃªm vá» chÃºng</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="pure-functions"></a>Pure Functions<a class="hash-link" href="#pure-functions" title="Direct link to heading">#</a></h3><p>Láº¥y vÃ­ dá»¥ vá»›i viá»‡c cá»™ng 2 sá»‘ tá»± nhiÃªn</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> z </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">add</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">x</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 3</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 4</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>HÃ m <code>add</code> nháº­n 2 tham sá»‘ <code>x</code> vÃ  <code>y</code>, nÃ³ chá»‰ sá»­ dá»¥ng 2 tham sá»‘ Ä‘áº§u vÃ o nÃ y Ä‘á»ƒ thá»±c hiá»‡n phÃ©p tÃ­nh, mÃ  khÃ´ng sá»­ dá»¥ng/lÃ m thay Ä‘á»•i cÃ¡c biáº¿n ngoÃ i pháº¡m vi hÃ m.</p><p>HÆ¡n ná»¯a nÃ³ luÃ´n tráº£ vá» cÃ¹ng 1 giÃ¡ trá»‹ náº¿u nhÆ° tham sá»‘ Ä‘áº§u vÃ o khÃ´ng thay Ä‘á»•i.</p><p>CÃ²n xem hÃ m dÆ°á»›i Ä‘Ã¢y</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> bonus </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">add</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">x</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> y </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> bonus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 3</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 3</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>DÃ¹ luÃ´n tráº£ vá» má»™t giÃ¡ trá»‹ vá»›i cÃ¹ng tham sá»‘, tuy nhiÃªn hÃ m láº¡i phá»¥ thuá»™c vÃ o biáº¿n <code>bonus</code> (external variable) nÃªn Ä‘Ã¢y Ä‘Æ°á»£c xem lÃ  1 impure function.</p><p>NgoÃ i ra impure function cÅ©ng gÃ¢y ra cÃ¡c side effects nhÆ° cÃ¡c hÃ m sau:</p><ul><li>Gá»i HTTP request</li><li>Ghi dá»¯ liá»‡u</li><li><code>Math.random()</code>, <code>new Date()</code></li><li>....</li></ul><p>GiÃ¡ trá»‹ tráº£ vá» cá»§a chÃºng khÃ´ng pháº£i lÃºc nÃ o cÅ©ng giá»‘ng nhau, Ä‘iá»u Ä‘Ã³ khiáº¿n káº¿t quáº£ cá»§a hÃ m khÃ³ mÃ  lÆ°á»ng trÆ°á»›c Ä‘Æ°á»£c, khi test ta thÆ°á»ng pháº£i mock 1 giÃ¡ trá»‹ cá»‘ Ä‘á»‹nh.</p><p>Pure function sáº½ giÃºp app chÃºng ta Ã­t lá»—i hÆ¡n, ngoÃ i ra cÅ©ng dá»… dÃ ng test hÆ¡n.</p><p>Trong React, nÃ³i Ä‘áº¿n pure function ta thÆ°á»ng nghÄ© Ä‘áº¿n stateless component - Functional Component, nÃ³ sáº½ chá»‰ sá»­ dá»¥ng props Ä‘á»ƒ tÃ­nh toÃ¡n vÃ  render dá»±a trÃªn nhá»¯ng props Ä‘Ã³. Tuy nhiÃªn nhá»¯ng update gáº§n Ä‘Ã¢y Ä‘Ã£ thÃªm <a href="https://reactjs.org/docs/hooks-intro.html" target="_blank" rel="noopener noreferrer">Hook</a>, nÃ³ lÃ m cho Functional Component cÅ©ng cÃ³ thá»ƒ cÃ³ state. CÃ¡ nhÃ¢n mÃ¬nh khÃ´ng thÃ­ch cÃ¡i Hook nÃ y láº¯m.</p><p>NhÆ°ng app cá»§a ta khÃ´ng chá»‰ toÃ n pure function Ä‘Æ°á»£c, sáº½ pháº£i cÃ³ nhá»¯ng hÃ m gá»i API, thay Ä‘á»•i state, láº¥y state Ä‘á»ƒ tÃ­nh toÃ¡n, lÆ°u dá»¯ liá»‡u vÃ o localStorage, ... nhÆ°ng hÃ£y cá»‘ gáº¯ng giáº£m thiá»ƒu sá»‘ lÆ°á»£ng side effects xuá»‘ng tháº¥p nháº¥t cÃ³ thá»ƒ.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="immutability"></a>Immutability<a class="hash-link" href="#immutability" title="Direct link to heading">#</a></h3><p>Má»™t Ä‘iá»u quan trá»ng ná»¯a lÃ  tÃ­nh báº¥t biáº¿n.</p><p>Functional programming nÃ³i chung vÃ  React nÃ³i riÃªng, ta thÆ°á»ng trÃ¡nh viá»‡c sá»­a trá»±c tiáº¿p 1 biáº¿n nÃ o Ä‘Ã³, hay state. Thay vÃ o Ä‘Ã³, ta sáº½ táº¡o 1 biáº¿n má»›i.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> person </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  age</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">person</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">name</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> array </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">array</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Náº¿u trong dá»± Ã¡n cá»§a báº¡n cÃ³ nhá»¯ng dÃ²ng code nhÆ° trÃªn, thÃ¬ code báº¡n Ä‘Ã£ máº¥t tÃ­nh báº¥t biáº¿n.
Thay vÃ¬ trá»±c tiáº¿p chá»‰nh sá»­a 1 biáº¿n nhÆ° váº­y. Ta nÃªn táº¡o 1 biáº¿n má»›i vá»›i nhá»¯ng giÃ¡ trá»‹ cÅ©, sau Ä‘Ã³ thÃªm giÃ¡ trá»‹ má»›i vÃ o.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> updatedPerson </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  age</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> person</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">age</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// hay</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> updatedPerson </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain">person</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Dá»… dÃ ng nháº­n tháº¥y <code>updatedPerson.age</code> váº«n tham chiáº¿u Ä‘áº¿n giÃ¡ trá»‹ cÅ© cá»§a <code>person.name</code>, tuy nhiÃªn ta sá»­ dá»¥ng biáº¿n <code>updatedPerson</code> nÃ y tháº¿ nÃ o Ä‘i ná»¯a, thÃ¬ cÅ©ng sáº½ khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n giÃ¡ trá»‹ cá»§a <code>person</code></p><p>NhÆ°ng táº¡i sao láº¡i pháº£i lÃ m váº­y? Thá»­ xÃ©t 1 vÃ²ng láº·p Ä‘Æ¡n giáº£n nhÆ°:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> s </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> index </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword control-flow" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">index </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> index </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> index</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  s </span><span class="token operator" style="color:rgb(137, 221, 255)">+=</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Giáº£ sá»­ Ä‘ang trong quÃ¡ trÃ¬nh láº·p, thi <code>data[n]</code> bá»‹ thay Ä‘á»•i, cháº³ng pháº£i <code>s += data[index]</code> sáº½ sai luÃ´n hay sao.</p><p>CÃ²n trong React, ta cÃ³ <code>React.PureComponent</code> nÃ³ sáº½ shallow compare props vÃ  state Ä‘á»ƒ quyáº¿t Ä‘á»‹nh xem cÃ³ update component hay khÃ´ng.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><div tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">SampleComponent</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">extends</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">React</span><span class="token class-name punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">PureComponent</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  state </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    filter</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;A name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      age</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">21</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//  shouldComponentUpdate(nextProps, nextState) {</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//      return shallowCompare(this, nextProps, nextState)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//    }</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">handleClick</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">filter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;New name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">render</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">h3</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">filter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">h3</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">button</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">onClick</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token tag script language-javascript keyword" style="color:rgb(255, 85, 114);font-style:italic">this</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token tag script language-javascript" style="color:rgb(255, 85, 114)">handleClick</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">Click me</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">button</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>React.PureComponent</code> Ä‘Ã£ Ä‘á»‹nh nghÄ©a sáºµn cho ta phÆ°Æ¡ng thá»©c <code>shouldComponentUpdate</code> nhÆ° pháº§n mÃ¬nh comment.</p><p>HÃ m <code>shallowCompare</code> chá»‰ Ä‘Æ¡n thuáº§n láº·p táº¥t cáº£ cÃ¡c key cÃ³ trong props vÃ  state, so sÃ¡nh vá»›i state/props cÅ©.</p><p>NÃ³ sáº½ thá»±c hiá»‡n viá»‡c so sÃ¡nh <code>currentState.filter === nextState.filter</code> (so sÃ¡nh báº±ng tham chiáº¿u).</p><p>Viá»‡c nÃ y cÃ³ lá»£i hÆ¡n ráº¥t nhiá»u so vá»›i viá»‡c deep compare táº¥t cáº£ cÃ¡c giÃ¡ trá»‹ trong filter (cáº£ vá» thá»i gian láº«n Ä‘á»™ phá»©c táº¡p).</p><p>Tuy nhiÃªn, khi chÃºng ta trá»±c tiáº¿p chá»‰nh sá»­a <code>this.state.filter.name = &#x27;New name&#x27;</code>, sáº½ khiáº¿n filter khÃ´ng há» thay Ä‘á»•i vá» tham chiáº¿u. Khi Ä‘Ã³:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">currentState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">filter</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">===</span><span class="token plain"> nextState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">filter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// true</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">currentState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">filter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">name</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">===</span><span class="token plain"> nextState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">filter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// false</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>vÃ  <code>SampleComponent</code> cá»§a ta cÅ©ng sáº½ khÃ´ng re-render, cho dÃ¹ báº¡n cÃ³ click Ä‘áº¿n sang nÄƒm.</p><p><img src="https://images.viblo.asia/ecee315c-f2a5-4eb6-a290-af2c100a8724.png"></p><p>Thay vÃ o Ä‘Ã³ ta sáº½ lÃ m nhÆ° sau</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function-variable function" style="color:rgb(130, 170, 255)">handleClick</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> filter</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">filter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;New name&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Ta copy toÃ n bá»™ tham chiáº¿u cÃ¡c attribute cá»§a <code>state.filter</code> cÅ© sang 1 object má»›i, vÃ  sau Ä‘Ã³ thay Ä‘á»•i biáº¿n <code>name</code> cá»§a object má»›i nÃ y, ta khÃ´ng há» lÃ m thay Ä‘á»•i <code>state.filter</code> cÅ©.</p><p>Khi Ä‘Ã³ <code>currentState.filter === nextState.filter</code> sáº½ tráº£ vá» <code>false</code>. <code>SampleComponent</code> cá»§a ta Ä‘Æ°á»£c re-render láº¡i. VÃ  náº¿u cÃ³ action nÃ o khÃ´ng lÃ m thay Ä‘á»•i <code>state</code>, component cá»§a ta cÅ©ng sáº½ khÃ´ng re-render. Váº­y lÃ  cáº£ React vÃ  ta Ä‘á»u happy - <em>má»™t ngÆ°á»i khá»e, 2 ngÆ°á»i vui :v</em></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="higher-order-functions-hof"></a>Higher-Order Functions (HOF)<a class="hash-link" href="#higher-order-functions-hof" title="Direct link to heading">#</a></h3><blockquote><p>HOF nháº­n tham sá»‘ lÃ  hÃ m, hoáº·c tráº£ vá» má»™t hÃ m khÃ¡c, hoáº·c lÃ  cáº£ 2.</p></blockquote><p>VD 1 hÃ m nháº­n tham sá»‘ hÃ m:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;React&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> phoneNumber </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;0969696969&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">numberValidator</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">str</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> str</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">match</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">\d+</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-flags">g</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">validate</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">value</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> validator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token function" style="color:rgb(130, 170, 255)">validator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">validate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> numberValidator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// false</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">validate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">phoneNumber</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> numberValidator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// false</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Hay 1 hÃ m tráº£ vá» 1 hÃ m:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">makeAdder</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">constantValue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">adder</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> constantValue </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>ta gá»i hÃ m nÃ y nhÆ° sau: <code>makeAdder(10)(20)</code></p><p>Thoáº¡t nhÃ¬n cÃ³ váº» sá»£, nhÆ°ng náº¿u viáº¿t minh báº¡ch ra</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> add10 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">makeAdder</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">add10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 30</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Má»i thá»© trá»Ÿ nÃªn rÃµ rÃ ng hÆ¡n nhiá»u, <code>makerAdder(10)</code> tráº£ vá» má»™t hÃ m, sau Ä‘Ã³ ta gá»i hÃ m nÃ y vá»›i tham sá»‘ lÃ  20</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> add10 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">makeAdder</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// add10 = function adder(value) {</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//   return 10 + value</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// }</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">add10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Trong React, ta cÅ©ng thÆ°á»ng xuyÃªn Ã¡p dá»¥ng ká»¹ thuáº­t nÃ y, tuy nhiÃªn ngoÃ i HOF, thÃ¬ ta cÃ²n cÃ³ Higher-Order Component (HOC), nháº±m chá»‰ nhá»¯ng hÃ m nháº­n vÃ o tham sá»‘ lÃ  1 Component vÃ  tráº£ vá» 1 Component khÃ¡c.</p><p>VD:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><div tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">protectRoute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">Component</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> requiredRole</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">ProtectedRoute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">props</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> currentRole </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> localStorage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getItem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;role&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">currentRole </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> requiredRole</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">Redirect</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">to</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">/sign_in</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">Component</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag spread punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token tag spread punctuation" style="color:rgb(199, 146, 234)">...</span><span class="token tag spread attr-value" style="color:rgb(255, 85, 114)">props</span><span class="token tag spread punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="declarative-programming"></a>Declarative Programming<a class="hash-link" href="#declarative-programming" title="Direct link to heading">#</a></h3><p>Ta cÃ³ 2 thiÃªn hÆ°á»›ng láº­p trÃ¬nh Ä‘á»‘i láº­p nhau, Ä‘Ã³ lÃ :</p><ul><li>Imperative Programming: mÃ´ táº£ control flow cá»§a viá»‡c cáº§n lÃ m</li><li>Declarative Programming: chá»‰ viáº¿t ra nhá»¯ng gÃ¬ cáº§n lÃ m mÃ  khÃ´ng mÃ´ táº£ rÃµ control flow cá»§a tá»«ng bÆ°á»›c.</li></ul><p>VD tiÃªu biá»ƒu Ä‘Ã³ lÃ  1 vÃ²ng láº·p cÆ¡ báº£n:</p><p>Style Imperative:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> arr </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> newArr </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword control-flow" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> arr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">+=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  newArr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">arr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token console class-name" style="color:rgb(255, 203, 107)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">newArr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// [2, 3]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Vá»›i style nÃ y, báº¡n nÃªu láº§n lÆ°á»£t tá»«ng bÆ°á»›c code báº¡n thá»±c hiá»‡n nhÆ° tháº¿ nÃ o, ta pháº£i Ä‘i sÃ¢u vÃ o implementation hÆ¡n.</p><p>Trong khi Ä‘Ã³ vá»›i Declarative:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> arr </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> newArr </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> arr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">map</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">element</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> element </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// [2, 3]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Ta sáº½ chá»‰ nÃ³i ráº±ng ta cáº§n 1 máº£ng má»›i tá»« arr, mÃ  má»—i pháº§n tá»­ cá»§a nÃ³ tÄƒng lÃªn 1. Code cá»§a ta vá»«a dá»… hiá»ƒu vÃ  vá»«a Ä‘áº¹p hÆ¡n.</p><p>Má»™t sá»‘ ngÃ´n ngá»¯ tiÃªu biá»ƒu:</p><ul><li>Imperative: C/C++, Java, ...</li><li>Declarative: SQL, HTML, ...</li><li>Táº¡p pháº¿ lÃ¹: Javascript =)), ...</li></ul><p>á» trÃªn lÃ  nhá»¯ng gÃ¬ mÃ¬nh search Ä‘Æ°á»£c trÃªn google khi báº¯t Ä‘áº§u tÃ¬m hiá»ƒu vá» Declarative Programming. Tuy nhiÃªn, váº«n khÃ¡ lÃ  khÃ³ hiá»ƒu, vÃ  khÃ³ phÃ¢n biá»‡t giá»¯a 2 tháº±ng Imperative vÃ  Declarative</p><p>Tuy nhiÃªn khi Ä‘á»c Ä‘Æ°á»£c comment <a href="https://stackoverflow.com/questions/1784664/what-is-the-difference-between-declarative-and-imperative-programming#comment29365241_1784702" target="_blank" rel="noopener noreferrer">nÃ y</a>, má»i thá»© Ä‘Ã£ trá»Ÿ nÃªn sÃ¡ng sá»§a hÆ¡n nhiá»u. MÃ¬nh coi nÃ³ lÃ  1 lá»›p abstract, mÃ  khi gá»i hÃ m Ä‘Ã³, ta chá»‰ cáº§n quan tÃ¢m Ä‘áº¿n <em>what to do</em> mÃ  khÃ´ng pháº£i nghÄ© xem <em>how to do</em>.</p><p>HÃ£y sá»­ dá»¥ng cÃ¡c hÃ m cÃ³ sáºµn cá»§a javascript nhÆ°: <code>.map</code>, <code>.reduce</code>, <code>.filter</code>, ... vÃ  báº¡n sáº½ nháº­n tháº¥y Ä‘Æ°á»£c váº» Ä‘áº¹p cá»§a Declarative Programming.</p><p>Quay trá»Ÿ láº¡i vá»›i React, váº­y thÃ¬ tÃ­nh Declarative cá»§a nÃ³ á»Ÿ Ä‘Ã¢u?</p><p>ChÃ­nh báº£n thÃ¢n cÃ¡c component React Ä‘Ã£ ráº¥t &#x27;declarative&#x27; rá»“i.</p><p>HÃ£y Ä‘á»c pháº§n description cá»§a React trÃªn <a href="https://github.com/facebook/react" target="_blank" rel="noopener noreferrer">Github</a></p><blockquote><p>A declarative, efficient, and flexible JavaScript library for building user interfaces.</p></blockquote><p>Thá»­ so sÃ¡nh 2 Ä‘oáº¡n mÃ£ sau:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// jQuery</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;.like&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">click</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> $btn </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">$btn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">hasClass</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;liked&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $btn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">removeClass</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;liked&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $btn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">addClass</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;liked&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><div tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// React</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">LikeButton</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">extends</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">React</span><span class="token class-name punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">Component</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ...codes</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">render</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">liked</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">HighlightButton</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">Like</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">HighlightButton</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">Button</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">Like</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">Button</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Vá»›i jQuery, ta pháº£i mÃ´ táº£ chÃ­nh xÃ¡c code ta cáº§n lÃ m gÃ¬.</p><p>Trong khi Ä‘Ã³ vá»›i React: <em>Tiá»ƒu nhá»‹, like rá»“i thÃ¬ cho cÃ¡i <code>HightlightButton</code> ra Ä‘Ã¢y, khÃ´ng thÃ¬ <code>Button</code> thÆ°á»ng thÃ´i.</em></p><p>Ta sáº½ quan tÃ¢m Ä‘áº¿n viá»‡c component cáº§n hiá»ƒn thá»‹ cÃ¡i gÃ¬ tÆ°Æ¡ng á»©ng vá»›i má»—i (props/state) cá»§a nÃ³.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="link-tham-kháº£o"></a>Link tham kháº£o<a class="hash-link" href="#link-tham-kháº£o" title="Direct link to heading">#</a></h1><p><a href="https://github.com/facebook/react" target="_blank" rel="noopener noreferrer">https://github.com/facebook/react</a></p><p><a href="https://github.com/jondot/awesome-react-native" target="_blank" rel="noopener noreferrer">https://github.com/jondot/awesome-react-native</a></p><p><a href="https://github.com/gitpoint/git-point" target="_blank" rel="noopener noreferrer">https://github.com/gitpoint/git-point</a></p><p><a href="https://medium.freecodecamp.org/all-the-fundamental-react-js-concepts-jammed-into-this-single-medium-article-c83f9b53eac2?gi=7fb0830efbd4" target="_blank" rel="noopener noreferrer">https://medium.freecodecamp.org/all-the-fundamental-react-js-concepts-jammed-into-this-single-medium-article-c83f9b53eac2?gi=7fb0830efbd4</a></p><p><a href="https://medium.com/@cscalfani/so-you-want-to-be-a-functional-programmer-part-1-1f15e387e536" target="_blank" rel="noopener noreferrer">https://medium.com/@cscalfani/so-you-want-to-be-a-functional-programmer-part-1-1f15e387e536</a></p><p><a href="https://www.miles.no/blogg/tema/teknisk/why-care-about-functional-programming-part-1-immutability" target="_blank" rel="noopener noreferrer">https://www.miles.no/blogg/tema/teknisk/why-care-about-functional-programming-part-1-immutability</a></p><p><a href="https://blog.logrocket.com/immutability-in-react-ebe55253a1cc" target="_blank" rel="noopener noreferrer">https://blog.logrocket.com/immutability-in-react-ebe55253a1cc</a></p><p><a href="https://stackoverflow.com/questions/1784664/what-is-the-difference-between-declarative-and-imperative-programming#comment29365241_1784702" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/questions/1784664/what-is-the-difference-between-declarative-and-imperative-programming#comment29365241_1784702</a></p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/reactjs">reactjs</a><a class="margin-horiz--sm" href="/blog/tags/web">web</a><a class="margin-horiz--sm" href="/blog/tags/javascript">javascript</a></div><div class="col text--right"><a aria-label="Read more about Má»™t vÃ i mindset khi lÃ m viá»‡c vá»›i React" href="/blog/mot-vai-mindset-khi-lam-viec-voi-react"><strong>Read More</strong></a></div></footer></article></div></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Self notes</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/moonlight8978/moonlight8978.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://stackoverflow.com/users/8068639/moonlight8978" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 moonlight8978. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.9bf10215.js"></script>
<script src="/assets/js/main.a4c2403e.js"></script>
</body>
</html>