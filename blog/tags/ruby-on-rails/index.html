<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="moonlight8978's Blog Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="moonlight8978's Blog Blog Atom Feed"><title data-react-helmet="true">Posts tagged &quot;ruby-on-rails&quot; | moonlight8978&#x27;s Blog</title><meta data-react-helmet="true" property="og:title" content="Posts tagged &quot;ruby-on-rails&quot; | moonlight8978&#x27;s Blog"><meta data-react-helmet="true" name="description" content="Blog | Tagged &quot;ruby-on-rails&quot;"><meta data-react-helmet="true" property="og:description" content="Blog | Tagged &quot;ruby-on-rails&quot;"><meta data-react-helmet="true" property="og:url" content="https://moonlight8978.github.io/blog/tags/ruby-on-rails"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_tags_posts"><link data-react-helmet="true" rel="shortcut icon" href="https://avatars.githubusercontent.com/u/26299310?v=4"><link data-react-helmet="true" rel="canonical" href="https://moonlight8978.github.io/blog/tags/ruby-on-rails"><link data-react-helmet="true" rel="alternate" href="https://moonlight8978.github.io/blog/tags/ruby-on-rails" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://moonlight8978.github.io/blog/tags/ruby-on-rails" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.5f3c8191.css">
<link rel="preload" href="/assets/js/runtime~main.f8558fbc.js" as="script">
<link rel="preload" href="/assets/js/main.a94954d9.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">My Site</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs/intro">Programming notes</a><a class="navbar__item navbar__link" href="/books/intro">Book notes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ğŸŒ</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">My Site</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/intro">Programming notes</a></li><li class="menu__list-item"><a class="menu__link" href="/books/intro">Book notes</a></li><li class="menu__list-item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-tags-post-page"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">All posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cung-tim-hieu-ve-puma-ruby-on-rails">CÃ¹ng tÃ¬m hiá»ƒu vá» Puma (Ruby on Rails)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cuoi-react-native-xem-appium-phan-1-cung-tim-hieu-cach-hoat-dong-cua-appium">CÆ°á»¡i React Native xem Appium (Pháº§n 1 - CÃ¹ng tÃ¬m hiá»ƒu cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a Appium)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/gioi-thieu-ve-kubernetes">Giá»›i thiá»‡u vá» Kubernetes</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/toi-uu-menh-de-where-mysql">Tá»‘i Æ°u má»‡nh Ä‘á» WHERE (MySQL)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cung-tim-hieu-ve-actiontext-trong-rails-6">CÃ¹ng tÃ¬m hiá»ƒu vá» ActionText trong Rails 6</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cung-tim-hieu-ve-railway-oriented-programming">CÃ¹ng tÃ¬m hiá»ƒu vá» Railway Oriented Programming</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/mot-vai-mindset-khi-lam-viec-voi-react">Má»™t vÃ i mindset khi lÃ m viá»‡c vá»›i React</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cung-tim-hieu-ve-nguyen-tu-cua-the-gioi-front-end-phan-2-density-independent-pixel">CÃ¹ng tÃ¬m hiá»ƒu vá» nguyÃªn tá»­ cá»§a tháº¿ giá»›i FrontEnd (Pháº§n 2 - Density-independent Pixel)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cung-tim-hieu-ve-nguyen-tu-cua-the-gioi-front-end-phan-1-pixel">CÃ¹ng tÃ¬m hiá»ƒu vá» nguyÃªn tá»­ cá»§a tháº¿ giá»›i FrontEnd (Pháº§n 1 - Pixel)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/tdd-bdd-noi-de-hon-lam">TDD/BDD - NÃ³i dá»… hÆ¡n lÃ m</a></li></ul></div></div><main class="col col--7"><h1>3 posts tagged with &quot;ruby-on-rails&quot;</h1><a href="/blog/tags">View All Tags</a><div class="margin-vert--xl"><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/blog/cung-tim-hieu-ve-puma-ruby-on-rails">CÃ¹ng tÃ¬m hiá»ƒu vá» Puma (Ruby on Rails)</a></h2><div class="margin-vert--md"><time datetime="2021-05-31T00:00:00.000Z" class="blogPostDate_fNvV">May 31, 2021 Â· 11 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="LÃª SÄ© BÃ­ch"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer">LÃª SÄ© BÃ­ch</a></h4><small class="avatar__subtitle">Ruby on Rails/React Developer</small></div></div></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1-má»Ÿ-Ä‘áº§u"></a>1. Má»Ÿ Ä‘áº§u<a class="hash-link" href="#1-má»Ÿ-Ä‘áº§u" title="Direct link to heading">#</a></h2><p>Cháº¯c háº³n Puma khÃ´ng pháº£i má»™t cÃ¡i tÃªn xa láº¡ Ä‘á»‘i vá»›i má»—i Rails developer, má»™t pháº§n cÅ©ng vÃ¬ Ä‘Ã¢y lÃ  appserver máº·c Ä‘á»‹nh khi táº¡o má»›i má»™t project Rails.</p><p>HÃ£y cÃ¹ng nhÃ¬n qua nhá»¯ng config cÆ¡ báº£n khi cháº¡y 1 á»©ng dá»¥ng Rails vá»›i Puma server. <a href="https://github.com/rails/rails/blob/0f5700ac3589081126fbfde1e4037dc1d4166cce/railties/lib/rails/generators/rails/app/templates/config/puma.rb.tt" target="_blank" rel="noopener noreferrer">link</a></p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">config/puma.rb</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">max_threads_count = ENV.fetch(&quot;RAILS_MAX_THREADS&quot;) { 5 }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">min_threads_count = ENV.fetch(&quot;RAILS_MIN_THREADS&quot;) { max_threads_count }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">threads min_threads_count, max_threads_count</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">worker_timeout 3600 if ENV.fetch(&quot;RAILS_ENV&quot;, &quot;development&quot;) == &quot;development&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">port ENV.fetch(&quot;PORT&quot;) { 3000 }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">environment ENV.fetch(&quot;RAILS_ENV&quot;) { &quot;development&quot; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pidfile ENV.fetch(&quot;PIDFILE&quot;) { &quot;tmp/pids/server.pid&quot; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">workers ENV.fetch(&quot;WEB_CONCURRENCY&quot;) { 2 }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">preload_app!</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">plugin :tmp_restart</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Äá»‘i vá»›i nhá»¯ng ngÆ°á»i má»›i báº¯t Ä‘áº§u, khi deploy puma, cÃ³ láº½ sáº½ tá»« chá»‘i hiá»ƒu Ä‘á»‘ng config trÃªn vÃ  set má»™t sá»‘ biáº¿n mÃ´i trÆ°á»ng nhÆ° sau:</p><ul><li><code>WEB_CONCURRENCY</code>: báº±ng vá»›i sá»‘ lÆ°á»£ng vcore/process cá»§a mÃ¡y</li><li><code>RAILS_MAX_THREADS</code>: á» thÃ¬ nhiá»u RAM thÃ¬ set 16, 32 cho oÃ¡ch, khÃ´ng thÃ¬ thÃ´i dÃ¹ng máº·c Ä‘á»‹nh 5 vÃ  máº·c do dÃ²ng Ä‘á»i xÃ´ Ä‘áº©y :v</li></ul><p>HÃ£y cÃ¹ng tÃ¬m hiá»ƒu thÃªm vá» Puma Ä‘á»ƒ gÃ³p pháº§n lÃ m chá»§ tá»«ng dÃ²ng code trong app cá»§a chÃºng ta.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-multi-processing-vÃ -multi-threading"></a>2. Multi-processing vÃ  Multi-threading<a class="hash-link" href="#2-multi-processing-vÃ -multi-threading" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="21-puma-dÃ¹ng-loáº¡i-nÃ o"></a>2.1. Puma dÃ¹ng loáº¡i nÃ o?<a class="hash-link" href="#21-puma-dÃ¹ng-loáº¡i-nÃ o" title="Direct link to heading">#</a></h3><ul><li>Khi cháº¡y 1 Rails app má»›i táº¡o, hÃ£y Ä‘á»ƒ Ã½ lÃºc boot server, báº¡n sáº½ tháº¥y:</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly log"><div tabindex="0" class="prism-code language-log codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Puma starting in single mode...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">* Puma version: 5.3.1 (ruby 3.0.1-p64) (&quot;Sweetnighter&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">*  Min threads: 5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">*  Max threads: 5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">*  Environment: development</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">*          PID: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">* Listening on http://0.0.0.0:3000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Use Ctrl-C to stop</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>ÄÃ¢y lÃ  dáº¥u hiá»‡u cho ta tháº¥y, Rails Ä‘ang cháº¡y á»Ÿ cháº¿ Ä‘á»™ single process (1 process), vÃ  multi-thread (cá»¥ thá»ƒ lÃ  5 thread)</p><ul><li>CÃ²n khi config deploy, cÃ³ thá»ƒ báº¡n sáº½ Ä‘Æ°á»£c 1 ngÆ°á»i cÃ³ kinh nghiá»‡m hÆ¡n báº£o ráº±ng <em>&quot;Bá» comment cÃ¡i dÃ²ng <code>workers ENV.fetch(&quot;WEB_CONCURRENCY&quot;) { 2 }</code> Ä‘i em Ãªi&quot;</em></li></ul><p>VÃ  Ä‘Ã¢y lÃ  káº¿t quáº£ khi ta lÃ m nhÆ° váº­y</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly log"><div tabindex="0" class="prism-code language-log codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] Puma starting in cluster mode...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] * Puma version: 5.3.1 (ruby 3.0.1-p64) (&quot;Sweetnighter&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] *  Min threads: 5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] *  Max threads: 5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] *  Environment: development</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] *   Master PID: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] *      Workers: 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] *     Restarts: (ï¿½ï¿½ï¿½) hot (ï¿½ï¿½ï¿½) phased</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] * Preloading application</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] * Listening on htp://0.0.0.0:3000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] Use Ctrl-C to stop</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] - Worker 0 (PID: 16) booted in 0.02s, phase: 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1] - Worker 1 (PID: 17) booted in 0.05s, phase: 0</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Puma Ä‘ang cháº¡y Ä‘á»“ng thá»i multi-process (2 process) vÃ  multi-thread (5 thread)</p><blockquote><p>Multi-process, multi-thread lÃ  cÃ¡i cá»§a ná»£ gÃ¬ váº­y?</p></blockquote><p>ChÃºng ta sáº½ tÃ¬m hiá»ƒu vá» nÃ³ ngay sau Ä‘Ã¢y. Tuy nhiÃªn chÃºng ta sáº½ focus vÃ o cluster mode cá»§a Puma nhÃ©.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="22-multi-threading"></a>2.2. Multi-threading<a class="hash-link" href="#22-multi-threading" title="Direct link to heading">#</a></h3><p>TrÆ°á»›c tiÃªn ta hÃ£y nhá»› láº¡i Ä‘á»‹nh nghÄ©a vá» <code>process</code> - tiáº¿n trÃ¬nh, má»—i khi ta cháº¡y 1 command nÃ o Ä‘Ã³ (vÃ­ dá»¥ nhÆ° <code>ruby xxx.rb</code> hay báº­t chrome cháº³ng háº¡n), OS sáº½ táº¡o 1 process Ä‘á»ƒ xá»­ lÃ½ command cá»§a ta.</p><p>Má»—i <em>process</em> cÃ³ thá»ƒ táº¡o ra nhiá»u <em>thread</em> Ä‘á»ƒ xá»­ lÃ½ task (vÃ­ dá»¥ má»—i tab chrome Ä‘Æ°á»£c handle bá»Ÿi 1 thread). CÃ¡c thread Ä‘Æ°á»£c táº¡o bá»Ÿi 1 process sáº½ share nhau 1 vÃ¹ng nhá»› (memory), trong shared memory nÃ y, má»—i thread sáº½ cÃ³ stack, register (google Ä‘á»ƒ biáº¿t thÃªm Ä‘á»‘ng nÃ y lÃ  gÃ¬ =)) ) riÃªng cá»§a mÃ¬nh. Tuy nhiÃªn, viá»‡c chung Ä‘á»¥ng memory nhÆ° trÃªn sáº½ dáº«n Ä‘áº¿n 1 váº¥n Ä‘á» lÃ  nhiá»u thread cÃ¹ng chá»c tá»›i 1 resource nÃ o Ä‘Ã³, dáº«n tá»›i conflict vá» data, hay cÃ²n Ä‘Æ°á»£c biáº¿t Ä‘áº¿n vá»›i cÃ¡i tÃªn nguy hiá»ƒm hÆ¡n lÃ  <strong>race condition</strong>. Code cá»§a ta sáº½ cáº§n <em>thread-safe</em> (cÃ¡c báº¡n cÃ³ thá»ƒ google thÃªm :v)</p><p>Äá»‘i vá»›i á»©ng dá»¥ng Ruby thÃ¬ khi cháº¡y á»Ÿ mÃ´i trÆ°á»ng MRI... Ã€ Ä‘áº¥y láº¡i nháº¯c tá»›i MRI, cháº¯c nhiá»u ngÆ°á»i sáº½ tháº¯c máº¯c liá»‡u Ä‘Ã³ lÃ  gÃ¬. ÄÃ¢y lÃ  tÃªn cá»§a 1 Ruby Runtime. Ruby 1 chuáº©n spec, implement kiá»ƒu gÃ¬ cÅ©ng Ä‘Æ°á»£c, miá»…n lÃ  Ä‘Ã¡p á»©ng Ä‘Æ°á»£c spec Ä‘Ã³ thÃ¬ Ä‘á»u lÃ  Ruby. CÃ³ thá»ƒ ká»ƒ Ä‘áº¿n cÃ¡c Runtime phá»• biáº¿n sau</p><ul><li><p>MRI - aka CRuby: Matzâ€™s Ruby Interpreter (Matz - hay Matsumoto Yukihiro) lÃ  ngÆ°á»i táº¡o ra runtime nÃ y, Ä‘Æ°á»£c viáº¿t báº±ng C, nÃªn cÃ²n gá»i lÃ  CRuby</p><p>Äa sá»‘ lÃ  dÃ¹ng MRI</p></li><li><p>JRuby: Ruby implement báº±ng Java</p></li><li><p>Rubinius</p></li><li><p>mruby</p></li><li><p>...</p></li></ul><p>MRI cÃ³ 1 cÆ¡ cháº¿ lÃ  <strong>Global Interpreter Lock</strong> (GIL), khi cháº¡y multi-thread, nÃ³ chá»‰ cho phÃ©p 1 thread cháº¡y source code Ruby táº¡i 1 thá»i Ä‘iá»ƒm, nÃªn lÃ  ta cÃ³ nhiá»u thread Ä‘i chÄƒng ná»¯a thÃ¬ cÅ©ng chá»‰ cÃ³ 1 thread Ä‘Æ°á»£c cháº¡y mÃ  thÃ´i.</p><p>Tuy nhiÃªn vá»›i cÃ¡c thao tÃ¡c IO nhÆ° Ä‘á»c DB, request external resource, Ä‘á»c ghi file, ... thÃ¬ GIL khÃ´ng block. Puma Ä‘Ã£ táº­n dá»¥ng Ä‘iá»u nÃ y, khi 1 thread Ä‘ang xá»­ lÃ½ IO, nÃ³ sáº½ quay trá»Ÿ láº¡i xá»­ lÃ½ á»Ÿ process, nháº­n thÃªm cÃ¡c request khÃ¡c Ä‘á»ƒ xá»­ lÃ½.</p><p>ChÃ­nh vÃ¬ váº­y, ngay cáº£ khi chá»‰ cháº¡y á»Ÿ single mode, Puma váº«n cÃ³ thá»ƒ handle Ä‘Æ°á»£c concurrent request. Tuy nhiÃªn vá»›i cÃ¡c request cáº§n thá»i gian dÃ i Ä‘á»ƒ xá»­ lÃ½, do chá»‰ cÃ³ 1 thread Ä‘Æ°á»£c cháº¡y, nÃªn request sau sáº½ pháº£i chá» request trÆ°á»›c xá»­ lÃ½ xong, dáº«n Ä‘áº¿n Puma bá»‹ thá»t trong trÆ°á»ng há»£p nÃ y.</p><p>Ta cÃ³ thá»ƒ kiá»ƒm tra vá» tráº¡ng thÃ¡i cÃ¡c thread cá»§a Puma báº±ng Ä‘oáº¡n code sau:</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">app/controllers/homes_controller.rb</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class HomesController &lt; ApplicationController</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def show</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Thread.list.select { |t| t.name&amp;.match?(/puma threadpool \d+/) }.each do |t|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      Rails.logger.info(&quot;Thread #{t.name}: #{t.status}, alive: #{t.alive?}, current: #{t == Thread.current}&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    head :ok</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>VÃ¬ sao láº¡i lÃ  <code>/puma threadpool \d+/</code>? CÃ¡c báº¡n cÃ³ thá»ƒ xem táº¡i <a href="https://github.com/puma/puma/blob/3e80f7c704e5585da4faa32edf0fa7a0abed3689/lib/puma/thread_pool.rb#L104" target="_blank" rel="noopener noreferrer">Ä‘Ã¢y</a>.</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">config/routes.rb</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Rails.application.routes.draw do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  resource :home</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">config/puma.rb</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">max_threads_count = ENV.fetch(&#x27;RAILS_MAX_THREADS&#x27;, 5)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">min_threads_count = ENV.fetch(&#x27;RAILS_MIN_THREADS&#x27;) { max_threads_count }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">threads min_threads_count, max_threads_count</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">worker_timeout 3600 if ENV.fetch(&#x27;RAILS_ENV&#x27;, &#x27;development&#x27;) == &#x27;development&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">port ENV.fetch(&#x27;PORT&#x27;, 3000)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">environment ENV.fetch(&#x27;RAILS_ENV&#x27;, &#x27;development&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pidfile ENV.fetch(&#x27;PIDFILE&#x27;, &#x27;tmp/pids/server.pid&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">plugin :tmp_restart</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly curl"><div tabindex="0" class="prism-code language-curl codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">curl http://localhost:3000/home</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">tail -n 50 log/development.log</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>VÃ  Ä‘Ã¢y lÃ  output:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly log"><div tabindex="0" class="prism-code language-log codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Thread puma threadpool 001: sleep, alive: true, current: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Thread puma threadpool 002: sleep, alive: true, current: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Thread puma threadpool 003: sleep, alive: true, current: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Thread puma threadpool 004: sleep, alive: true, current: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Thread puma threadpool 005: run, alive: true, current: true</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>ÄÃ³ chÃ­nh lÃ  5 thread cá»§a chÃºng ta, nhÆ° vÃ­ dá»¥ lÃ  thread 5 Ä‘ang tiáº¿n hÃ nh xá»­ lÃ½ request, cÃ²n nhá»¯ng thread khÃ¡c náº¿u ráº£nh nÃ³ sáº½ á»Ÿ tráº¡ng thÃ¡i <code>sleep</code>. á» Ä‘Ã¢y cÃ³ 1 Ä‘iá»ƒm Ä‘Ã¡ng chÃº Ã½ lÃ  sau khi káº¿t thÃºc request, thread khÃ´ng bá»‹ kill mÃ  chá»‰ vá» tráº¡ng thÃ¡i <code>sleep</code>, do váº­y náº¿u ta tuá»³ tiá»‡n modify biáº¿n global, nÃ³ sáº½ áº£nh hÆ°á»Ÿng tá»›i request tiáº¿p theo mÃ  thread Ä‘Ã³ handle.</p><p>VÃ­ dá»¥:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">before_action :set_locale</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def set_locale</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  I18n.locale = params[:locale] || I18n.default_locale</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>KhÃ´ng cáº§n biáº¿t code cÃ¡i gÃ¬, nhÆ°ng modify 1 biáº¿n global táº¡i runtime nhÆ° trÃªn lÃ  Ä‘Ã£ tháº¥y nguy hiá»ƒm rá»“i. VÃ  ta hÃ£y tiáº¿n hÃ nh test xem</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">app/controllers/homes_controller.rb</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class HomesController &lt; ApplicationController</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def show</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Thread.current.tap { |t| Rails.logger.info(&quot;Current thread #{t.name}: #{t.status}, alive: #{t.alive?}&quot;) }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Rails.logger.info(&quot;Before: #{I18n.locale}&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    I18n.locale = params[:locale]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Rails.logger.info(&quot;After: #{I18n.locale}&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    head :ok</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>rá»“i sau Ä‘Ã³ spam khoáº£ng chá»¥c cÃ¡i request</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> http://localhost:3000/home?locale</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">vi</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>vÃ  ta sáº½ tháº¥y káº¿t quáº£ nhÆ° sau</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">log/development.log</div><div class="codeBlockContent_hGly log"><div tabindex="0" class="prism-code language-log codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Current thread puma threadpool 003: run, alive: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Before: en</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">After: vi</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Current thread puma threadpool 003: run, alive: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Before: vi</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">After: vi</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>CÃ³ thá»ƒ dá»… dÃ ng nháº­n ra ráº±ng viá»‡c set <code>I18n.locale = &quot;vi&quot;</code> á»Ÿ request trÆ°á»›c Ä‘Ã£ bá»‹ leak sang request sau. Náº¿u á»Ÿ táº¥t cáº£ cÃ¡c request, trÆ°á»›c khi xá»­ lÃ½ ta Ä‘á»u set <code>I18n.locale</code> thÃ¬ viá»‡c leak trÃªn sáº½ Ã­t áº£nh hÆ°á»Ÿng hÆ¡n.</p><p>Tuy nhiÃªn hÃ£y thá»­ tÆ°á»Ÿng tÆ°á»£ng khi app cá»§a báº¡n cÃ³ chá»©a cáº£ code admin vÃ  api, bÃªn admin cÃ³ thá»ƒ Ä‘á»•i ngÃ´n ngá»¯, cÃ²n api thÃ¬ khÃ´ng, thÃ¬ káº¿t quáº£ sáº½ ra sao. Khi admin Ä‘á»•i ngÃ´n ngá»¯, tÃ¬nh cá», 1 user vÃ´ phÃºc nÃ o Ä‘Ã³ request tá»›i trÃºng cÃ¡i thread vá»«a handle viá»‡c admin Ä‘á»•i ngÃ´n ngá»¯, vÃ  API sáº½ tráº£ vá» locale cá»§a Ã´ng admin kia :v</p><p>ChÃ­nh vÃ¬ váº­y, á»Ÿ docs cá»§a Rails cÅ©ng cÃ³ recommend chÃºng ta xá»­ lÃ½ chuyá»ƒn locale báº±ng <code>I18n.with_locale</code>, cÃ¡c báº¡n cÃ³ thá»ƒ xem táº¡i <a href="https://guides.rubyonrails.org/i18n.html#managing-the-locale-across-requests" target="_blank" rel="noopener noreferrer">Ä‘Ã¢y</a></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">around_action :switch_locale</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def switch_locale(&amp;action)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  locale = params[:locale] || I18n.default_locale</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  I18n.with_locale(locale, &amp;action)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>TÃºm vÃ¡y láº¡i lÃ  multi-threading há»— trá»£ concurrent ráº¥t tá»‘t, tuy nhiÃªn cÅ©ng áº©n chá»©a 1 vÃ i váº¥n Ä‘á». NÃªn sáº½ cáº§n chÃº Ã½ hÆ¡n khi code.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="23-multi-processing"></a>2.3. Multi-processing<a class="hash-link" href="#23-multi-processing" title="Direct link to heading">#</a></h3><p>MÃ¡y tÃ­nh hiá»‡n nay Ä‘a sá»‘ Ä‘á»u cÃ³ khÃ¡ nhiá»u core, vÃ  Ä‘á»u há»— trá»£ Ä‘a nhiá»‡m Ä‘á»ƒ tá»‘i Æ°u hoÃ¡ viá»‡c xá»­ lÃ½ song song. Váº­y vá»›i webserver thÃ¬ sao? CÃ³ cáº§n chá»©, multi-processing giÃºp ta cÃ³ thá»ƒ xá»­ lÃ½ thÃªm nhiá»u request Ä‘á»“ng thá»i hÆ¡n ná»¯a. Trá»« khi server cá»§a ta quÃ¡ yáº¿u, chá»© khÃ´ng thÃ¬ tá»™i gÃ¬, nhÃ  cháº£ cÃ³ gÃ¬ ngoÃ i core mÃ  láº¡i cháº¡y Ä‘Æ¡n nhÃ¢n thÃ¬ phÃ­ cá»§a giá»i quÃ¡ :v</p><p>Máº·c Ä‘á»‹nh Puma sáº½ cháº¡y á»Ÿ single mode, khi Ä‘Ã³ chá»‰ cÃ³ 1 process, process nÃ y sáº½ Ä‘áº£m nháº­n háº¿t tá»« viá»‡c lÆ°u code cá»§a app, tiáº¿p nháº­n request, ... sau Ä‘Ã³ sáº½ Ä‘áº©y request sang cho cÃ¡c thread xá»­ lÃ½ nhÆ° Ä‘Ã£ mÃ´ táº£ á»Ÿ trÃªn.</p><p>CÃ²n Ä‘á»‘i vá»›i cluster mode, trÆ°á»›c háº¿t Puma sáº½ táº¡o ra má»™t master process. Tá»« process nÃ y, dá»±a vÃ o giÃ¡ trá»‹ cá»§a config dÆ°á»›i, Puma sáº½ <em>fork</em> Ä‘á»ƒ táº¡o ra sá»‘ process tÆ°Æ¡ng á»©ng, hay cÃ²n gá»i lÃ  <em>worker</em>.</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">config/puma.rb</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">workers ENV.fetch(&quot;WEB_CONCURRENCY&quot;) { 2 }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Láº¡i nÃ³i vá» fork, Ä‘Ã¢y lÃ  quÃ¡ trÃ¬nh mÃ  1 process táº¡o ra 1 process má»›i, gá»i lÃ  <em>child process</em>. Má»—i child process Ä‘á»u cÃ³ process id (PID) riÃªng biá»‡t, vÃ  má»™t mÃ´i trÆ°á»ng riÃªng tÃ¡ch biá»‡t hoÃ n toÃ n vá»›i parent process (source code, memory, stack, ...). KhÃ´ng nhÆ° thread váº«n share code vá»›i process, nhÆ°ng cÃ³ stack, register riÃªng. Do váº­y, cÃ³ thá»ƒ nÃ³i forking an toÃ n vÃ  báº£o máº­t hÆ¡n so vá»›i multi-thread.</p><p>Quay trá»Ÿ láº¡i vá»›i Puma, á»Ÿ cluster mode, master process chá»‰ Ä‘áº£m nháº­n viá»‡c tiáº¿p nháº­n request, sau Ä‘Ã³ sáº½ báº¯n sang cÃ¡c worker Ä‘á»ƒ chÃºng tá»± xá»­ vá»›i cÃ¡c thread mÃ  chÃºng spawn. CÃ¡c worker cá»§a Puma Ä‘á»u cÃ³ 1 báº£n copy source code app riÃªng, nÃªn khi cháº¡y nhiá»u worker, hÃ£y cháº¯c cháº¯n lÃ  server cá»§a báº¡n cÃ³ Ä‘á»§ RAM :v</p><p>á» Ruby, cÃ³ thá»ƒ kiá»ƒm tra xem app cá»§a ta Ä‘ang cháº¡y á»Ÿ process nÃ o báº±ng cÃ¡ch sá»­ dá»¥ng</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Process.pid  # Current child process</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Process.ppid # Parent process</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>HÃ£y thá»­ á»Ÿ app Rails cá»§a ta xem</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">app/controllers/homes_controller.rb</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class HomesController &lt; ApplicationController</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def show</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Rails.logger.info(&quot;Current: #{Process.pid}. Parent: #{Process.ppid}&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    head :ok</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">config/puma.rb</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">workers 2</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">log/development.log</div><div class="codeBlockContent_hGly log"><div tabindex="0" class="prism-code language-log codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Processing by HomesController#show as */*</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Current: 128. Parent: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Processing by HomesController#show as */*</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Current: 129. Parent: 1</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">ps</span><span class="token plain"> aux</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># root         1  0.5  7.1 236000 145864 pts/0   Ssl+ 03:28   0:04 puma 5.3.1 (tcp://0.0.0.0:3000) [app]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># root         7  0.0  0.1   3544  3192 pts/1    Ss   03:29   0:00 zsh</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># root       128  0.0  6.9 288680 142008 pts/0   Sl+  03:29   0:00 puma: cluster worker 0: 1 [app]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># root       129  0.0  6.9 288720 142116 pts/0   Sl+  03:29   0:00 puma: cluster worker 1: 1 [app]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># root       219  0.0  0.0   1640   856 pts/1    R+   03:40   0:00 ps aux</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-káº¿t-luáº­n"></a>3. Káº¿t luáº­n<a class="hash-link" href="#3-káº¿t-luáº­n" title="Direct link to heading">#</a></h2><p>Cáº£ multi-threading vÃ  multi-processing Ä‘á»u quan trá»ng, chÃºng gÃ³p pháº§n giÃºp app ta xá»­ lÃ½ Ä‘c concurrent request. Hy vá»ng bÃ i viáº¿t cÃ³ thá»ƒ giÃºp Ã­ch cho cÃ¡c báº¡n Ã­t nhiá»u.</p><p>NgoÃ i ra, vá» váº¥n Ä‘á» set sá»‘ worker vÃ  thread á»Ÿ pháº§n Ä‘áº§u Ä‘Ã£ nÃ³i, tá»‘t nháº¥t cháº¯c váº«n lÃ :</p><ul><li><code>WEB_CONCURRENCY</code> = vcore, ngoÃ i ra cÃ²n phá»¥ thuá»™c vÃ o RAM ná»¯a</li><li><code>RAILS_MAX_THREADS</code> khÃ´ng cÃ³ con sá»‘ cá»¥ thá»ƒ, phá»¥ thuá»™c vÃ o RAM vÃ  CPU, nhiá»u RAM, CPU khoáº» thÃ¬ set Ä‘Æ°á»£c cÃ ng nhiá»u, nhÆ°ng cÅ©ng khÃ¡ lÃ  hÃªn xui, pháº£i tiáº¿n hÃ nh test rá»“i má»›i cÄƒn chá»‰nh con sá»‘ phÃ¹ há»£p Ä‘Æ°á»£c =))</li></ul><p>Náº¿u cÃ³ sai sÃ³t gÃ¬ cÃ¡c báº¡n cá»© gáº¡ch Ä‘Ã¡ thoáº£i mÃ¡i Ã  :v chi tiáº¿t cÃ³ thá»ƒ tham kháº£o á»Ÿ <a href="https://devcenter.heroku.com/articles/deploying-rails-applications-with-the-puma-web-server#workers" target="_blank" rel="noopener noreferrer">Ä‘Ã¢y</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="4-tham-kháº£o"></a>4. Tham kháº£o<a class="hash-link" href="#4-tham-kháº£o" title="Direct link to heading">#</a></h2><ul><li><a href="https://www.speedshop.co/2015/07/29/scaling-ruby-apps-to-1000-rpm.html" target="_blank" rel="noopener noreferrer">https://www.speedshop.co/2015/07/29/scaling-ruby-apps-to-1000-rpm.html</a></li><li><a href="https://devcenter.heroku.com/articles/concurrency-and-database-connections" target="_blank" rel="noopener noreferrer">https://devcenter.heroku.com/articles/concurrency-and-database-connections</a></li><li><a href="https://devcenter.heroku.com/articles/deploying-rails-applications-with-the-puma-web-server" target="_blank" rel="noopener noreferrer">https://devcenter.heroku.com/articles/deploying-rails-applications-with-the-puma-web-server</a></li><li><a href="http://www.geekride.com/fork-forking-vs-threading-thread-linux-kernel/" target="_blank" rel="noopener noreferrer">http://www.geekride.com/fork-forking-vs-threading-thread-linux-kernel/</a></li><li><a href="https://www.studytonight.com/operating-system/multithreading" target="_blank" rel="noopener noreferrer">https://www.studytonight.com/operating-system/multithreading</a></li><li><a href="https://www.tutorialspoint.com/how-to-create-a-process-in-linux#:~:text=A%20new%20process%20can%20be,newly%20is%20called%20child%20process" target="_blank" rel="noopener noreferrer">https://www.tutorialspoint.com/how-to-create-a-process-in-linux#:~:text=A%20new%20process%20can%20be,newly%20is%20called%20child%20process</a>.</li></ul></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/puma">puma</a><a class="margin-horiz--sm" href="/blog/tags/ruby-on-rails">ruby-on-rails</a><a class="margin-horiz--sm" href="/blog/tags/multi-threading">multi-threading</a><a class="margin-horiz--sm" href="/blog/tags/multi-processing">multi-processing</a></div><div class="col text--right"><a aria-label="Read more about CÃ¹ng tÃ¬m hiá»ƒu vá» Puma (Ruby on Rails)" href="/blog/cung-tim-hieu-ve-puma-ruby-on-rails"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/blog/cung-tim-hieu-ve-actiontext-trong-rails-6">CÃ¹ng tÃ¬m hiá»ƒu vá» ActionText trong Rails 6</a></h2><div class="margin-vert--md"><time datetime="2019-07-20T00:00:00.000Z" class="blogPostDate_fNvV">July 20, 2019 Â· 11 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="LÃª SÄ© BÃ­ch"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer">LÃª SÄ© BÃ­ch</a></h4><small class="avatar__subtitle">Ruby on Rails/React Developer</small></div></div></header><div class="markdown"><p>Rails 6 Ä‘Ã£ bÆ°á»›c vÃ o giai Ä‘oáº¡n beta vá»›i phiÃªn báº£n <a href="https://github.com/rails/rails/releases/tag/v6.0.0.rc1" target="_blank" rel="noopener noreferrer">v6.0.0.rc1</a>. RC lÃ  viáº¿t táº¯t cá»§a <strong>R</strong>elease <strong>C</strong>andidate, Ä‘Ã¢y lÃ  phiÃªn báº£n mÃ  cÃ³ xÃ¡c suáº¥t trá»Ÿ thÃ nh final release ráº¥t cao. Ta cÃ³ thá»ƒ Ã¡p dá»¥ng nÃ³ vÃ o dá»± Ã¡n ngay ká»ƒ tá»« bÃ¢y giá» mÃ  khÃ´ng cáº§n lo sá»£ cÃ³ nhá»¯ng breaking change.</p><p>Náº¿u báº¡n sá»­ dá»¥ng Docker, mÃ¬nh khuyÃªn nÃªn sá»­ dá»¥ng ruby 2.6.3, vÃ¬ trÆ°á»›c Ä‘Ã¢y mÃ¬nh Ä‘Ã£ dÃ¹ng thá»­ ruby:2.7.0-preview1-alpine3.10 thÃ¬ khÃ¡ nhiá»u lá»—i khi up server, mÃ  cháº£ biáº¿t pháº£i fix sao :sad:</p><p>á» Rails 6, cÃ³ khÃ¡ nhiá»u tÃ­nh nÄƒng má»›i hay ho:</p><ul><li>Action Text</li><li>Parallel Testing</li><li>Action Model custom error message format.</li><li>vÃ¢n vÃ¢n mÃ¢y mÃ¢y...</li></ul><p>á» bÃ i nÃ y, mÃ¬nh sáº½ chá»‰ táº­p trung Ä‘á» cáº­p tá»›i Action Text. ÄÃ¢y lÃ  má»™t package giÃºp ta xÃ¢y dá»±ng WYSIWYG editor má»™t cÃ¡ch nhanh chÃ³ng, hÆ¡n ná»¯a, viá»‡c upload cÅ©ng Ä‘Æ°á»£c integrate vá»›i Active Storage.</p><p><strong>ChÃº Ã½:</strong> BÃ i khÃ¡ dÃ i vÃ  embed nhiá»u code :v</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="cÃ¡ch-dÃ¹ng"></a>CÃ¡ch dÃ¹ng<a class="hash-link" href="#cÃ¡ch-dÃ¹ng" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="cÃ i-Ä‘áº·t-vÃ -sá»­-dá»¥ng"></a>CÃ i Ä‘áº·t vÃ  sá»­ dá»¥ng<a class="hash-link" href="#cÃ i-Ä‘áº·t-vÃ -sá»­-dá»¥ng" title="Direct link to heading">#</a></h2><p>VÃ¬ lÃ  Rails nÃªn cÃ¡ch sá»­ dá»¥ng ráº¥t Ä‘Æ¡n giáº£n, nhÆ°ng ta sáº½ cháº£ biáº¿t nÃ³ cháº¡y cÃ¡i gÃ¬ Ä‘áº±ng sau cáº£ =))</p><p>CÃ i Ä‘áº·t Action Text báº±ng CLI command sau:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">rails action_text:install</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Nhá»› hÃ£y cháº¡y thÃªm cáº£ command install Active Storage ná»¯a.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">rails active_storage:install</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Äá»ƒ Ã¡p dá»¥ng cho field <code>content</code> cá»§a model <code>Post</code>, ta sáº½ dÃ¹ng tá»›i macro <code>has_rich_text</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class CreatePosts &lt; ActiveRecord::Migration[6.0]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def change</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    create_table :posts do |t|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.string :content</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.string :category</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.timestamps</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>content</code> á»Ÿ Ä‘Ã¢y mÃ¬nh dÃ¹ng string, nhÆ°ng khuyáº¿n khÃ­ch dÃ¹ng text hÆ¡n.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class Post &lt; ApplicationRecord</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    has_rich_text :content</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>TrÃªn form, ta chá»‰ viá»‡c dÃ¹ng <code>rich_text_area</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly erb"><div tabindex="0" class="prism-code language-erb codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;%= form_with(model: @post) do |form| %&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;div class=&quot;field&quot;&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;%= form.label :content %&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;%= form.rich_text_area :content %&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;/div&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;% end %&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Khi permit params, ta cÅ©ng lÃ m nhÆ° bao field khÃ¡c</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class PostsController &lt; ApplicationController</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def post_params</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    params.require(:post).permit(:category, :content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Cuá»‘i cÃ¹ng ta hiá»ƒn thá»‹ dá»¯ liá»‡u nhÆ° sau:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly erb"><div tabindex="0" class="prism-code language-erb codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;%= @post.content %&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>CÃ¢u lá»‡nh trÃªn thá»±c cháº¥t Ä‘ang ngáº§m gá»i tá»›i <code>@post.content.to_s</code></p><p>ÄÃ¢y lÃ  sáº£n pháº©m cá»§a ta:</p><p>Form táº¡o post vá»›i WYSIWYG editor - Sá»­ dá»¥ng Trix editor, do Basecamp phÃ¡t triá»ƒn, cÃ¢y nhÃ  lÃ¡ vÆ°á»n luÃ´n.</p><p>CÃ³ thá»ƒ kÃ©o tháº£ file vÃ o, file Ä‘Ã³ sáº½ Ä‘Æ°á»£c upload báº±ng Active Storage.</p><p><img src="https://images.viblo.asia/77b9bd23-5ba3-426b-b6fc-cac02edb0b42.png"></p><p>Hiá»ƒn thá»‹ dá»¯ liá»‡u á»Ÿ mÃ n hÃ¬nh detail</p><p><img src="https://images.viblo.asia/6b1b8da0-ca7f-468b-9705-444a8cb2d736.png"></p><p>CÃ¡c báº¡n tháº¥y sao? CÃ¡ nhÃ¢n mÃ¬nh tháº¥y xáº¥u nhÆ° cá» hÃ³ váº­y =)) Tuy nhiÃªn ta cÃ³ thá»ƒ styling cho nÃ³.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="styling"></a>Styling<a class="hash-link" href="#styling" title="Direct link to heading">#</a></h2><p>Rails Ä‘ang cÃ³ sáºµn má»™t vÃ i style cÆ¡ báº£n cho nÃ³ trong file <code>app/assets/stylesheets/actiontext.scss</code>, ta cÃ³ thá»ƒ sá»­a nÃ³ Ä‘á»ƒ cho Ä‘áº¹p hÆ¡n.</p><p>Vá»›i Ä‘á»‘ng tool cá»§a editor thÃ¬ cÃ³ thá»ƒ dÃ¹ng selector <code>.trix-button-row</code></p><p>Vá»›i template attachment (nhÆ° cÃ¡i <code>monaco.ttf</code> á»Ÿ trÃªn), ta cÅ©ng cÃ³ thá»ƒ custom láº¡i, Rails cung cáº¥p sáºµn template máº·c Ä‘á»‹nh á»Ÿ file <code>app/views/active_storage/blobs/_blob.html.erb</code></p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tÃ¬m-hiá»ƒu-sá»±-ma-giÃ¡o"></a>TÃ¬m hiá»ƒu sá»± ma giÃ¡o<a class="hash-link" href="#tÃ¬m-hiá»ƒu-sá»±-ma-giÃ¡o" title="Direct link to heading">#</a></h1><p>Rá»“i ta Ä‘Ã£ lÆ°á»›t qua cÃ¡ch sá»­ dá»¥ng nÃ³, nhÆ°ng mÃ  cÃ³ quÃ¡ nhiá»u magic.</p><p>Liá»‡u báº¡n cÃ³ tá»± Ä‘áº·t ra nhá»¯ng cÃ¢u há»i tháº¿ nÃ y hay khÃ´ng?</p><ul><li><p>KhÃ´ng biáº¿t cÃ¡ch lÆ°u trá»¯ dá»¯ liá»‡u cá»§a nÃ³ nhÆ° tháº¿ nÃ o?</p></li><li><p>LÃ m sao mÃ  cÃ¡i file trong kia integrate Ä‘Æ°á»£c vá»›i Active Storage?</p></li><li><p>VÃ¬ sao láº¡i cÃ³ thá»ƒ custom láº¡i nhá»¯ng attachment báº±ng template?</p></li><li><p>vÃ¢n vÃ¢n mÃ¢y mÃ¢y...</p></li></ul><p>Ta sáº½ báº¯t tay vÃ o tÃ¬m hiá»ƒu nÃ³.</p><p>HÃ£y báº¯t Ä‘áº§u vá»›i <code>has_rich_text</code></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="macro-has_rich_text"></a>Macro <code>has_rich_text</code><a class="hash-link" href="#macro-has_rich_text" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/6a5c8b91998c56e50b5cc934d968947cd319f735/actiontext/lib/action_text/attribute.rb#L26</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def has_rich_text(name)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  class_eval &lt;&lt;-CODE, __FILE__, __LINE__ + 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    def #{name}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      rich_text_#{name} || build_rich_text_#{name}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    def #{name}=(body)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      self.#{name}.body = body</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  CODE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  has_one :&quot;rich_text_#{name}&quot;, -&gt; { where(name: name) },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    class_name: &quot;ActionText::RichText&quot;, as: :record, inverse_of: :record, autosave: true, dependent: :destroy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  # ... codes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Dá»… dÃ ng tháº¥y ráº±ng Ä‘Ã¢y lÃ  1 macro giÃºp Ä‘á»‹nh nghÄ©a getter, setter, vÃ  cáº£ association <code>has_one :rich_text_...</code> vá»›i <code>ActionText::RichText</code>.</p><p>Váº­y thÃ¬ khi ta gá»i <code>@post.content</code>, thá»±c cháº¥t lÃ  ta Ä‘ang gá»i tá»›i <code>@post.rich_text_content</code>.</p><p>VÃ  nÃ³ cÅ©ng chá»‰ ra 1 Ä‘iá»u ná»¯a lÃ  Rails dÃ¹ng 1 báº£ng riÃªng Ä‘á»ƒ lÆ°u láº¡i Ä‘á»‘ng rich text cá»§a ta.</p><p>HÃ£y dÃ nh chÃºt thá»i gian nhÃ¬n vÃ o thÆ° má»¥c <code>db/migrate</code>, ta sáº½ tháº¥y file sau:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># db/migrate/20190718085159_create_action_text_tables.action_text.rb</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># This migration comes from action_text (originally 20180528164100)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class CreateActionTextTables &lt; ActiveRecord::Migration[6.0]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def change</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    create_table :action_text_rich_texts do |t|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.string     :name, null: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.text       :body, size: :long</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.references :record, null: false, polymorphic: true, index: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.timestamps</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      t.index [ :record_type, :record_id, :name ], name: &quot;index_action_text_rich_texts_uniqueness&quot;, unique: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Quáº£ tháº­t lÃ  váº­y, <code>body</code> chÃ­nh lÃ  nÆ¡i lÆ°u trá»¯ Ä‘á»‘ng text cá»§a ta, cÃ²n <code>name</code>, <code>record_id</code>, vÃ  <code>record_type</code> lÃ  nhá»¯ng attribute cho polymorphic association, khÃ¡ quen thuá»™c náº¿u báº¡n Ä‘Ã£ dÃ¹ng Active storage</p><p>Ta sáº½ Ä‘i Ä‘áº¿n bÆ°á»›c tiáº¿p theo <code>rich_text_area</code></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="rails-xá»­-lÃ½-lÆ°u-trá»¯-rich-text-nhÆ°-tháº¿-nÃ o"></a>Rails xá»­ lÃ½, lÆ°u trá»¯ rich text nhÆ° tháº¿ nÃ o?<a class="hash-link" href="#rails-xá»­-lÃ½-lÆ°u-trá»¯-rich-text-nhÆ°-tháº¿-nÃ o" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/cc1a5d5620c4cd952b27f6c1bbd16d8780a34d0e/actiontext/app/helpers/action_text/tag_helper.rb#L20</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def rich_text_area_tag(name, value = nil, options = {})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  options = options.symbolize_keys</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  options[:input] ||= &quot;trix_input_#{ActionText::TagHelper.id += 1}&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  options[:class] ||= &quot;trix-content&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  options[:data] ||= {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  options[:data][:direct_upload_url] = main_app.rails_direct_uploads_url</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  options[:data][:blob_url_template] = main_app.rails_service_blob_url(&quot;:signed_id&quot;, &quot;:filename&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  editor_tag = content_tag(&quot;trix-editor&quot;, &quot;&quot;, options)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  input_tag = hidden_field_tag(name, value, id: options[:input])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  input_tag + editor_tag</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>CÃ³ thá»ƒ tháº¥y Ä‘Æ¡n giáº£n nÃ³ chá»‰ init cÃ¡i trix editor cho ta thÃ´i.</p><p>Viá»‡c kÃ©o tháº£ file, upload hoÃ n toÃ n Ä‘Æ°á»£c handle bá»Ÿi trix editor, ta khÃ´ng custom Ä‘Æ°á»£c template sau khi file upload thÃ nh cÃ´ng.</p><p>Tuy nhiÃªn Action Text cÃ³ thÃªm 1 callback sau khi file Ä‘Æ°á»£c upload thÃ nh cÃ´ng:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// https://github.com/rails/rails/blob/cc1a5d5620c4cd952b27f6c1bbd16d8780a34d0e/actiontext/app/javascript/actiontext/attachment_upload.js#L26</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">attachment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setAttributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sgid</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> attributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">attachable_sgid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  url</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">createBlobUrl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">attributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">signed_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> attributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">filename</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Ä‘Ã¢y lÃ  1 step ráº¥t quan trá»ng, nhÆ°ng ta sáº½ chÆ°a cáº§n chÃº Ã½ tá»›i nÃ³ vá»™i. Attachment cá»§a ta sau khi upload thÃ nh cÃ´ng sáº½ trÃ´ng nhÆ° sau:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly html"><div tabindex="0" class="prism-code language-html codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">contenteditable</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">false</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">data-trix-attachment</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&#x27;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">{</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">contentType</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">:</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">application/zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">,</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">filename</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">:</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">monaco.ttf-master.zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">,</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">filesize</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">:88996,</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">sgid</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">:</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">BAh7CEkiCGdpZAY6BkVUSSIvZ2lkOi8vYXBwL0FjdGl2ZVN0b3JhZ2U6OkJsb2IvOD9leHBpcmVzX2luBjsAVEkiDHB1cnBvc2UGOwBUSSIPYXR0YWNoYWJsZQY7AFRJIg9leHBpcmVzX2F0BjsAVDA=--79d2aa5a0af367233a5420a4f0ae02657d3910ab</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">,</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">url</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">:</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">http://localhost:60100/rails/active_storage/blobs/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBEUT09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--e79bebbfa0f10319d319411c129291d12e752d22/monaco.ttf-master.zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">}</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&#x27;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">data-trix-content-type</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">application/zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">data-trix-id</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">1108</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment attachment--file attachment--zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__caption</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__name</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">monaco.ttf-master.zip</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__size</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">86.91 KB</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Tiáº¿p Ä‘áº¿n lÃ  submit dá»¯ liá»‡u, váº­y Rails sáº½ gá»­i gÃ¬ lÃªn?</p><p>ÄÆ¡n giáº£n lÃ  Rails sáº½ gá»­i táº¥t cáº£ nhá»¯ng gÃ¬ bÃªn trong <code>&lt;trix-editor&gt;&lt;/trix-editor&gt;</code></p><p>Inspect thá»­ params, ta sáº½ tháº¥y:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">post_params[:content]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># =&gt; &quot;&lt;div&gt;&lt;a href=\&quot;http://localhost:60100/posts/new\&quot;&gt;http://localhost:60100/posts/new&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;strong&gt;Hello world&lt;br&gt;&lt;/strong&gt;&lt;figure data-trix-attachment=\&quot;{&amp;quot;content&amp;quot;:&amp;quot;&lt;figure class=\\&amp;quot;attachment attachment--file attachment--zip\\&amp;quot;&gt;\\n\\n  &lt;figcaption class=\\&amp;quot;attachment__caption\\&amp;quot;&gt;\\n      &lt;span class=\\&amp;quot;attachment__name\\&amp;quot;&gt;monaco.ttf-master.zip&lt;/span&gt;\\n      &lt;span class=\\&amp;quot;attachment__size\\&amp;quot;&gt;86.9 KB&lt;/span&gt;\\n  &lt;/figcaption&gt;\\n&lt;/figure&gt;\\n&amp;quot;,&amp;quot;contentType&amp;quot;:&amp;quot;application/zip&amp;quot;,&amp;quot;filename&amp;quot;:&amp;quot;monaco.ttf-master.zip&amp;quot;,&amp;quot;filesize&amp;quot;:88996,&amp;quot;sgid&amp;quot;:&amp;quot;BAh7CEkiCGdpZAY6BkVUSSIvZ2lkOi8vYXBwL0FjdGl2ZVN0b3JhZ2U6OkJsb2IvNz9leHBpcmVzX2luBjsAVEkiDHB1cnBvc2UGOwBUSSIPYXR0YWNoYWJsZQY7AFRJIg9leHBpcmVzX2F0BjsAVDA=--97b885c24fd3d87464525f34a7b6ea117e4c72e6&amp;quot;,&amp;quot;url&amp;quot;:&amp;quot;http://localhost:60100/rails/active_storage/blobs/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBEQT09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--940badfc5aee704ef3f98085f87f909baf870660/monaco.ttf-master.zip&amp;quot;}\&quot; data-trix-content-type=\&quot;application/zip\&quot; class=\&quot;attachment attachment--content attachment--zip\&quot;&gt;&lt;figure class=\&quot;attachment attachment--file attachment--zip\&quot;&gt;\r\n\r\n  &lt;figcaption class=\&quot;attachment__caption\&quot;&gt;\r\n      &lt;span class=\&quot;attachment__name\&quot;&gt;monaco.ttf-master.zip&lt;/span&gt;\r\n      &lt;span class=\&quot;attachment__size\&quot;&gt;86.9 KB&lt;/span&gt;\r\n  &lt;/figcaption&gt;\r\n&lt;/figure&gt;\r\n&lt;figcaption class=\&quot;attachment__caption\&quot;&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/div&gt;&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>LÃ m Ä‘áº¹p nÃ³ chÃºt</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly html"><div tabindex="0" class="prism-code language-html codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">a</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">href</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">http://localhost:60100/posts/new</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">http://localhost:60100/posts/new</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">a</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">strong</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">Hello world</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">br</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">strong</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">data-trix-attachment</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">...</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">data-trix-content-type</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">application/zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment attachment--content attachment--zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment attachment--file attachment--zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__caption</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__name</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">monaco.ttf-master.zip</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__size</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">86.9 KB</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__caption</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>CÃ³ thá»ƒ tháº¥y nÃ³ khÃ¡ giá»‘ng vá»›i content cá»§a <code>&lt;trix-editor&gt;&lt;/trix-editor&gt;</code> Ä‘Ãºng khÃ´ng nÃ o?</p><p>Ta sáº½ save Ä‘á»‘ng params nÃ y láº¡i, vÃ  xem DB ta chá»©a gÃ¬?</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">app_development</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># SELECT body FROM action_text_rich_texts WHERE id = 3;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly html"><div tabindex="0" class="prism-code language-html codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">a</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">href</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">http://localhost:60100/posts/new</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">http://localhost:60100/posts/new</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">a</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">strong</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">Hello world</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">br</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">strong</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">action-text-attachment</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">sgid</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">BAh7CEkiCGdpZAY6BkVUSSIvZ2lkOi8vYXBwL0FjdGl2ZVN0b3JhZ2U6OkJsb2IvNz9leHBpcmVzX2luBjsAVEkiDHB1cnBvc2UGOwBUSSIPYXR0YWNoYWJsZQY7AFRJIg9leHBpcmVzX2F0BjsAVDA=--97b885c24fd3d87464525f34a7b6ea117e4c72e6</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">content-type</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">application/zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">url</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">http://localhost:60100/rails/active_storage/blobs/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBEQT09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--940badfc5aee704ef3f98085f87f909baf870660/monaco.ttf-master.zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">filename</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">monaco.ttf-master.zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">filesize</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">88996</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">action-text-attachment</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>CÃ¡c tháº» khÃ¡c thÃ¬ váº«n váº­y, tuy nhiÃªn attachments cá»§a ta láº¡i cÃ³ má»™t chÃºt khÃ¡c biá»‡t. á» Ä‘Ã¢y Ä‘á»‘ng <code>figure</code> Ä‘Ã£ Ä‘Æ°á»£c minify láº¡i thÃ nh <code>action-text-attachment </code> Ä‘á»ƒ cho gá»n hÆ¡n.</p><p>HÃ£y cÃ¹ng Ä‘iá»u tra xem táº¡i sao láº¡i nhÆ° váº­y? TrÆ°á»›c tiÃªn ta vÃ o xem <code>ActionText::RichText</code> cá»§a ta chá»©a gÃ¬ ma giÃ¡o</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/027085a5972a798cfea60f829a9edabbd67a2818/actiontext/app/models/action_text/rich_text.rb#L11</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class ActionText::RichText &lt; ActiveRecord::Base</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  serialize :body, ActionText::Content</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Váº­y lÃ  <code>body</code> cá»§a ta Ä‘ang Ä‘Æ°á»£c serialize bá»Ÿi <code>ActionText::Content</code>, mÃ² Ä‘áº¿n Ä‘Ã³ tiáº¿p thÃ´i.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/df8ee09ce71338cdf9816225df1bdebc707f3560/actiontext/lib/action_text/content.rb#L15</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class ActionText::Content</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  class &lt;&lt; self</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    def fragment_by_canonicalizing_content(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      fragment = ActionText::Attachment.fragment_by_canonicalizing_attachments(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      fragment = ActionText::AttachmentGallery.fragment_by_canonicalizing_attachment_galleries(fragment)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      fragment</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def initialize(content = nil, options = {})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    options.with_defaults! canonicalize: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if options[:canonicalize]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      @fragment = self.class.fragment_by_canonicalizing_content(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      @fragment = ActionText::Fragment.wrap(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Ta sáº½ quan tÃ¢m tá»›i hÃ m <code>initialize</code> trÆ°á»›c, khi serialize, máº·c Ä‘á»‹nh lÃ  ta Ä‘ang khÃ´ng dÃ¹ng tham sá»‘, váº­y lÃ  options sá»­ dá»¥ng sáº½ lÃ  <code>canonicalize: true</code>, xem tiáº¿p <code>fragment_by_canonicalizing_content</code> nÃ o. CÃ³ váº» láº¡i pháº£i mÃ² <code>fragment_by_canonicalizing_attachments</code> tiáº¿p @@</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/df8ee09ce7/actiontext/lib/action_text/attachment.rb#L11</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class ActionText::Attachment</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  TAG_NAME = &quot;action-text-attachment&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SELECTOR = TAG_NAME</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  class &lt;&lt; self</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    def fragment_by_canonicalizing_attachments(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      fragment_by_minifying_attachments(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        fragment_by_converting_trix_attachments(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>fragment_by_minifying_attachments</code>, báº¡n cÃ³ tháº¥y tá»« minify khÃ´ng? CÃ³ váº» ta Ä‘ang Ä‘i Ä‘Ãºng hÆ°á»›ng. HÃ£y tiáº¿p tá»¥c, nhÆ°ng hÃ£y báº¯t Ä‘áº§u báº±ng <code>fragment_by_converting_trix_attachments</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/df8ee09ce71338cdf9816225df1bdebc707f3560/actiontext/lib/action_text/attachments/trix_conversion.rb#L9</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">module ActionText::Attachments::TrixConversion</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  class_methods do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    def fragment_by_converting_trix_attachments(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      Fragment.wrap(content).replace(TrixAttachment::SELECTOR) do |node|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        from_trix_attachment(TrixAttachment.new(node))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>NÃ´m na lÃ  Ä‘oáº¡n nÃ y sáº½ replace toÃ n bá»™ <code>ActionText::TrixAttachment::SELECTOR = &quot;[data-trix-attachment]</code> báº±ng tháº» <code>ActionText::Attachment::SELECTOR = &quot;action-text-attachment&quot;</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">module ActionText::Attachments::Minification</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  class_methods do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    def fragment_by_minifying_attachments(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      Fragment.wrap(content).replace(ActionText::Attachment::SELECTOR) do |node|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        node.tap { |n| n.inner_html = &quot;&quot; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>HÃ m <code>fragment_by_minifying_attachments</code> cá»§a chÃºng ta sáº½ remove toÃ n bá»™ inner content cá»§a tháº» <code>action-text-attachment</code>.</p><p>Sau má»™t há»“i lÃ²ng vÃ²ng, cuá»‘i cÃ¹ng ta Ä‘Ã£ biáº¿t Ä‘Æ°á»£c táº¡i sao Ä‘á»‘ng <code>figure</code> rá»‘i ráº¯m kia trá»Ÿ thÃ nh <code>action-text-attachment</code> gá»n gÃ ng hÆ¡n ráº¥t nhiá»u.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="hiá»ƒn-thá»‹-dá»¯-liá»‡u"></a>Hiá»ƒn thá»‹ dá»¯ liá»‡u<a class="hash-link" href="#hiá»ƒn-thá»‹-dá»¯-liá»‡u" title="Direct link to heading">#</a></h2><p>HÃ£y vÃ o mÃ n hÃ¬nh detail, vÃ  thá»­ inspect element, ta sáº½ tháº¥y attachment cá»§a ta láº¡i trá»Ÿ vá» dáº¡ng Ä‘áº§y Ä‘á»§:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;%= @post.content =&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>ÄÃ¢y lÃ  nhá»¯ng gÃ¬ ta thu Ä‘Æ°á»£c.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly html"><div tabindex="0" class="prism-code language-html codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">trix-content</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">a</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">href</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">http://localhost:60100/posts/new</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">http://localhost:60100/posts/new</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">a</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">strong</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">Hello world</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">br</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">strong</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">action-text-attachment</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">      </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">sgid</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">BAh7CEkiCGdpZAY6BkVUSSIvZ2lkOi8vYXBwL0FjdGl2ZVN0b3JhZ2U6OkJsb2IvNz9leHBpcmVzX2luBjsAVEkiDHB1cnBvc2UGOwBUSSIPYXR0YWNoYWJsZQY7AFRJIg9leHBpcmVzX2F0BjsAVDA=--97b885c24fd3d87464525f34a7b6ea117e4c72e6</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">      </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">content-type</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">application/zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">      </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">url</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">http://localhost:60100/rails/active_storage/blobs/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBEQT09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--940badfc5aee704ef3f98085f87f909baf870660/monaco.ttf-master.zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">      </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">filename</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">monaco.ttf-master.zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">      </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">filesize</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">88996</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment attachment--file attachment--zip</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__caption</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__name</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">monaco.ttf-master.zip</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">attachment__size</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">86.9 KB</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">span</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figcaption</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">figure</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">action-text-attachment</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Báº¡n cÃ²n nhá»› mÃ¬nh ghi á»Ÿ trÃªn, khi ta viáº¿t <code>@post.content</code>, thá»±c cháº¥t ta Ä‘ang gá»i <code>@post.content.to_s</code> chá»©?</p><p>Thá»­ Ä‘Ã o sÃ¢u vÃ o chÃºt:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/df8ee09ce7/actiontext/lib/action_text/content.rb#L90</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def to_rendered_html_with_layout</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  renderer.render(partial: &quot;action_text/content/layout&quot;, locals: { content: self })</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def to_s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  to_rendered_html_with_layout</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly erb"><div tabindex="0" class="prism-code language-erb codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;%# https://github.com/rails/rails/blob/df8ee09ce7/actiontext/app/views/action_text/content/_layout.html.erb %&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;div class=&quot;trix-content&quot;&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;%= render_action_text_content(content) %&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;/div&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/0ec2a907545e47f816993b9fd8cabb552454b1a2/actiontext/app/helpers/action_text/content_helper.rb#L12</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def render_action_text_content(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sanitize_action_text_content(render_action_text_attachments(content))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def sanitize_action_text_content(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sanitizer.sanitize(content.to_html, tags: allowed_tags, attributes: allowed_attributes, scrubber: scrubber).html_safe</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def render_action_text_attachments(content)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  content.render_attachments do |attachment|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    unless attachment.in?(content.gallery_attachments)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      attachment.node.tap do |node|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        node.inner_html = render(attachment, in_gallery: false).chomp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end.render_attachment_galleries do |attachment_gallery|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    render(layout: attachment_gallery, object: attachment_gallery) do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      attachment_gallery.attachments.map do |attachment|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        attachment.node.inner_html = render(attachment, in_gallery: true).chomp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        attachment.to_html</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      end.join(&quot;&quot;).html_safe</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end.chomp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Äáº¡i khÃ¡i lÃ  Rails sáº½ sanitize Ä‘á»‘ng rich text cá»§a ta Ä‘á»ƒ trÃ¡nh XSS attack, vÃ  render template Ä‘á»‘i vá»›i nhá»¯ng attachment.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="integrate-vá»›i-active-storage"></a>Integrate vá»›i Active Storage<a class="hash-link" href="#integrate-vá»›i-active-storage" title="Direct link to heading">#</a></h2><p>HÃ£y quay trá»Ÿ láº¡i vá»›i model <code>ActionText::RichText</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/df8ee09ce7/actiontext/app/models/action_text/rich_text.rb#L14</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class ActionText::RichText &lt; ActiveRecord::Base</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  has_many_attached :embeds</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  before_save do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    self.embeds = body.attachments.map(&amp;:attachable) if body.present?</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Ta dá»… dÃ ng hiá»ƒu 1 cÃ¡ch tá»•ng quan lÃ  Rails sáº½ tiáº¿n hÃ nh extract toÃ n bá»™ attachment trong body, gÃ¡n vÃ o embeds. Sau Ä‘Ã³ sáº½ save Ä‘á»‘ng association nÃ y láº¡i.</p><p>Thá»­ xem Rails sáº½ extract attachments ra lÃ m sao.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/027085a5972a798cfea60f829a9edabbd67a2818/actiontext/lib/action_text/content.rb#L53</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def attachables</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  @attachables ||= attachment_nodes.map do |node|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ActionText::Attachable.from_node(node)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/027085a5972a798cfea60f829a9edabbd67a2818/actiontext/lib/action_text/content.rb#L113</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def attachment_nodes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  @attachment_nodes ||= fragment.find_all(ActionText::Attachment::SELECTOR)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Rails sáº½ tÃ¬m kiáº¿m táº¥t cáº£ tháº» <code>action-text-attachment</code>, extract nhá»¯ng thÃ´ng tin cáº§n thiáº¿t Ä‘á»ƒ init Ä‘Æ°á»£c <code>ActiveStorage::Blob</code> object.</p><p>Ta cáº§n nghÃ­a qua hÃ m <code>Attachable.from_node</code> ná»¯a</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/027085a5972a798cfea60f829a9edabbd67a2818/actiontext/lib/action_text/attachable.rb#L10</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def from_node(node)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  if attachable = attachable_from_sgid(node[&quot;sgid&quot;])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    attachable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  elsif attachable = ActionText::Attachables::ContentAttachment.from_node(node)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    attachable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  elsif attachable = ActionText::Attachables::RemoteImage.from_node(node)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    attachable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ActionText::Attachables::MissingAttachable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Trong trÆ°á»ng há»£p nÃ y, Rails sáº½ luÃ´n extract theo strategy lÃ  <code>sgid</code>, cÃ¡c báº¡n khÃ´ng cáº§n quan tÃ¢m tá»›i 3 nhÃ¡nh dÆ°á»›i lÃ m gÃ¬ cho máº¥t cÃ´ng.</p><p>CÃ²n nhá»› pháº§n trÃªn mÃ¬nh Ä‘Ã£ Ä‘á» cáº­p tá»›i <code>sgid</code> chá»©?</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//github.com/rails/rails/blob/cc1a5d5620c4cd952b27f6c1bbd16d8780a34d0e/actiontext/app/javascript/actiontext/attachment_upload.js#L26</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">https</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">attachment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setAttributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sgid</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> attributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">attachable_sgid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  url</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">createBlobUrl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">attributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">signed_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> attributes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">filename</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Callback nÃ y Ä‘Æ°á»£c gá»i sau khi file Ä‘Æ°á»£c upload thÃ nh cÃ´ng. Váº­y <code>sgid</code> lÃ  cÃ¡i gÃ¬?</p><p><code>sigd</code> Ä‘Æ°á»£c encrypt tá»« <code>id</code> cá»§a attachment sau khi upload. Khi gá»­i lÃªn, server sáº½ decrypt nÃ³ Ä‘á»ƒ láº¥y láº¡i <code>id</code>, gÃ¡n attachment vÃ o record.</p><p>Táº¡i sao láº¡i cáº§n encrypt? CÃ¡c báº¡n cá»© tÆ°á»Ÿng tÆ°á»£ng, náº¿u dÃ¹ng tháº³ng id, do ta upload áº£nh trÆ°á»›c khi táº¡o record, nÃªn khi gá»­i params tá»« client lÃªn, cháº¯c cháº¯n sáº½ pháº£i Ä‘Æ°a attachment id vÃ o Ä‘á»ƒ server lÆ°u Ä‘Ãºng association. Client nÃ³ gá»­i Ä‘Ãºng thÃ¬ khÃ´ng sao, nhÆ°ng náº¿u nÃ³ gá»­i id attachment cá»§a ngÆ°á»i khÃ¡c thÃ¬ sao? Attachment Ä‘Ã³ sáº½ chuyá»ƒn chá»§ ngay láº­p tá»©c :v CÃ²n náº¿u encrypt thÃ¬ user Ä‘á»‘ mÃ  mÃ² Ä‘Æ°á»£c mÃ£ hash cá»§a attachment ngÆ°á»i khÃ¡c.</p><p><code>attachable_from_sgid(node[&quot;sgid&quot;])</code> sáº½ tráº£ vá» <code>ActiveStorage::Blob</code> object</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/f1b8bb4e1f16e4029ddf05515db0c01942521116/actiontext/lib/action_text/attachable.rb#L22</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def from_attachable_sgid(sgid, options = {})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  method = sgid.is_a?(Array) ? :locate_many_signed : :locate_signed</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  record = GlobalID::Locator.public_send(method, sgid, options.merge(for: LOCATOR_NAME))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  record || raise(ActiveRecord::RecordNotFound)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Náº¿u khÃ´ng tin, báº¡n hÃ£y thá»­ <code>rails c</code> vÃ  gá»i hÃ m:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">GlobalID::Locator.locate_signed(sgid, { for: &quot;attachable&quot; })</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="káº¿t-luáº­n"></a>Káº¿t luáº­n<a class="hash-link" href="#káº¿t-luáº­n" title="Direct link to heading">#</a></h1><p><code>Action Text</code> Ä‘Æ°á»£c thiáº¿t káº¿ khÃ¡ hay, code gá»n, táº¥t cáº£ method Ä‘á»u ráº¥t ngáº¯n, dá»… hiá»ƒu.</p><p>Do lÃ  built-in nÃªn ta cÅ©ng cháº£ cáº§n cÃ i cáº¯m gÃ¬ thÃªm má»‡t ngÆ°á»i. Náº¿u Ä‘Ã£ upgrade lÃªn Rails 6, báº¡n hÃ£y thá»­ tráº£i nghiá»‡m nÃ³ xem.</p><p>CÃ²n Ä‘á»‘i vá»›i phiÃªn báº£n tháº¥p hÆ¡n, ta cÅ©ng cÃ³ thá»ƒ Ã¡p dá»¥ng flow cá»§a Action Text Ä‘á»ƒ build má»™t package há»— trá»£ richtext.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/action-text">action-text</a><a class="margin-horiz--sm" href="/blog/tags/ruby-on-rails">ruby-on-rails</a><a class="margin-horiz--sm" href="/blog/tags/web">web</a></div><div class="col text--right"><a aria-label="Read more about CÃ¹ng tÃ¬m hiá»ƒu vá» ActionText trong Rails 6" href="/blog/cung-tim-hieu-ve-actiontext-trong-rails-6"><strong>Read More</strong></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/blog/tdd-bdd-noi-de-hon-lam">TDD/BDD - NÃ³i dá»… hÆ¡n lÃ m</a></h2><div class="margin-vert--md"><time datetime="2018-09-22T00:00:00.000Z" class="blogPostDate_fNvV">September 22, 2018 Â· 7 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="LÃª SÄ© BÃ­ch"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer">LÃª SÄ© BÃ­ch</a></h4><small class="avatar__subtitle">Ruby on Rails/React Developer</small></div></div></header><div class="markdown"><p>Má»™t vÃ i lÆ°u Ã½ trÆ°á»›c khi báº¯t Ä‘áº§u.</p><ul><li>Code demo trong bÃ i sáº½ sá»­ dá»¥ng rspec, capybara, factory_bot (Ruby/Rails), hÆ°á»›ng tá»›i Ä‘á»‘i tÆ°á»£ng Web developer.</li><li>BÃ i viáº¿t khÃ´ng trÃ¡nh khá»i thiáº¿u sÃ³t, náº¿u cÃ³ chá»— nÃ o khÃ´ng Ä‘Ãºng, má»i ngÆ°á»i cá»© quÄƒng gáº¡ch á»Ÿ dÆ°á»›i comment :v</li></ul><p>Ã”ng cha ta cÃ³ cÃ¢u &quot;Dá»¥c tá»‘c báº¥t Ä‘áº¡t&quot;. TrÆ°á»›c khi Ä‘i vÃ o chi tiáº¿t, ta hÃ£y cÃ¹ng Ä‘iá»ƒm qua má»™t vÃ i khÃ¡i niá»‡m trÆ°á»›c.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1-test-lÃ -gÃ¬"></a>1. Test lÃ  gÃ¬?<a class="hash-link" href="#1-test-lÃ -gÃ¬" title="Direct link to heading">#</a></h1><p>Náº¿u báº¡n lÃ  má»™t developer, cháº¯c háº³n sáº½ khÃ´ng láº¡ láº«m gÃ¬ khÃ¡i niá»‡m &quot;testing&quot;.</p><p>VÃ­ dá»¥ khi báº¡n láº­p trÃ¬nh chá»©c nÄƒng Ä‘Äƒng nháº­p cá»§a 1 trang web. Sau má»™t há»“i hÃ¬ há»¥c code, cháº¯c háº³n báº¡n sáº½ vÃ o trang Ä‘Ã³, tiáº¿n hÃ nh Ä‘Äƒng nháº­p, rá»“i chá» xem code mÃ¬nh cÃ³ cháº¡y Ä‘Ãºng hay khÃ´ng :v</p><p>Tuy nhiÃªn giá» Ä‘Ã¢y, Ä‘a sá»‘ Ä‘á»u sá»­ dá»¥ng cÃ¡c automated test script Ä‘á»ƒ tá»± Ä‘á»™ng hÃ³a quÃ¡ trÃ¬nh test. HÆ¡n tháº¿, nÃ³ cÃ²n giÃºp nhá»¯ng ngÆ°á»i maintainer sau nÃ y cÃ³ thá»ƒ hiá»ƒu <del>cÃ¡i Ä‘á»‘ng há»• lá»‘n</del> code báº¡n Ä‘á»ƒ láº¡i cháº¡y nhÆ° tháº¿ nÃ o.</p><p>Test khÃ¡c vá»›i Debug.</p><p>CÃ¡c loáº¡i test nÃªn chÃº Ã½:</p><ul><li>Unit test: test riÃªng láº» tá»«ng class/function, viáº¿t khÃ¡ dá»….</li><li>Integration test, Feature test: á»Ÿ Ä‘Ã¢y báº¯t Ä‘áº§u cÃ³ sá»± káº¿t há»£p giá»¯a nhiá»u module vá»›i nhau Ä‘á»ƒ mÃ´ táº£ 1 (hay nhiá»u) chá»©c nÄƒng cá»§a á»©ng dá»¥ng.</li></ul><p>MÃ u sáº¯c Ä‘áº·c trÆ°ng:</p><ul><li>Äá»: xin chia buá»“n test cá»§a báº¡n Ä‘Ã£ táº¡ch =))</li><li>Xanh: chÃºc má»«ng, test Ä‘Ã£ pass, code cá»§a báº¡n &quot;cÃ³ thá»ƒ&quot; Ä‘Ã£ cháº¡y Ä‘Ãºng.</li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-tdd---test-driven-development"></a>2. TDD - Test Driven Development<a class="hash-link" href="#2-tdd---test-driven-development" title="Direct link to heading">#</a></h1><p>Dá»‹ch ra thÃ¬ sáº½ lÃ  <strong>PhÃ¡t triá»ƒn vá»›i trá»ng tÃ¢m lÃ  kiá»ƒm thá»­ (test)</strong>, hay nÃ´m na lÃ  test trÆ°á»›c code sau.</p><p><img src="https://images.viblo.asia/bd25076f-2ddb-4b27-888e-d58ab8e8c286.png" alt="TDD"></p><ul><li><p>TrÆ°á»›c tiÃªn ta viáº¿t cÃ¡c test script vÃ  cháº¡y chÃºng, táº¥t nhiÃªn lÃ  sáº½ fail vÃ¬ lÃ m gÃ¬ cÃ³ code =))</p><p>VD ta muá»‘n viáº¿t 1 hÃ m tÃ­nh sá»‘ Fibonacci:</p><p><img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/6693d2c78bc8132bb9b65be861148ca574a738ef" alt="Fibonacci"></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># spec/fibonacci_spec.rb</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">describe &quot;#fibonacci_of&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  context &quot;one&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    it &quot;returns 1&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      expect(fibonacci_of(1)).to eq 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  context &quot;two&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    it &quot;returns 1&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      expect(fibonacci_of(2)).to eq 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  context &quot;greater than two&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    it &quot;returns sum of two elements before&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      expect(fibonacci_of(4)).to eq 3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Rá»“i ta má»›i báº¯t tay vÃ o code, cháº¡y test, náº¿u fail thÃ¬ láº¡i hÃ¬ há»¥c sá»­a, há»ng Ä‘Ã¢u vÃ¡ Ä‘Ã³. LÃºc nÃ y báº¡n chÆ°a cáº§n báº­n tÃ¢m vá» viá»‡c code mÃ¬nh cÃ³ dá»… hiá»ƒu/Ä‘áº¹p khÃ´ng.</p><p>VÃ  sau 1 há»“i thÃ¬ cuá»‘i cÃ¹ng test ta cÅ©ng pass :v</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># fibonacci.rb</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def fibonacci_of(n)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  case n</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  when 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  when 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fibonacci_of(n - 1) + fibonacci_of(n - 2)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li><li><p>Ta sáº½ nhÃ¬n láº¡i Ä‘á»‘ng há»• lá»‘n mÃ  ta vá»«a viáº¿t ra, tá»‰a tÃ³t láº¡i cho Ä‘áº¹p máº¯t, tÃ¡ch service cÃ¡c thá»©. VÃ  nhá»› ráº±ng Ä‘á»«ng lÃ m cho test Ä‘á» lÃ²m.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># fibonacci.rb</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def fibonacci_of(n)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  return 1 if [1, 2].include?(n)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  fibonacci_of(n - 1) + fibonacci_of(n - 2)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li></ul><p><strong>LÆ°u Ã½:</strong> KhÃ´ng pháº£i cá»© test pass lÃ  app cá»§a ta Ä‘Ã£ cháº¡y Ä‘Ãºng, viá»‡c nÃ y cÃ²n bao gá»“m nhiá»u yáº¿u tá»‘ khÃ¡c nhÆ°</p><ul><li>Ta cÃ³ hiá»ƒu Ä‘Ãºng yÃªu cáº§u cá»§a khÃ¡ch hÃ ng khÃ´ng</li><li>Test cá»§a ta Ä‘Ã£ bao gá»“m háº¿t cÃ¡c trÆ°á»ng há»£p cÃ³ thá»ƒ chÆ°a</li></ul><p>CÃ³ thá»ƒ dá»… dÃ ng nháº­n tháº¥y, hÃ m <code>#fibonacci_of</code> á»Ÿ trÃªn sáº½ cháº¿t ngay láº­p tá»©c náº¿u gáº·p tham sá»‘ <code>&lt;= 0</code>.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-bdd---behavior-driven-development"></a>3. BDD - Behavior Driven Development<a class="hash-link" href="#3-bdd---behavior-driven-development" title="Direct link to heading">#</a></h1><p><img src="http://blog.andolasoft.com/wp-content/uploads/2015/05/TDD-vs-BDD.jpg" alt="BDD"></p><p>Káº¿ thá»«a ngÆ°á»i tiá»n nhiá»‡m TDD vá»›i phÆ°Æ¡ng chÃ¢m &quot;Test trÆ°á»›c code sau&quot;, BDD chá»‰ khÃ¡c chÃºt lÃ  ta sáº½ táº­p trung vÃ o hÃ nh vi ngÆ°á»i dÃ¹ng (feature).</p><p>Theo Ä‘Ã³, ta sáº½ viáº¿t cÃ¡c feature test trÆ°á»›c (mÃ´ táº£ má»™t tÃ­nh nÄƒng cá»§a á»©ng dá»¥ng, hoáº·c usecase/userstory). Vá»›i má»—i feature test Ä‘Ã³, ta cÃ³ thá»ƒ sáº½ pháº£i triá»ƒn khai thÃªm 1 vÃ i unit test/integration test cho cÃ¡c class/function cáº§n thiáº¿t trong feature test.</p><p>VÃ­ dá»¥: Ta muá»‘n xÃ¢y dá»±ng tÃ­nh nÄƒng táº¡o album cho á»©ng dá»¥ng quáº£n lÃ½ album nháº¡c.</p><p>TrÆ°á»›c háº¿t hÃ£y hÃ¬nh dung tÃ­nh nÄƒng nÃ y trong Ä‘áº§u:</p><blockquote><p>Admin tá»« trang index albums (/albums), báº¥m nÃºt &quot;Add album&quot;, 1 form sáº½ hiá»‡n ra Ä‘á»ƒ nháº­p thÃ´ng tin album (bao gá»“m title vÃ  artist name).</p><p>Náº¿u anh admin nÃ y nháº­p Ä‘Ãºng, hÃ£y redirect sang trang index vÃ  hiá»ƒn thá»‹ album má»›i nÃ y, cÃ²n khÃ´ng thÃ¬ hÃ£y hiá»‡n lá»—i Ä‘á»ƒ anh admin cÃ²n biáº¿t Ä‘Æ°á»ng mÃ  láº§n.</p></blockquote><p>Feature test cá»§a ta sáº½ nhÆ° sau:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># spec/features/create_album_spec.rb</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RSpec.feature &quot;album creating process&quot;, type: :feature do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  context &quot;all fields are filled correctly&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    it &quot;create a new album&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      visit &#x27;/albums&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      click_link &#x27;Add album&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      within &#x27;form#album_form&#x27; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        fill_in &#x27;Title&#x27;, with: &#x27;Chay ngay di&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        fill_in &#x27;Artist name&#x27;, with: &quot;Sep&#x27;ss&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      click_button &#x27;Create&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      expect(page).to have_content(&#x27;Chay ngay di&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  context &quot;title is blank&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    it &quot;show errors&quot; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      visit &#x27;/albums&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      click_link &#x27;Add album&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      within &#x27;form#album_form&#x27; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        fill_in &#x27;Artist name&#x27;, with: &quot;Sep&#x27;ss&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      click_button &#x27;Create&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      expect(page).to have_content(&quot;Title can&#x27;t be blank&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Náº¿u lÃ m theo Ä‘Ãºng flow cá»§a Rails, ta sáº½ pháº£i viáº¿t unit test cho:</p><ul><li>Controller: index, create - test xem logic bÃªn trong Ä‘Ã£ Ä‘Ãºng chÆ°a, status code ra sao.</li><li>View: new, index - test xem trÆ°á»ng há»£p cÃ³ lá»—i thÃ¬ form hiá»ƒn thá»‹ sao, hay trÆ°á»ng há»£p khÃ´ng cÃ³ album thÃ¬ view index cÃ³ thÃ´ng bÃ¡o cho ngÆ°á»i dÃ¹ng biáº¿t hay khÃ´ng.</li><li>Model: album - test xem validate cÃ³ hoáº¡t Ä‘á»™ng hay khÃ´ng.</li></ul><p>Chi tiáº¿t thÃ¬ mÃ¬nh xin lÆ°á»£c bá»›t vÃ¬ dÃ i quÃ¡, báº¡n cÃ³ thá»ƒ tham kháº£o thÃªm á»Ÿ <a href="http://hanamirb.org/guides/1.2/getting-started/" target="_blank" rel="noopener noreferrer">Ä‘Ã¢y</a>.</p><p>Náº¿u báº¡n bÄƒn khoÄƒn nÃªn test cÃ¡i gÃ¬ trong Rails, cÃ³ thá»ƒ tham kháº£o bÃ i <a href="https://m.patrikonrails.com/how-i-test-my-rails-applications-cf150e347a6b" target="_blank" rel="noopener noreferrer">nÃ y</a>.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-cÃ¡c-nguyÃªn-táº¯c-khi-viáº¿t-test-tdd"></a>3. CÃ¡c nguyÃªn táº¯c khi viáº¿t test (TDD)<a class="hash-link" href="#3-cÃ¡c-nguyÃªn-táº¯c-khi-viáº¿t-test-tdd" title="Direct link to heading">#</a></h1><ol><li><p>Chá»‰ viáº¿t code khi nÃ³ cáº§n thiáº¿t Ä‘á»ƒ test cá»§a báº¡n pass.</p><p>VD báº¡n viáº¿t má»™t hÃ m láº¥y vá» email cá»§a ngÆ°á»i dÃ¹ng theo <code>id</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">def get_user_mail_by_id(id)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  user = User.find(id)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  user.mail</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>á» Ä‘Ã¢y báº¯t buá»™c pháº£i truy váº¥n CSDL Ä‘á»ƒ tÃ¬m ra user. KhÃ´ng dÃ¹ng <code>find</code> thÃ¬ láº¥y thÃ´ng tin user tháº¿ nÃ o :v</p></li><li><p>Chá»‰ viáº¿t nÃªn unit test trong pháº¡m vi vá»«a Ä‘á»§.</p></li></ol><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="4-Æ°u-Ä‘iá»ƒm"></a>4. Æ¯u Ä‘iá»ƒm<a class="hash-link" href="#4-Æ°u-Ä‘iá»ƒm" title="Direct link to heading">#</a></h1><ul><li><p>Nhá»¯ng ngÆ°á»i nÃ£o to trÃªn tháº¿ giá»›i Ä‘Ã£ chá»©ng minh Ä‘Æ°á»£c TDD giÃºp thay Ä‘á»•i mindset cá»§a báº¡n, vÃ  báº¡n sáº½ trá»Ÿ thÃ nh nhá»¯ng láº­p trÃ¬nh viÃªn tá»‘t hÆ¡n.</p><p>NÃ³ Ä‘Ã²i há»i báº¡n pháº£i thu táº­p trung hÆ¡n vÃ o nhá»¯ng chi tiáº¿t nhá» Ä‘á»ƒ test cá»§a mÃ¬nh pass, hÆ¡n lÃ  suy nghÄ© váº©n vÆ¡ vá» cáº£ cÃ¡i app to Ä‘Ã¹ng.</p></li><li><p>NgoÃ i kiá»ƒm thá»­, test cÅ©ng lÃ  docs cho maintainer sau nÃ y, nÃ³ cung cáº¥p chi tiáº¿t vá» cÃ¡c Ä‘áº·c táº£ ká»¹ thuáº­t (specification) cá»§a app.</p></li><li><p>Ãt bug hÆ¡n, dá»… báº£o trÃ¬, phÃ¡t hiá»‡n lá»—i sá»›m.</p></li><li><p>Cho báº¡n biáº¿t code mÃ  báº¡n vá»«a viáº¿t xong nÃ³ lÃ m há»ng cáº£ app khÃ´ng =))</p></li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="5-káº¿t-luáº­n"></a>5. Káº¿t luáº­n<a class="hash-link" href="#5-káº¿t-luáº­n" title="Direct link to heading">#</a></h1><ul><li><p>TDD/BDD thá»±c sá»± ráº¥t tá»‘t, náº¿u báº¡n muá»‘n trá»Ÿ thÃ nh má»™t láº­p trÃ¬nh viÃªn tá»‘t hÆ¡n, hÃ£y cá»‘ gáº¯ng tryhard :v</p></li><li><p>ThÆ°á»ng má»i ngÆ°á»i hay cÃ³ xu hÆ°á»›ng code xong má»›i viáº¿t test, vÃ  mÃ¬nh cÅ©ng lÃ  má»™t trong sá»‘ Ä‘Ã³ =)). Tuy váº­y, hÃ£y cá»‘ gáº¯ng viáº¿t test case cá»§a mÃ¬nh tháº­t minh báº¡ch, dá»… hiá»ƒu, vÃ¬ chÃ­nh báº£n thÃ¢n ta vÃ  cÃ¡c maintainer sau nÃ y.</p></li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="6-tham-kháº£o"></a>6. Tham kháº£o<a class="hash-link" href="#6-tham-kháº£o" title="Direct link to heading">#</a></h1><ul><li><p><a href="https://medium.com/pacroy/test-driven-development-tdd-resource-site-tdd-pacroy-com-a02e02396f32" target="_blank" rel="noopener noreferrer">Test-Driven Development (TDD) Resource Site</a></p></li><li><p><a href="http://blog.andolasoft.com/2014/06/rails-things-you-must-know-about-tdd-and-bdd.html" target="_blank" rel="noopener noreferrer">Rails: Things you must know about TDD and BDD</a></p></li><li><p><a href="https://www.madetech.com/blog/9-benefits-of-test-driven-development" target="_blank" rel="noopener noreferrer">9 Benefits of Test Driven Development</a></p></li><li><p><a href="https://apiumhub.com/tech-blog-barcelona/advantages-of-test-driven-development/" target="_blank" rel="noopener noreferrer">20 ADVANTAGES OF TEST DRIVEN DEVELOPMENT</a></p></li><li><p><a href="http://hanamirb.org/guides/1.2/getting-started/" target="_blank" rel="noopener noreferrer">Hanami Official Guide</a></p></li><li><p><a href="https://m.patrikonrails.com/how-i-test-my-rails-applications-cf150e347a6b" target="_blank" rel="noopener noreferrer">How I test Rails applications</a></p></li></ul></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/tdd">tdd</a><a class="margin-horiz--sm" href="/blog/tags/bdd">bdd</a><a class="margin-horiz--sm" href="/blog/tags/testing">testing</a><a class="margin-horiz--sm" href="/blog/tags/ruby-on-rails">ruby-on-rails</a></div><div class="col text--right"><a aria-label="Read more about TDD/BDD - NÃ³i dá»… hÆ¡n lÃ m" href="/blog/tdd-bdd-noi-de-hon-lam"><strong>Read More</strong></a></div></footer></article></div></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Self notes</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/moonlight8978/moonlight8978.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://stackoverflow.com/users/8068639/moonlight8978" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 moonlight8978. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.f8558fbc.js"></script>
<script src="/assets/js/main.a94954d9.js"></script>
</body>
</html>