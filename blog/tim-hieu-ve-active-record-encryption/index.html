<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="moonlight8978's Blog Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="moonlight8978's Blog Blog Atom Feed"><title data-react-helmet="true">TÃ¬m hiá»ƒu vá» Active Record Encryption | moonlight8978&#x27;s Blog</title><meta data-react-helmet="true" property="og:title" content="TÃ¬m hiá»ƒu vá» Active Record Encryption | moonlight8978&#x27;s Blog"><meta data-react-helmet="true" name="description" content="Overview"><meta data-react-helmet="true" property="og:description" content="Overview"><meta data-react-helmet="true" property="og:url" content="https://moonlight8978.github.io/blog/tim-hieu-ve-active-record-encryption"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="https://avatars.githubusercontent.com/u/26299310?v=4"><link data-react-helmet="true" rel="canonical" href="https://moonlight8978.github.io/blog/tim-hieu-ve-active-record-encryption"><link data-react-helmet="true" rel="alternate" href="https://moonlight8978.github.io/blog/tim-hieu-ve-active-record-encryption" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://moonlight8978.github.io/blog/tim-hieu-ve-active-record-encryption" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.5f3c8191.css">
<link rel="preload" href="/assets/js/runtime~main.9bf10215.js" as="script">
<link rel="preload" href="/assets/js/main.a4c2403e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">_MoonLight_</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs/intro">Programming notes</a><a class="navbar__item navbar__link" href="/books/intro">Book notes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ğŸŒ</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">_MoonLight_</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/intro">Programming notes</a></li><li class="menu__list-item"><a class="menu__link" href="/books/intro">Book notes</a></li><li class="menu__list-item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">All posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/blog/tim-hieu-ve-active-record-encryption">TÃ¬m hiá»ƒu vá» Active Record Encryption</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/websocket-hoat-dong-nhu-the-nao">WebSocket hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o?</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cung-tim-hieu-ve-puma-ruby-on-rails">CÃ¹ng tÃ¬m hiá»ƒu vá» Puma (Ruby on Rails)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cuoi-react-native-xem-appium-phan-1-cung-tim-hieu-cach-hoat-dong-cua-appium">CÆ°á»¡i React Native xem Appium (Pháº§n 1 - CÃ¹ng tÃ¬m hiá»ƒu cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a Appium)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/gioi-thieu-ve-kubernetes">Giá»›i thiá»‡u vá» Kubernetes</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/toi-uu-menh-de-where-mysql">Tá»‘i Æ°u má»‡nh Ä‘á» WHERE (MySQL)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cung-tim-hieu-ve-actiontext-trong-rails-6">CÃ¹ng tÃ¬m hiá»ƒu vá» ActionText trong Rails 6</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cung-tim-hieu-ve-railway-oriented-programming">CÃ¹ng tÃ¬m hiá»ƒu vá» Railway Oriented Programming</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/mot-vai-mindset-khi-lam-viec-voi-react">Má»™t vÃ i mindset khi lÃ m viá»‡c vá»›i React</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cung-tim-hieu-ve-nguyen-tu-cua-the-gioi-front-end-phan-2-density-independent-pixel">CÃ¹ng tÃ¬m hiá»ƒu vá» nguyÃªn tá»­ cá»§a tháº¿ giá»›i FrontEnd (Pháº§n 2 - Density-independent Pixel)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/cung-tim-hieu-ve-nguyen-tu-cua-the-gioi-front-end-phan-1-pixel">CÃ¹ng tÃ¬m hiá»ƒu vá» nguyÃªn tá»­ cá»§a tháº¿ giá»›i FrontEnd (Pháº§n 1 - Pixel)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/tdd-bdd-noi-de-hon-lam">TDD/BDD - NÃ³i dá»… hÆ¡n lÃ m</a></li></ul></div></div><main class="col col--7"><article><header><h1 class="margin-bottom--sm blogPostTitle_GeHD">TÃ¬m hiá»ƒu vá» Active Record Encryption</h1><div class="margin-vert--md"><time datetime="2021-06-17T00:00:00.000Z" class="blogPostDate_fNvV">June 17, 2021 Â· 8 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="LÃª SÄ© BÃ­ch"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/moonlight8978" target="_blank" rel="noopener noreferrer">LÃª SÄ© BÃ­ch</a></h4><small class="avatar__subtitle">Ruby on Rails/React Developer</small></div></div></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="overview"></a>Overview<a class="hash-link" href="#overview" title="Direct link to heading">#</a></h2><p>VÃ o ngÃ y 28/5/2021, trÃªn blog cá»§a Rails cÃ³ thÃ´ng bÃ¡o vá» 1 tÃ­nh nÄƒng má»›i Ä‘Ã³ lÃ  <a href="https://weblog.rubyonrails.org/2021/5/28/this-week-in-rails-active-record-encrytion-several-performance-optimizations-and-much-more/" target="_blank" rel="noopener noreferrer">ActiveRecord Encryption</a>.</p><p>ActiveRecord Encryption giÃºp encrypt attribute nÃ o Ä‘Ã³ cá»§a model, vÃ  lÆ°u vÃ o DB dÆ°á»›i dáº¡ng mÃ£ hoÃ¡. TÃ­nh nÄƒng nÃ y Ä‘Æ°á»£c extract ra tá»« dá»± Ã¡n <a href="https://www.hey.com" target="_blank" rel="noopener noreferrer">HEY</a> cá»§a Basecamp.</p><p>HÃ£y thá»­ tÃ¬m hiá»ƒu xem tÃ­nh nÄƒng nÃ y cÃ³ gÃ¬ thÃº vá»‹.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="usage"></a>Usage<a class="hash-link" href="#usage" title="Direct link to heading">#</a></h2><p>Theo <a href="https://edgeguides.rubyonrails.org/active_record_encryption.html#basic-usage" target="_blank" rel="noopener noreferrer">guide</a>, Ä‘áº§u tiÃªn chÃºng ta sáº½ cáº§n pháº£i cháº¡y cÃ¢u lá»‡nh sau</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">rails db:encryption:init</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Rails sáº½ cho ta 1 gá»£i Ã½ lÃ  copy Ä‘á»‘ng sau vÃ o credentials. á»ª <code>EDITOR=vim rails credentials:edit</code> rá»“i copy paste thÃ´i.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yml"><div tabindex="0" class="prism-code language-yml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">active_record_encryption</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">primary_key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> EGY8WhulUOXixybod7ZWwMIL68R9o5kC</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">deterministic_key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> aPA5XyALhf75NNnMzaspW7akTfZp0lPY</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">key_derivation_salt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> xEY0dt6TZcAMg52K7O84wYzkjvbA62Hz</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Trong model, ta define attribute cáº§n mÃ£ hoÃ¡ nhÆ° sau:</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">app/models/article.rb</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class Article &lt; ApplicationRecord</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  encrypts :title</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Rá»“i create/update model nhÆ° bÃ¬nh thÆ°á»ng</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">article = Article.create(title: &quot;Encrypt it all!&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>VÃ  bÃ¹m, magic...</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">INSERT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTO</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">`</span><span class="token plain">articles</span><span class="token punctuation" style="color:rgb(199, 146, 234)">`</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">`</span><span class="token plain">title</span><span class="token punctuation" style="color:rgb(199, 146, 234)">`</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{\&quot;p\&quot;:\&quot;n7J0/ol+a7DRMeaE\&quot;,\&quot;h\&quot;:{\&quot;iv\&quot;:\&quot;DXZMDWUKfp3bg/Yu\&quot;,\&quot;at\&quot;:\&quot;X1/YjMHbHD4talgF9dt61A==\&quot;}}&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>VÃ´ háº¡n bá»‘i rá»‘i...</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="aes"></a>AES<a class="hash-link" href="#aes" title="Direct link to heading">#</a></h2><p>TrÆ°á»›c tiÃªn ta hÃ£y tÃ¬m hiá»ƒu vá» Ä‘á»‘ng key mÃ  Rails Ä‘Ã£ gen cho ta lÃºc Ä‘áº§u</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yml"><div tabindex="0" class="prism-code language-yml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">active_record_encryption</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">primary_key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> EGY8WhulUOXixybod7ZWwMIL68R9o5kC</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">deterministic_key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> aPA5XyALhf75NNnMzaspW7akTfZp0lPY</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">key_derivation_salt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> xEY0dt6TZcAMg52K7O84wYzkjvbA62Hz</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Rails gen ra Ä‘á»‘ng trÃªn nhÆ° nÃ o váº­y?</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">https://github.com/rails/rails/blob/e2585a21e389967322a98b46a7b3643d82bd9c28/activerecord/lib/active_record/railties/databases.rake#L554-L566</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">puts &lt;&lt;~MSG</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Add this entry to the credentials of the target environment:#{&#x27; &#x27;}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  active_record_encryption:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    primary_key: #{SecureRandom.alphanumeric(32)}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    deterministic_key: #{SecureRandom.alphanumeric(32)}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    key_derivation_salt: #{SecureRandom.alphanumeric(32)}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">MSG</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Náº¿u ai chÆ°a biáº¿t thÃ¬ Ä‘Ã¢y lÃ  <a href="https://ruby-doc.org/stdlib-3.0.1/libdoc/securerandom/rdoc/SecureRandom.html" target="_blank" rel="noopener noreferrer">standard lib cá»§a Ruby</a>, Ä‘Æ¡n thuáº§n lÃ ... random mÃ  thÃ´i =))</p><p>Tháº¿ Ä‘á»‘ng key nÃ y Ä‘á»ƒ lÃ m gÃ¬? á» má»¥c <a href="https://edgeguides.rubyonrails.org/active_record_encryption.html#setup" target="_blank" rel="noopener noreferrer">Setup</a> cá»§a guide, Rails cÅ©ng Ä‘Ã£ gá»£i Ã½ cho ta, Ä‘á»‘ng nÃ y dÃ¹ng cho AES.</p><blockquote><p>this will be used to derive the AES 32 bytes key</p></blockquote><p>Váº­y AES lÃ  cÃ¡i khá»‰ má»‘c gÃ¬? Theo <a href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard" target="_blank" rel="noopener noreferrer">wiki</a>, AES lÃ  viáº¿t táº¯t cá»§a <strong>A</strong>dvanced <strong>E</strong>ncryption <strong>S</strong>tandard. Hay cÃ²n Ä‘Æ°á»£c biáº¿t Ä‘áº¿n vá»›i cÃ¡i tÃªn Rijndael. AES lÃ  1 chuáº©n mÃ£ hoÃ¡, sá»­ dá»¥ng symmetric encryption. AES ráº¥t phá»• biáº¿n ngÃ y nay.</p><p>Tháº¿ báº¥t nÃ o mÃ  láº¡i Ä‘áº» ra thÃªm nhiá»u thuáº­t ngá»¯ háº¡i nÃ£o hÆ¡n váº­y =)) Cá»© tá»« tá»« rá»“i khoai sáº½ nhá»«, chÃºng ta sáº½ tÃ¬m hiá»ƒu tiáº¿p.</p><p>TrÆ°á»›c háº¿t thÃ¬, tháº¿ nÃ o lÃ  mÃ£ hoÃ¡? VÃ­ dá»¥ nhÆ° á»Ÿ 1 diá»…n Ä‘Ã n nÃ o Ä‘Ã³ ngÆ°á»i ta share nhau hoÃ ng thuá»³ link báº±ng Ä‘á»‘ng kÃ­ tá»± nÃ y</p><blockquote><p>68747470733A2F2F7777772E676F6F676C652E636F6D2E766E2F</p></blockquote><p>thay vÃ¬ huá»µch toáº¹t ra lÃ  má»™t Ä‘Æ°á»ng link <del>Ä‘á»“i truá»µ</del> nÃ o Ä‘Ã³. NhÆ°ng do viá»‡c giáº£i mÃ£ quÃ¡ Ä‘Æ¡n giáº£n, cá»¥ thá»ƒ lÃ  dÃ¹ng mÃ£ HEX, nÃªn Ä‘Ã¢y chá»‰ lÃ  encode/decode sang 1 dáº¡ng dá»¯ liá»‡u khÃ¡c mÃ  thÃ´i, vÃ  viá»‡c chuyá»ƒn Ä‘á»•i thÆ°á»ng khÃ¡ nhanh. CÃ¡c báº¡n cÃ³ thá»ƒ vÃ o Ä‘Ã¢y <a href="https://www.convertstring.com/vi/EncodeDecode/HexDecode" target="_blank" rel="noopener noreferrer">Ä‘Ã¢y</a> Ä‘á»ƒ decode chuá»—i huyá»n bÃ­ trÃªn.</p><p>CÃ²n encrypt vÃ  decrypt dÃ¹ng trong cryptography nÃ³ á»Ÿ 1 táº§m cao khÃ¡c. ThÃ´ng thÆ°á»ng sáº½ cÃ³ thÃªm 1 key (hoáº·c 1 cáº·p key public/private). Khi Ä‘Ã³ input sáº½ lÃ  key + data. VÃ  output sáº½ lÃ  1 chuá»—i nÃ o Ä‘Ã³, chuá»—i nÃ y cá»±c kÃ¬ khÃ³ Ä‘á»ƒ giáº£i mÃ£ náº¿u khÃ´ng náº¯m trong tay key. ThÃ´ng thÆ°á»ng thÃ¬ pháº£i cho cháº¡y thuáº­t toÃ¡n vÃ©t cáº¡n - tá»©c lÃ  thá»­ tá»«ng key má»™t, vÃ  viá»‡c nÃ y cáº§n Ä‘áº¿n hÃ ng triá»‡u nÄƒm Ä‘á»‘i vá»›i cáº£ siÃªu mÃ¡y tÃ­nh.</p><ul><li>Vá»›i thuáº­t toÃ¡n dÃ¹ng 1 key cho cáº£ viá»‡c encrypt láº«n decrypt thÃ¬ sáº½ Ä‘Æ°á»£c gá»i lÃ  <strong>symmetric encryption</strong></li></ul><p><img alt="symmetric" src="/assets/images/symmetric-encryption-c4990731ab3014224c16d7235e908fbe.png"></p><ul><li>Thuáº­t toÃ¡n dÃ¹ng 1 cáº·p key, trong Ä‘Ã³ public key Ä‘á»ƒ mÃ£ hoÃ¡, cÃ²n private key Ä‘á»ƒ giáº£i mÃ£, Ä‘Æ°á»£c gá»i lÃ  <strong>asymmetric encryption</strong></li></ul><p><img alt="asymmetric" src="/assets/images/asymmetric-encryption-76191effbf7bf88a765cf47ab256a20d.png"></p><p><a href="https://hackernoon.com/symmetric-and-asymmetric-encryption-5122f9ec65b1" target="_blank" rel="noopener noreferrer">Image source</a></p><p>Quay láº¡i vá»›i AES, nÃ³ dÃ¹ng symmetric, nÃªn sáº½ dÃ¹ng 1 key cho cáº£ viá»‡c mÃ£ hoÃ¡ láº«n giáº£i mÃ£. AES key cÃ³ Ä‘á»™ dÃ i lÃ  128, 192, hoáº·c 256 bit. Tuá»³ vÃ o Ä‘á»™ dÃ i key nÃ³ sáº½ cÃ³ tÃªn khÃ¡c nhau AES-128, AES-192, AES-256. Key cÃ ng dÃ i thÃ¬ viá»‡c xá»­ lÃ½ cÃ ng lÃ¢u, nhÆ°ng Ä‘á»•i láº¡i cÃ ng báº£o máº­t hÆ¡n. Máº·c Ä‘á»‹nh Rails sá»­ dá»¥ng key cÃ³ Ä‘á»™ dÃ i 256 bit (32 bytes)</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">https://github.com/rails/rails/blob/e2585a21e389967322a98b46a7b3643d82bd9c28/activerecord/lib/active_record/encryption/cipher/aes256_gcm.rb#L16</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">CIPHER_TYPE = &quot;aes-256-gcm&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Vá» viá»‡c lÃ m tháº¿ nÃ o Ä‘á»ƒ AES mÃ£ hoÃ¡/giáº£i mÃ£ thÃ¬ mÃ¬nh sáº½ khÃ´ng Ä‘á» cáº­p táº¡i Ä‘Ã¢y <del>vÃ¬ mÃ¬nh cÅ©ng khÃ´ng cÃ³ hiá»ƒu máº¥y =))</del>, náº¿u ai muá»‘n tÃ¬m hiá»ƒu thÃªm cÃ³ thá»ƒ xem link <a href="https://www.youtube.com/watch?v=lnKPoWZnNNM" target="_blank" rel="noopener noreferrer">nÃ y</a>, hoáº·c gÃºc gá»“ ~~. á» dÆ°á»›i lÃ  báº£n preview, trÃ´ng cÃ¡i thuáº­t toÃ¡n nÃ³ nÃ´m na nhÆ° sau</p><p>AES sáº½ chia nhá» input thÃ nh tá»«ng block Ä‘á»ƒ xá»­ lÃ½</p><p><img alt="block-cipher" src="/assets/images/aes-block-cipher-ba94fcb32b74eafd7a18ddbb9374e1e2.png"></p><p><img alt="flow" src="/assets/images/aes-flow-3601bffc1d50d478fe633836df3bf026.jpeg"></p><p><img alt="round" src="/assets/images/aes-round-06e45529741ace75731d96822323cb45.jpeg"></p><p><a href="https://www.tutorialspoint.com/cryptography/advanced_encryption_standard.htm" target="_blank" rel="noopener noreferrer">Image Source</a></p><p>CÆ¡ mÃ  chá»‰ quan tÃ¢m lÃ  má»™t chuá»—i Ä‘áº§u vÃ o + 1 key, Ä‘i qua Ä‘á»‘ng black magic rá»“i trá»Ÿ thÃ nh 1 chuá»—i báº£o máº­t siÃªu háº¡ng lÃ  quÃ¡ Ä‘á»§ cho má»™t cuá»™c tÃ¬nh rá»“i.</p><p>Ã€ mÃ  nhÃ¬n cÃ¡i constant Rails define á»Ÿ trÃªn kia, láº¡i cÃ³ thÃªm cÃ¡i gÃ¬ á»Ÿ cuá»‘i chuá»—i tháº¿ nhá»‰. <code>gcm</code>???? Bá»‘i rá»‘i again.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="gcm"></a>GCM<a class="hash-link" href="#gcm" title="Direct link to heading">#</a></h2><p>GCM lÃ  viáº¿t táº¯t cá»§a <strong>G</strong>alois/<strong>C</strong>ounter <strong>M</strong>ode... Nghe xong hiá»ƒu cháº¿t liá»n .__. MÃ² thá»­ xem nÃ o!</p><p>NhÆ° tÃªn gá»i cá»§a nÃ³, GCM lÃ  má»™t <em>mode</em> trong symmetric encryption, káº¿t há»£p cá»§a <strong>Counter Mode</strong> vÃ  <strong>Galois Mode</strong>, dÃ¹ng cho mÃ£ hoÃ¡ dáº¡ng khá»‘i (block). Váº­y thÃ¬ AES Ä‘i vá»›i GCM lÃ  chuáº©n bÃ i rá»“i nhá»‰.</p><p>NgoÃ i GCM ra cÃ²n cÃ¡c mode khÃ¡c nhÆ° CCM, SIV, ...vÃ¢n vÃ¢n mÃ¢y mÃ¢y. CÃ¡c báº¡n cÃ³ thá»ƒ xem thÃªm táº¡i <a href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation" target="_blank" rel="noopener noreferrer">Ä‘Ã¢y</a></p><p>TrÆ°á»›c tiÃªn ta hÃ£y báº¯t Ä‘áº§u tá»« <strong>mode</strong>, tá»« nÃ y náº±m trong <strong>Mode of Operation</strong>. CÃ¡c mode sáº½ Ä‘Æ°á»£c apply trÃªn tá»«ng block data (nhÆ° Ä‘Ã£ nÃ³i á»Ÿ trÃªn thÃ¬ AES chia data thÃ nh cÃ¡c block nhá» vÃ  mÃ£ hoÃ¡), giÃºp cho output cá»§a viá»‡c mÃ£ hoÃ¡ block báº£o máº­t hÆ¡n.</p><p>Counter mode sá»­ dá»¥ng 1 sá»‘ integer lÃ m counter, qua tá»«ng block counter sáº½ tÄƒng lÃªn 1. á» má»—i block, sá»‘ nÃ y sáº½ Ä‘Æ°á»£c mÃ£ hoÃ¡ cÃ¹ng vá»›i data Ä‘á»ƒ cÃ³ Ä‘Æ°á»£c output báº£o máº­t hÆ¡n.</p><p><img alt="counter-mode" src="/assets/images/ctr-mode-2014a29f09bb87b5f9d8ccefab9d6cb9.png"></p><p>Galois Mode lÃ  má»™t authentication mode. Galois Mode giÃºp Ä‘áº£m báº£o ráº±ng cipher output cá»§a ta khÃ´ng bá»‹ chá»‰nh sá»­a bá»Ÿi má»™t bÃªn thá»© 3. Hoáº¡t Ä‘á»™ng nhÆ° nÃ o thÃ¬ mÃ¬nh chá»‹u Ã  =))</p><p>Káº¿t há»£p 2 mode trÃªn vÃ  ta cÃ³ GCM, giÃºp thuáº­t toÃ¡n mÃ£ hoÃ¡ cá»§a ta báº£o máº­t hÆ¡n, Ä‘á»“ng thá»i Ä‘áº£m báº£o Ä‘Æ°á»£c tÃ­nh toÃ n váº¹n cá»§a dá»¯ liá»‡u.</p><p><img alt="gcm-mode" src="/assets/images/gcm-mode-e5c2e6aa4299003be322c78d1a8b0d93.png"></p><p>BÃªn trÃªn lÃ  giáº£i thÃ­ch sÆ¡ qua vá» thuáº­t toÃ¡n mÃ£ hoÃ¡ mÃ  Rails sá»­ dá»¥ng, náº¿u cÃ³ sai sÃ³t thÃ¬ cÅ©ng Ä‘á»«ng gáº¡ch Ä‘Ã¡ tá»™i mÃ¬nh =))</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="aes-256-gcm-meets-rails"></a>AES-256-GCM meets Rails<a class="hash-link" href="#aes-256-gcm-meets-rails" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="encryption-key"></a>Encryption Key<a class="hash-link" href="#encryption-key" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yml"><div tabindex="0" class="prism-code language-yml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">active_record_encryption</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">primary_key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> EGY8WhulUOXixybod7ZWwMIL68R9o5kC</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">deterministic_key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> aPA5XyALhf75NNnMzaspW7akTfZp0lPY</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">key_derivation_salt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> xEY0dt6TZcAMg52K7O84wYzkjvbA62Hz</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Quay trá»Ÿ láº¡i vá»›i Ä‘á»‘ng key, hÃ£y cÃ¹ng mÃ² code Ä‘Ã¡y bá»ƒ xem chÃºng dáº«n ta tá»›i Ä‘Ã¢u :v</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/9c091b4fd378df515c4c31b85bb6a968463a1d82/activerecord/lib/active_record/railtie.rb#L313-L317</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ActiveRecord::Encryption.configure \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  primary_key: app.credentials.dig(:active_record_encryption, :primary_key),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  deterministic_key: app.credentials.dig(:active_record_encryption, :deterministic_key),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  key_derivation_salt: app.credentials.dig(:active_record_encryption, :key_derivation_salt),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  **config.active_record.encryption</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/9c091b4fd378df515c4c31b85bb6a968463a1d82/activerecord/lib/active_record/encryption/configurable.rb#L20-L33</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def configure(primary_key:, deterministic_key:, key_derivation_salt:, **properties)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  config.primary_key = primary_key</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  config.deterministic_key = deterministic_key</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  config.key_derivation_salt = key_derivation_salt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  context.key_provider = ActiveRecord::Encryption::DerivedSecretKeyProvider.new(primary_key)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/9c091b4fd378df515c4c31b85bb6a968463a1d82/activerecord/lib/active_record/encryption/derived_secret_key_provider.rb#L7-L9</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def initialize(passwords)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  super(Array(passwords).collect { |password| Key.derive_from(password) })</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Xem tiáº¿p class <code>Key</code> cÃ³ gÃ¬ nÃ o.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/9c091b4fd378df515c4c31b85bb6a968463a1d82/activerecord/lib/active_record/encryption/key.rb#L10-L26</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class Key</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def initialize(secret)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @secret = secret</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @public_tags = Properties.new</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def self.derive_from(password)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    secret = ActiveRecord::Encryption.key_generator.derive_key_from(password)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ActiveRecord::Encryption::Key.new(secret)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/9c091b4fd378df515c4c31b85bb6a968463a1d82/activerecord/lib/active_record/encryption/key_generator.rb#L32-L34</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def derive_key_from(password, length: key_length)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ActiveSupport::KeyGenerator.new(password).generate_key(ActiveRecord::Encryption.config.key_derivation_salt, length)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>NhÆ° váº­y, 2 trong sá»‘ 3 thanh niÃªn cá»§a ta Ä‘Ã£ bá»‹ lá»™ máº·t:</p><ul><li><code>primary_key</code> Ä‘Ã³ng vai trÃ² lÃ  <code>password</code> param cá»§a <code>ActiveSupport::KeyGenerator.new</code></li><li><code>key_derivation_salt</code> Ä‘Ã³ng vai trÃ² lÃ  tham sá»‘ thá»© nháº¥t cá»§a <code>ActiveSupport::KeyGenerator#generate_key</code></li></ul><p>HÃ£y check tiáº¿p <code>ActiveSupport::KeyGenerator</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># https://github.com/rails/rails/blob/9c091b4fd378df515c4c31b85bb6a968463a1d82/activesupport/lib/active_support/key_generator.rb#L26-L41</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def initialize(secret, options = {})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  @secret = secret</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  @iterations = options[:iterations] || 2**16</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  @hash_digest_class = options[:hash_digest_class] || self.class.hash_digest_class</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def generate_key(salt, key_size = 64)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  OpenSSL::PKCS5.pbkdf2_hmac(@secret, salt, @iterations, key_size, @hash_digest_class.new)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Qua háº¿t wrapper cá»§a Rails rá»“i, giá» ta pháº£i mÃ² vÃ o docs cá»§a Ruby thÃ´i.
Theo <a href="https://ruby-doc.org/stdlib-3.0.1/libdoc/openssl/rdoc/OpenSSL.html#module-OpenSSL-label-Encryption" target="_blank" rel="noopener noreferrer">docs</a>, docs láº¡i báº£o hÃ m nÃ y giá» Ä‘á»•i tÃªn thÃ nh <a href="https://ruby-doc.org/stdlib-3.0.1/libdoc/openssl/rdoc/OpenSSL/KDF.html#method-c-pbkdf2_hmac" target="_blank" rel="noopener noreferrer"><code>OpenSSL::KDF.pbkdf2_hmac</code></a> máº¥t rá»“i... á»œ thÃ¬ láº¡i mÃ² vÃ o xem. NÃ´m na hÃ m nÃ y sáº½ táº¡o ra 1 cipher key dÃ¹ng cho viá»‡c mÃ£ hoÃ¡.</p><p>Táº¡i Ä‘Ã¢y, ta cÃ³ thá»ƒ káº¿t luáº­n key mÃ£ hoÃ¡ mÃ  Rails dÃ¹ng cÃ³:</p><ul><li><code>passphrase</code>: <code>primary_key</code></li><li><code>salt</code>: <code>key_derivation_salt</code></li><li><code>iterations</code>: 2^16</li><li><code>key_len</code>: Ä‘á»™ dÃ i key 32 bytes</li><li><code>digest</code>: hash algorithm SHA-1</li></ul><p>HÃ£y cÃ¹ng test qua cÃ¡i key nÃ y xem</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">irb</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">require &#x27;openssl&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cipher = OpenSSL::Cipher.new(&#x27;aes-256-gcm&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cipher.encrypt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">iv = cipher.random_iv</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pwd = &#x27;EGY8WhulUOXixybod7ZWwMIL68R9o5kC&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">salt = &#x27;xEY0dt6TZcAMg52K7O84wYzkjvbA62Hz&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">iter = 2**16</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">key_len = OpenSSL::Cipher.new(&quot;aes-256-gcm&quot;).key_len</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">digest = OpenSSL::Digest.new(&#x27;SHA1&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">key = OpenSSL::PKCS5.pbkdf2_hmac(pwd, salt, iter, key_len, digest)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cipher.key = key</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">encrypted = cipher.update &quot;hello&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">encrypted &lt;&lt; cipher.final # =&gt; &quot;\xB2#\x10\xE7n&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cipher.decrypt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cipher.iv = iv</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">decrypted = cipher.update(encrypted) # =&gt; &quot;hello&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Sau bao nhiÃªu váº¥t váº£ thÃ¬ cÅ©ng tÃ¬m Ä‘Æ°á»£c cÃ¡i key =)) Váº­y quÃ¡ trÃ¬nh mÃ£ hoÃ¡ nhÆ° tháº¿ nÃ o? Láº¡i mÃ² tiáº¿p .__.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="encryption-process"></a>Encryption Process<a class="hash-link" href="#encryption-process" title="Direct link to heading">#</a></h3><p>HÃ£y cÃ¹ng báº¯t Ä‘áº§u tá»« viá»‡c khai bÃ¡o trong model</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">app/models/article.rb</div><div class="codeBlockContent_hGly ruby"><div tabindex="0" class="prism-code language-ruby codeBlock_23N8 thin-scrollbar codeBlockWithTitle_2JqI"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class Article &lt; ApplicationRecord</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  encrypts :title</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Rá»“i cÃ¹ng tÃ¬m xem <code>ApplicationRecord.encrypts</code> nÃ³ lÃ m trÃ² gÃ¬ nÃ o</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tham-kháº£o"></a>Tham kháº£o<a class="hash-link" href="#tham-kháº£o" title="Direct link to heading">#</a></h2><ul><li><a href="https://edgeguides.rubyonrails.org/active_record_encryption.html" target="_blank" rel="noopener noreferrer">https://edgeguides.rubyonrails.org/active_record_encryption.html</a></li><li><a href="https://www.precisely.com/blog/data-security/aes-vs-rsa-encryption-differences" target="_blank" rel="noopener noreferrer">https://www.precisely.com/blog/data-security/aes-vs-rsa-encryption-differences</a></li><li><a href="https://www.youtube.com/watch?v=lnKPoWZnNNM" target="_blank" rel="noopener noreferrer">https://www.youtube.com/watch?v=lnKPoWZnNNM</a></li><li><a href="https://www.youtube.com/watch?v=g_eY7JXOc8U" target="_blank" rel="noopener noreferrer">https://www.youtube.com/watch?v=g_eY7JXOc8U</a></li><li><a href="https://www.includehelp.com/cryptography/mode-of-operation.aspx" target="_blank" rel="noopener noreferrer">https://www.includehelp.com/cryptography/mode-of-operation.aspx</a></li></ul></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/websocket">websocket</a><a class="margin-horiz--sm" href="/blog/tags/javascript">javascript</a><a class="margin-horiz--sm" href="/blog/tags/web">web</a></div></footer></article><div><a href="https://github.com/moonlight8978/moonlight8978.github.io/edit/v2/blog/blog/2021-06-17-active-record-encryption.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/websocket-hoat-dong-nhu-the-nao"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">WebSocket hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o? Â»</div></a></div></nav></div></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link">Overview</a></li><li><a href="#usage" class="table-of-contents__link">Usage</a></li><li><a href="#aes" class="table-of-contents__link">AES</a></li><li><a href="#gcm" class="table-of-contents__link">GCM</a></li><li><a href="#aes-256-gcm-meets-rails" class="table-of-contents__link">AES-256-GCM meets Rails</a><ul><li><a href="#encryption-key" class="table-of-contents__link">Encryption Key</a></li><li><a href="#encryption-process" class="table-of-contents__link">Encryption Process</a></li></ul></li><li><a href="#tham-kháº£o" class="table-of-contents__link">Tham kháº£o</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Self notes</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/moonlight8978/moonlight8978.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://stackoverflow.com/users/8068639/moonlight8978" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 moonlight8978. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.9bf10215.js"></script>
<script src="/assets/js/main.a4c2403e.js"></script>
</body>
</html>