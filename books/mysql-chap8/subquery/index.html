<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="moonlight8978's Blog Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="moonlight8978's Blog Blog Atom Feed"><title data-react-helmet="true">Optimize Subquery v·ªõi Semijoin transformation | moonlight8978&#x27;s Blog</title><meta data-react-helmet="true" property="og:url" content="https://moonlight8978.github.io/books/mysql-chap8/subquery"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-books-current"><meta data-react-helmet="true" property="og:title" content="Optimize Subquery v·ªõi Semijoin transformation | moonlight8978&#x27;s Blog"><meta data-react-helmet="true" name="description" content="Ho√†ng th√πy link//dev.mysql.com/doc/refman/5.7/en/semijoins.html"><meta data-react-helmet="true" property="og:description" content="Ho√†ng th√πy link//dev.mysql.com/doc/refman/5.7/en/semijoins.html"><link data-react-helmet="true" rel="shortcut icon" href="https://avatars.githubusercontent.com/u/26299310?v=4"><link data-react-helmet="true" rel="canonical" href="https://moonlight8978.github.io/books/mysql-chap8/subquery"><link data-react-helmet="true" rel="alternate" href="https://moonlight8978.github.io/books/mysql-chap8/subquery" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://moonlight8978.github.io/books/mysql-chap8/subquery" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.5f3c8191.css">
<link rel="preload" href="/assets/js/runtime~main.40b7a2b6.js" as="script">
<link rel="preload" href="/assets/js/main.51f3c1f2.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">_MoonLight_</strong></a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs/intro">Programming notes</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/books/intro">Book notes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">üåû</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="https://avatars.githubusercontent.com/u/26299310?v=4" alt="moonlight8978" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">_MoonLight_</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/intro">Programming notes</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/books/intro">Book notes</a></li><li class="menu__list-item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/books/intro">Intro</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">AWS Certified Developer - Associated</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/intro">Intro</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/api-gateway">AWS API Gateway</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/auto-scaling-group">Auto Scaling Group</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/ci-cd">CI/CD</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/cloud-formation">AWS CloudFormation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/cloud-front">AWS CloudFront</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/cloud-trail">AWS Cloud Trail</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/code-star">AWS CodeStar</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/cognito">AWS Cognito</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/dynamo-db">DynamoDB</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/ec2">AWS EC2</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/ecs">Elastic Container Service</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/elasti-cache">AWS Elasti Cache</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/elastic-beanstalk">Elastic Beanstalk notes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/elb">Elastic Load Balancer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/event-bridge">AWS EventBridge</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/iam">IAM</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/kinesis">AWS Kinesis</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/kms">AWS KMS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/lambda">Lambda</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/parameter-store">AWS SSM Parameter Store</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/rds">RDS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/route53">AWS Route 53</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/s3">AWS Simple Storage Service</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/sam">AWS Serverless Application Model</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/secrets-manager">AWS Secrets Manager</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/security-group">AWS Security Group</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/ses">AWS Simple Email Service</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/sns">AWS Simple Notification Service</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/sqs">Amazon SQS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/step-functions">AWS Step Functions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/vpc">AWS Virtual Private Cloud</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/aws-developer-associated/x-ray">AWS X-Ray</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Database</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/database/high-performance-mysql">High Performance MySQL</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">MySQL Docs - Optimization (Chapter 8)</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/books/mysql-chap8/where">T·ªëi ∆∞u SELECT</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/books/mysql-chap8/subquery">Optimize Subquery v·ªõi Semijoin transformation</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">World Wide Web</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/books/www/oauth2-in-action">OAuth2 in Action</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Optimize Subquery v·ªõi Semijoin transformation</h1></header><div class="markdown"><p><strong>Ho√†ng th√πy link:</strong> <a href="https://dev.mysql.com/doc/refman/5.7/en/semijoins.html" target="_blank" rel="noopener noreferrer">https://dev.mysql.com/doc/refman/5.7/en/semijoins.html</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="semijoin-l√†-g√¨"></a>Semijoin l√† g√¨<a class="hash-link" href="#semijoin-l√†-g√¨" title="Direct link to heading">#</a></h2><p><strong>Semijoin</strong> l√† qu√° tr√¨nh chu·∫©n b·ªã tr∆∞·ªõc khi query, optimizer c·ªßa MySQL c√≥ th·ªÉ s·ª≠ d·ª•ng nhi·ªÅu strategy nh∆∞ table pullout, duplicate weedout, first match, loose scan, hay materizalization ƒë·ªÉ t·ªëi ∆∞u c√¢u l·ªánh subquery.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="v√≠-d·ª•-v·ªÅ-semijoin"></a>V√≠ d·ª• v·ªÅ semijoin<a class="hash-link" href="#v√≠-d·ª•-v·ªÅ-semijoin" title="Direct link to heading">#</a></h4><p>Gi·∫£ s·ª≠ ta c√≥ db v·ªÅ qu·∫£n l√Ω l·ªõp h·ªçc, <code>subject</code> l√† danh s√°ch t·∫•t c·∫£ c√°c m√¥n h·ªçc, <code>roster</code> l√† b·∫£ng join c·ªßa <code>student</code> v·ªõi <code>subject</code> nh·∫±m th·ªÉ hi·ªÉn h·ªçc sinh ƒë√£ ƒëƒÉng k√≠ h·ªçc m√¥n n√†o. Quan h·ªá gi·ªØa <code>subject</code> v√† <code>student</code> l√† many to many.</p><p>Query sau ƒë√¢y s·∫Ω l·∫•y ra ƒë∆∞·ª£c nh·ªØng <code>subject</code> c√≥ h·ªçc sinh ƒëƒÉng k√≠.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly SQL"><div tabindex="0" class="prism-code language-SQL codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">SELECT subject.id, subject.name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">FROM subject INNER JOIN roster</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">WHERE subject.id = roster.subject_id;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Tuy nhi√™n do l√† quan h·ªá many to many, n√™n trong b·∫£ng <code>roster</code> c√≥ th·ªÉ c√≥ nhi·ªÅu <code>subject_id</code> b·ªã tr√πng l·∫∑p. N√™n k·∫øt qu·∫£ c·ªßa query tr√™n c√≥ th·ªÉ s·∫Ω b·ªã duplicate.</p><p>Ta c√≥ th·ªÉ s·ª≠ d·ª•ng <code>SELECT DISTINCT</code> ƒë·ªÉ gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ n√†y. Tuy nhi√™n vi·ªác query t·∫•t, r·ªìi kh·ª≠ ƒëi nh·ªØng gi√° tr·ªã tr√πng l·∫∑p nh∆∞ v·∫≠y l√† kh√¥ng t·ªëi ∆∞u.</p><p>Ta c√≥ th·ªÉ gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ tr√™n b·∫±ng vi·ªác d√πng subquery.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> subject </span><span class="token keyword" style="font-style:italic">INNER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">JOIN</span><span class="token plain"> roster</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> subject_id </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> roster</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>C√¢u truy v·∫•n v·ª´a r·ªìi ch√∫ng ta s·ª≠ d·ª•ng s·∫Ω s·ª≠ d·ª•ng semijoin.</p><p>C√¢u truy v·∫•n ch√≠nh (outer query) c√≥ th·ªÉ s·ª≠ d·ª•ng outer join ho·∫∑c inner join. V√† reference table c√≥ th·ªÉ l√† base table, derived table ho·∫∑c view.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ƒëi·ªÅu-ki·ªán-ƒë·ªÉ-subquery-l√†-m·ªôt-semiquery"></a>ƒêi·ªÅu ki·ªán ƒë·ªÉ subquery l√† m·ªôt semiquery<a class="hash-link" href="#ƒëi·ªÅu-ki·ªán-ƒë·ªÉ-subquery-l√†-m·ªôt-semiquery" title="Direct link to heading">#</a></h4><p>Subquery ph·∫£i th·ªèa m√£n nh·ªØng ƒëi·ªÅu ki·ªán sau:</p><ul><li>Ph·∫£i l√† <code>IN</code> (ho·∫∑c <code>=ANY</code>) subquery, ƒë·∫∑t trong m·ªánh ƒë·ªÅ <code>WHERE</code> ho·∫∑c <code>ON</code> ·ªü top-level.</li><li>Kh√¥ng d√πng <code>UNION</code>.</li><li>Kh√¥ng c√≥ m·ªánh ƒë·ªÅ <code>GROUP BY</code> ho·∫∑c <code>HAVING</code>, c√°c aggregate functions.</li><li>Kh√¥ng c√≥ <code>ORDER BY</code> ƒëi k√®m v·ªõi <code>LIMIT</code>, ch·ªâ c√≥ <code>ORDER_BY</code> th√¥i th√¨ okay.</li><li>Outer query kh√¥ng d√πng <code>STRAIGHT_JOIN</code></li><li>Kh√¥ng c√≥ <code>STRAIGHT_JOIN</code> trong subquery.</li><li>T·ªïng s·ªë table c·∫£ trong inner query l·∫´n outer query b√© h∆°n 61 (maximum number of tables permitted in a join)</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="strategy"></a>Strategy<a class="hash-link" href="#strategy" title="Direct link to heading">#</a></h4><p>N·∫øu th·ªèa m√£n nh·ªØng ƒëi·ªÅu ki·ªán tr√™n, MySQL s·∫Ω convert subquery th√†nh semijoin v√† th·ª±c hi·ªán t√≠nh to√°n cost, r·ªìi ch·ªçn m·ªôt trong nh·ªØng strategy sau:</p><ul><li><p>Table pullout: Convert subquery th√†nh join. Ho·∫∑c s·∫Ω l·∫•y table trong inner query ra, truy v·∫•n, sau ƒë√≥ inner join v·ªõi outer table.</p></li><li><p><a href="https://mariadb.com/kb/en/library/duplicateweedout-strategy/" target="_blank" rel="noopener noreferrer">Duplicate Weedout</a>: Join table, l·∫•y ra to√†n b·ªô k·∫øt qu·∫£ tr∆∞·ªõc, sau ƒë√≥ s·ª≠ d·ª•ng b·∫£ng t·∫°m ƒë·ªÉ remove ƒëi nh·ªØng gi√° tr·ªã duplicate</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> Country</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   Country</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">code </span><span class="token operator" style="color:rgb(137, 221, 255)">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> City</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Country</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> City</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                      City</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Population </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.33</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> Country</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Population </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                      City</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Population </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token number" style="color:rgb(247, 140, 108)">1000</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token number" style="color:rgb(247, 140, 108)">1000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><img src="https://mariadb.com/kb/en/duplicateweedout-strategy/+image/duplicate-weedout-diagram" alt="duplicate-weedout-diagram"></p></li><li><p><a href="https://mariadb.com/kb/en/library/firstmatch-strategy/" target="_blank" rel="noopener noreferrer">First Match</a>: inner join table, khi t√¨m ƒë∆∞·ª£c m·ªôt k·∫øt qu·∫£ th·ªèa m√£n, n√≥ s·∫Ω return lu√¥n, kh√¥ng t√¨m gi√° tr·ªã ti·∫øp theo n·ªØa ƒë·ªÉ tr√°nh duplicate</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> Country</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> Country</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">code </span><span class="token operator" style="color:rgb(137, 221, 255)">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> City</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Country</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                       </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> City</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                       </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> City</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Population </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token number" style="color:rgb(247, 140, 108)">1000</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token number" style="color:rgb(247, 140, 108)">1000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> Country</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">continent</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Europe&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><img src="https://mariadb.com/kb/en/firstmatch-strategy/+image/firstmatch-firstmatch" alt="firstmatch-firstmatch"></p></li><li><p><a href="https://mariadb.com/kb/en/library/loosescan-strategy/" target="_blank" rel="noopener noreferrer">Loose Scan</a>: Scan subquery table b·∫±ng index, group nh·ªØng gi√° tr·ªã gi·ªëng nhau l·∫°i th√†nh t·ª´ng group, r·ªìi l·∫•y m·ªôt gi√° tr·ªã t·ª´ m·ªói group.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> Country</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Country</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">code </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> country_code </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> Satellite</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><img src="https://mariadb.com/kb/en/loosescan-strategy/+image/loosescan-diagram-no-where" alt="loosescan-diagram-no-where"></p></li><li><p>Materialization: ƒê·ªÅ c·∫≠p ri√™ng ·ªü d∆∞·ªõi</p></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="m·ªôt-v√†i-l∆∞u-√Ω"></a>M·ªôt v√†i l∆∞u √Ω:<a class="hash-link" href="#m·ªôt-v√†i-l∆∞u-√Ω" title="Direct link to heading">#</a></h4><ul><li><p>C√≥ th·ªÉ enable/disable semijoin, strategy b·∫±ng bi·∫øn <code>optimizer_switch</code></p></li><li><p>Khi disable <code>duplicateweedout</code>, strategy n√†y s·∫Ω kh√¥ng ƒë∆∞·ª£c s·ª≠ d·ª•ng tr·ª´ khi t·∫•t c·∫£ nh·ªØng strategy kh√°c ƒë·ªÅu kh√¥ng √°p d·ª•ng ƒë∆∞·ª£c ƒë·ªÉ t·ªëi ∆∞u.</p></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="explain-query"></a>EXPLAIN query<a class="hash-link" href="#explain-query" title="Direct link to heading">#</a></h4><ul><li><p>Semijoin table s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü outer select</p></li><li><p>Temporary table ƒë∆∞·ª£c s·ª≠ d·ª•ng s·∫Ω ƒë∆∞·ª£c ch·ªâ ra b·∫±ng <strong>Start temporary</strong> v√† <strong>End temporary</strong> trong c·ªôt <code>extra</code></p></li><li><p><strong>FirstMatch(table_name)</strong> trong c·ªôt <code>extra</code> cho ta bi·∫øt shortcut ƒë√£ ƒë∆∞·ª£c d√πng trong strategy First Match.</p></li><li><p><strong>LooseScan(m..n)</strong> trong c·ªôt <code>extra</code> ch·ªâ ra r·∫±ng Loose Scan ƒë√£ ƒë∆∞·ª£c √°p d·ª•ng, m, n l√† key part number.</p></li><li><p>Temporary table d√πng cho materialization ƒë∆∞·ª£c ch·ªâ ra b·∫±ng nh·ªØng row c√≥ <strong>select_type</strong> c·ªßa <strong>MATERIALIZED</strong> v√† nh·ªØng row c√≥ <strong>table</strong> c·ªßa <strong>subqueryN</strong></p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="materialization"></a>Materialization<a class="hash-link" href="#materialization" title="Direct link to heading">#</a></h2><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="materialization-l√†-g√¨"></a>Materialization l√† g√¨<a class="hash-link" href="#materialization-l√†-g√¨" title="Direct link to heading">#</a></h4><p>Khi th·∫•y subquery v√† outer query l√† c√πng b·ªë kh√°c √¥ng n·ªôi (ch·∫£ li√™n quan g√¨ t·ªõi nhau), th√¨ subquery ho√†n to√†n c√≥ th·ªÉ t√°ch ri√™ng ra, th·ª±c thi 2 query ƒë·ªôc l·∫≠p, cu·ªëi c√πng join 2 table ƒë√≥ v·ªõi nhau. √ù t∆∞·ªüng c·ªßa strategy n√†y l√† nh∆∞ v·∫≠y.</p><p>Khi s·ª≠ d·ª•ng strategy n√†y, tr∆∞·ªõc h·∫øt MySQL s·∫Ω query subquery, sau ƒë√≥ l·∫•y k·∫øt qu·∫£ ƒë·ªÉ t·∫°o 1 b·∫£ng t·∫°m (materialize), ƒë√°nh index ƒë·ªÉ remove duplicate, cu·ªëi c√πng join v·ªõi outer table.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> Country</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> Country</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">code </span><span class="token operator" style="color:rgb(137, 221, 255)">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> City</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Country</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                       </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> City</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                       </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> City</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Population </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token number" style="color:rgb(247, 140, 108)">1000</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token number" style="color:rgb(247, 140, 108)">1000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> Country</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">continent</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Europe&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><img src="https://mariadb.com/kb/en/semi-join-materialization-strategy/+image/sj-materialization1" alt="sj-materialization1"></p><p>Khi th·ª±c hi·ªán ph√©p join v·ªõi outer table, c√≥ 2 h∆∞·ªõng:</p><ul><li><p>Join t·ª´ b·∫£ng t·∫°m v√†o outer table</p><p>N·∫øu l√†m v·∫≠y, ta s·∫Ω ph·∫£i th·ª±c hi·ªán fullscan b·∫£ng t·∫°m, sau ƒë√≥ lookup nh·ªØng gi√° tr·ªã ƒë√≥ trong outer table</p><p>=&gt; g·ªçi l√† Materialization-scan</p></li><li><p>Join t·ª´ outer table v√†o b·∫£ng t·∫°m</p><p>Khi ƒë√≥ ta s·∫Ω d√πng gi√° tr·ªã ·ªü outer table ƒë·ªÉ lookup trong b·∫£ng t·∫°m</p><p>=&gt; g·ªçi l√† Materialization-lookup</p></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ƒëi·ªÅu-ki·ªán"></a>ƒêi·ªÅu ki·ªán<a class="hash-link" href="#ƒëi·ªÅu-ki·ªán" title="Direct link to heading">#</a></h4><ul><li><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">oe_1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> oe_2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> oe_N</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> ie_1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> i_2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ie_N </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li></ul><p>N·∫øu predicate c√≥ form nh∆∞ tr√™n, <code>oe_1</code> v√† <code>ie_1</code> kh√¥ng ƒë∆∞·ª£c null.</p><ul><li><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">oe </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> ie </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></li></ul><p>Predicate form n√†y ch·∫•p nh·∫≠n gi√° tr·ªã null.</p><ul><li>Outer expression v√† inner expression ph·∫£i c√≥ c√πng ki·ªÉu d·ªØ li·ªáu</li><li>Inner expression kh√¥ng ƒë∆∞·ª£c l√† ki·ªÉu <code>BLOB</code></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="rewrite-sql"></a>Rewrite SQL<a class="hash-link" href="#rewrite-sql" title="Direct link to heading">#</a></h4><p>Khi disable materialization semijoin ƒëi, MySQL c√≥ th·ªÉ s·∫Ω convert c√¢u l·ªánh subquery c·ªßa ta.</p><p>VD:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> t1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">a </span><span class="token operator" style="color:rgb(137, 221, 255)">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> t2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">b </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> t2 </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> where_condition</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>·ªû v√≠ d·ª• tr√™n, subquery ho√†n to√†n kh√¥ng li√™n quan g√¨ t·ªõi outer query, n·∫øu b√¨nh th∆∞·ªùng l√† c√≥ th·ªÉ d√πng materialization r·ªìi, nh∆∞ng n·∫øu ta disable ƒëi, MySQL s·∫Ω convert l·∫°i th√†nh nh∆∞ sau:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> t1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> t2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">b </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> t2 </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> where_condition </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">a</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">t2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Inner query v√† outer query ƒë√£ tr·ªü th√†nh l√°ng gi·ªÅng v·ªõi nhau.</p><p>V√† c·ª© m·ªói row c·ªßa <code>t1</code>, s·∫Ω ph·∫£i lookup 1 l·∫ßn trong subquery table, kh√° th·ªën.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="example"></a>Example<a class="hash-link" href="#example" title="Direct link to heading">#</a></h4><p>Database structure: <a href="https://github.com/moonlight8978/rsch-glr/blob/mysql/subquery/mysql-optimization/subquery/db/schema.rb" target="_blank" rel="noopener noreferrer">link</a></p><h6><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="first-match"></a>First Match<a class="hash-link" href="#first-match" title="Direct link to heading">#</a></h6><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">explain</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> cities</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> cities </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> city_id </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> populations </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> number </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5000000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">\G</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly txt"><div tabindex="0" class="prism-code language-txt codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">*************************** 1. row ***************************</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           id: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  select_type: SIMPLE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        table: cities</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   partitions: NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         type: ALL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">possible_keys: PRIMARY</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          key: NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      key_len: NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          ref: NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         rows: 7</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     filtered: 100.00</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Extra: NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">*************************** 2. row ***************************</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           id: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  select_type: SIMPLE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        table: populations</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   partitions: NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         type: ALL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">possible_keys: index_populations_on_city_id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          key: NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      key_len: NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          ref: NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         rows: 7</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     filtered: 33.33</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Extra: Using where; FirstMatch(cities); Using join buffer (Block Nested Loop)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">2 rows in set, 1 warning (0.00 sec)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h6><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="loose-scan"></a>Loose Scan<a class="hash-link" href="#loose-scan" title="Direct link to heading">#</a></h6><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">explain</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> cities</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> cities </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> city_id </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> satellites</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">\G</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly txt"><div tabindex="0" class="prism-code language-txt codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">*************************** 1. row ***************************</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           id: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  select_type: SIMPLE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        table: satellites</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   partitions: NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         type: index</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">possible_keys: index_satellites_on_city_id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          key: index_satellites_on_city_id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      key_len: 9</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          ref: NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         rows: 4</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     filtered: 50.00</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Extra: Using where; Using index; LooseScan</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">*************************** 2. row ***************************</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           id: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  select_type: SIMPLE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        table: cities</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   partitions: NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         type: eq_ref</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">possible_keys: PRIMARY</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          key: PRIMARY</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      key_len: 8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          ref: app_development.satellites.city_id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         rows: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     filtered: 100.00</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Extra: NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">2 rows in set, 1 warning (0.00 sec)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>ƒêo·∫°n explain tr√™n ch·ªâ ra r·∫±ng, b·∫£ng <code>satellites</code> ƒë√£ ƒë∆∞·ª£c √°p d·ª•ng strategy LooseScan, n√≥ s·∫Ω group nh·ªØng gi√° tr·ªã gi·ªëng nhau l·∫°i, v√† l·∫•y ra 1 gi√° tr·ªã trong m·ªói group.</p><p>Cu·ªëi c√πng join v·ªõi b·∫£ng <code>cities</code> v·ªõi access_method <code>eq_ref</code>.</p><h6><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="materialization-1"></a>Materialization<a class="hash-link" href="#materialization-1" title="Direct link to heading">#</a></h6><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">session</span><span class="token plain"> optimizer_switch</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;duplicateweedout=off,firstmatch=off,loosescan=off&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">explain</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> cities</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> cities </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> city_id </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> populations </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> number </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5000000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">\G</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly txt"><div tabindex="0" class="prism-code language-txt codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">*************************** 1. row ***************************</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           id: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  select_type: SIMPLE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        table: cities</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   partitions: NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         type: ALL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">possible_keys: PRIMARY</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          key: NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      key_len: NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          ref: NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         rows: 7</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     filtered: 100.00</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Extra: Using where</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">*************************** 2. row ***************************</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           id: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  select_type: SIMPLE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        table: &lt;subquery2&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   partitions: NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         type: eq_ref</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">possible_keys: &lt;auto_key&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          key: &lt;auto_key&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      key_len: 9</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          ref: app_development.cities.id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         rows: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     filtered: 100.00</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Extra: NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">*************************** 3. row ***************************</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           id: 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  select_type: MATERIALIZED</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        table: populations</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   partitions: NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         type: ALL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">possible_keys: index_populations_on_city_id,index_populations_on_number</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          key: NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      key_len: NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          ref: NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         rows: 7</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     filtered: 57.14</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Extra: Using where</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">3 rows in set, 1 warning (0.00 sec)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>Row 3 cho th·∫•y b·∫£ng populations ƒë√£ ƒë∆∞·ª£c query, nh∆∞ng v·ªõi ƒëi·ªÅu ki·ªán <code>population &gt; 5000000</code> th√¨ kh√¥ng c√≥ index n√†o ƒë∆∞·ª£c d√πng, v√† n√≥ th·ª±c hi·ªán fullscan. MySQL d√πng k·∫øt qu·∫£ ƒë√≥ ƒë·ªÉ t·∫°o n√™n materialized table, ch√≠nh l√† b·∫£ng <code>&lt;subquery2&gt;</code> ·ªü Row 1.</li><li><code>eq_ref</code> cho th·∫•y <code>&lt;subquery2&gt;</code> v√† <code>cities</code> ƒë√£ join v·ªõi nhau, <code>&lt;subquery2&gt;</code> fullscan =&gt; ƒë√¢y ch√≠nh l√† strategy Materialization-Scan.</li></ul><h6><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="rewrite-sql-1"></a>Rewrite SQL<a class="hash-link" href="#rewrite-sql-1" title="Direct link to heading">#</a></h6><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">explain</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> cities</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> cities </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> city_id </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> populations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">\G</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly txt"><div tabindex="0" class="prism-code language-txt codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">*************************** 1. row ***************************</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           id: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  select_type: PRIMARY</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        table: cities</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   partitions: NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         type: ALL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">possible_keys: NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          key: NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      key_len: NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          ref: NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         rows: 7</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     filtered: 100.00</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Extra: Using where</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">*************************** 2. row ***************************</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           id: 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  select_type: DEPENDENT SUBQUERY</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        table: populations</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   partitions: NULL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         type: index_subquery</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">possible_keys: index_populations_on_city_id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          key: index_populations_on_city_id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      key_len: 9</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          ref: func</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         rows: 7</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     filtered: 100.00</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Extra: Using index</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">2 rows in set, 1 warning (0.00 sec)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/moonlight8978/moonlight8978.github.io/edit/v2/books/books/mysql-chap8/2-subquery.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-06-07T07:55:41.000Z" class="lastUpdatedDate_1WI_">6/7/2021</time></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/books/mysql-chap8/where"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ T·ªëi ∆∞u SELECT</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/books/www/oauth2-in-action"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">OAuth2 in Action ¬ª</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#semijoin-l√†-g√¨" class="table-of-contents__link">Semijoin l√† g√¨</a></li><li><a href="#materialization" class="table-of-contents__link">Materialization</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Self notes</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/moonlight8978/moonlight8978.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://stackoverflow.com/users/8068639/moonlight8978" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2021 moonlight8978. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.40b7a2b6.js"></script>
<script src="/assets/js/main.51f3c1f2.js"></script>
</body>
</html>